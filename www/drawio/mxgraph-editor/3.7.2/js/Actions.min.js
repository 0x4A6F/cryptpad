function Actions(a){this.editorUi=a;this.actions=new Object();this.init()}Actions.prototype.init=function(){var f=this.editorUi;var b=f.editor;var e=b.graph;var c=function(){return Action.prototype.isEnabled.apply(this,arguments)&&e.isEnabled()};this.addAction("new...",function(){window.open(f.getUrl())});this.addAction("open...",function(){window.openNew=true;window.openKey="open";f.openFile()});this.addAction("import...",function(){window.openNew=false;window.openKey="import";window.openFile=new OpenFile(mxUtils.bind(this,function(){f.hideDialog()}));window.openFile.setConsumer(mxUtils.bind(this,function(j,h){try{var n=mxUtils.parseXml(j);var i=new mxGraphModel();var l=new mxCodec(n);l.decode(n.documentElement,i);var k=i.getChildren(i.getChildAt(i.getRoot(),0));b.graph.setSelectionCells(b.graph.importCells(k))}catch(m){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+m.message)}}));f.showDialog(new OpenDialog(this).container,320,220,true,true,function(){window.openFile=null})}).isEnabled=c;this.addAction("save",function(){f.saveFile(false)},null,null,"Ctrl+S").isEnabled=c;this.addAction("saveAs...",function(){f.saveFile(true)},null,null,"Ctrl+Shift+S").isEnabled=c;this.addAction("export...",function(){f.showDialog(new ExportDialog(f).container,300,230,true,true)});this.addAction("editDiagram...",function(){var h=new EditDiagramDialog(f);f.showDialog(h.container,620,420,true,true);h.init()});this.addAction("pageSetup...",function(){f.showDialog(new PageSetupDialog(f).container,320,220,true,true)}).isEnabled=c;this.addAction("print...",function(){f.showDialog(new PrintDialog(f).container,300,180,true,true)},null,"sprite-print","Ctrl+P");this.addAction("preview",function(){mxUtils.show(e,null,10,10)});this.addAction("undo",function(){f.undo()},null,"sprite-undo","Ctrl+Z");this.addAction("redo",function(){f.redo()},null,"sprite-redo",(!mxClient.IS_WIN)?"Ctrl+Shift+Z":"Ctrl+Y");this.addAction("cut",function(){mxClipboard.cut(e)},null,"sprite-cut","Ctrl+X");this.addAction("copy",function(){mxClipboard.copy(e)},null,"sprite-copy","Ctrl+C");this.addAction("paste",function(){if(e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())){mxClipboard.paste(e)}},false,"sprite-paste","Ctrl+V");this.addAction("pasteHere",function(k){if(e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())){e.getModel().beginUpdate();try{var m=mxClipboard.paste(e);if(m!=null){var h=e.getBoundingBoxFromGeometry(m);if(h!=null){var l=e.view.translate;var o=e.view.scale;var p=l.x;var n=l.y;var j=Math.round(e.snap(e.popupMenuHandler.triggerX/o-p));var i=Math.round(e.snap(e.popupMenuHandler.triggerY/o-n));e.cellsMoved(m,j-h.x,i-h.y)}}}finally{e.getModel().endUpdate()}}});function a(m){e.escape();var k=e.getDeletableCells(e.getSelectionCells());if(k!=null&&k.length>0){var j=e.model.getParents(k);e.removeCells(k,m);if(j!=null){var h=[];for(var l=0;l<j.length;l++){if(e.model.contains(j[l])&&(e.model.isVertex(j[l])||e.model.isEdge(j[l]))){h.push(j[l])}}e.setSelectionCells(h)}}}this.addAction("delete",function(h){a(h!=null&&mxEvent.isShiftDown(h))},null,null,"Delete");this.addAction("deleteAll",function(){a(true)},null,null,"Ctrl+Delete");this.addAction("duplicate",function(){e.setSelectionCells(e.duplicateCells())},null,null,"Ctrl+D");this.put("turn",new Action(mxResources.get("turn")+" / "+mxResources.get("reverse"),function(){e.turnShapes(e.getSelectionCells())},null,null,"Ctrl+R"));this.addAction("selectVertices",function(){e.selectVertices()},null,null,"Ctrl+Shift+I");this.addAction("selectEdges",function(){e.selectEdges()},null,null,"Ctrl+Shift+E");this.addAction("selectAll",function(){e.selectAll(null,true)},null,null,"Ctrl+A");this.addAction("selectNone",function(){e.clearSelection()},null,null,"Ctrl+Shift+A");this.addAction("lockUnlock",function(){if(!e.isSelectionEmpty()){e.getModel().beginUpdate();try{var h=e.isCellMovable(e.getSelectionCell())?1:0;e.toggleCellStyles(mxConstants.STYLE_MOVABLE,h);e.toggleCellStyles(mxConstants.STYLE_RESIZABLE,h);e.toggleCellStyles(mxConstants.STYLE_ROTATABLE,h);e.toggleCellStyles(mxConstants.STYLE_DELETABLE,h);e.toggleCellStyles(mxConstants.STYLE_EDITABLE,h);e.toggleCellStyles("connectable",h)}finally{e.getModel().endUpdate()}}},null,null,"Ctrl+L");this.addAction("home",function(){e.home()},null,null,"Home");this.addAction("exitGroup",function(){e.exitGroup()},null,null,"Ctrl+Shift+Page Up");this.addAction("enterGroup",function(){e.enterGroup()},null,null,"Ctrl+Shift+Page Down");this.addAction("expand",function(){e.foldCells(false)},null,null,"Ctrl+Page Down");this.addAction("collapse",function(){e.foldCells(true)},null,null,"Ctrl+Page Up");this.addAction("toFront",function(){e.orderCells(false)},null,null,"Ctrl+Shift+F");this.addAction("toBack",function(){e.orderCells(true)},null,null,"Ctrl+Shift+B");this.addAction("group",function(){if(e.getSelectionCount()==1){e.setCellStyles("container","1")}else{e.setSelectionCell(e.groupCells(null,0))}},null,null,"Ctrl+G");this.addAction("ungroup",function(){if(e.getSelectionCount()==1&&e.getModel().getChildCount(e.getSelectionCell())==0){e.setCellStyles("container","0")}else{e.setSelectionCells(e.ungroupCells())}},null,null,"Ctrl+Shift+U");this.addAction("removeFromGroup",function(){e.removeCellsFromParent()});this.addAction("edit",function(){if(e.isEnabled()){e.startEditingAtCell()}},null,null,"F2/Enter");this.addAction("editData...",function(){var h=e.getSelectionCell()||e.getModel().getRoot();if(h!=null){var i=new EditDataDialog(f,h);f.showDialog(i.container,320,320,true,false);i.init()}},null,null,"Ctrl+M");this.addAction("editTooltip...",function(){var k=f.editor.graph;if(k.isEnabled()&&!k.isSelectionEmpty()){var h=k.getSelectionCell();var j="";if(mxUtils.isNode(h.value)){var i=h.value.getAttribute("tooltip");if(i!=null){j=i}}var l=new TextareaDialog(f,mxResources.get("editTooltip")+":",j,function(m){k.setTooltipForCell(h,m)});f.showDialog(l.container,320,200,true,true);l.init()}});this.addAction("openLink",function(){var h=e.getLinkForCell(e.getSelectionCell());if(h!=null){window.open(h)}});this.addAction("editLink...",function(){var j=f.editor.graph;if(j.isEnabled()&&!j.isSelectionEmpty()){var h=j.getSelectionCell();var i=j.getLinkForCell(h)||"";f.showLinkDialog(i,mxResources.get("apply"),function(k){k=mxUtils.trim(k);j.setLinkForCell(h,(k.length>0)?k:null)})}});this.addAction("insertLink...",function(){if(e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())){var h=new LinkDialog(f,"",mxResources.get("insert"),function(k,n){k=mxUtils.trim(k);if(k.length>0){var m=k.substring(k.lastIndexOf("/")+1);var i=null;if(n!=null&&n.length>0){i=n[0].iconUrl;m=n[0].name||n[0].type;m=m.charAt(0).toUpperCase()+m.substring(1);if(m.length>30){m=m.substring(0,30)+"..."}}var l=e.getFreeInsertPoint();var j=new mxCell(m,new mxGeometry(l.x,l.y,100,40),"fontColor=#0000EE;fontStyle=4;rounded=1;overflow=hidden;"+((i!=null)?"shape=label;imageWidth=16;imageHeight=16;spacingLeft=26;align=left;image="+i:"spacing=10;"));j.vertex=true;e.setLinkForCell(j,k);e.cellSizeUpdated(j,true);e.setSelectionCell(e.addCell(j));e.scrollCellToVisible(e.getSelectionCell())}});f.showDialog(h.container,420,90,true,true);h.init()}}).isEnabled=c;this.addAction("link...",mxUtils.bind(this,function(){var k=f.editor.graph;if(k.isEnabled()){if(k.cellEditor.isContentEditing()){var j=k.getParentByName(k.getSelectedElement(),"A",k.cellEditor.textarea);var h="";if(j!=null){h=j.getAttribute("href")||""}var i=k.cellEditor.saveSelection();f.showLinkDialog(h,mxResources.get("apply"),mxUtils.bind(this,function(l){k.cellEditor.restoreSelection(i);if(l!=null){k.insertLink(l)}}))}else{if(k.isSelectionEmpty()){this.get("insertLink").funct()}else{this.get("editLink").funct()}}}})).isEnabled=c;this.addAction("autosize",function(){var j=e.getSelectionCells();if(j!=null){e.getModel().beginUpdate();try{for(var k=0;k<j.length;k++){var h=j[k];if(e.getModel().getChildCount(h)){e.updateGroupBounds([h],20)}else{var l=e.view.getState(h);var m=e.getCellGeometry(h);if(e.getModel().isVertex(h)&&l!=null&&l.text!=null&&m!=null&&e.isWrapping(h)){m=m.clone();m.height=l.text.boundingBox.height/e.view.scale;e.getModel().setGeometry(h,m)}else{e.updateCellSize(h)}}}}finally{e.getModel().endUpdate()}}},null,null,"Ctrl+Shift+Y");this.addAction("formattedText",function(){var k=e.getView().getState(e.getSelectionCell());if(k!=null){var j="1";e.stopEditing();e.getModel().beginUpdate();try{if(k.style.html=="1"){j=null;var i=e.convertValueToString(k.cell);if(mxUtils.getValue(k.style,"nl2Br","1")!="0"){i=i.replace(/\n/g,"").replace(/<br\s*.?>/g,"\n")}var h=document.createElement("div");h.innerHTML=i;i=mxUtils.extractTextWithWhitespace(h.childNodes);e.cellLabelChanged(k.cell,i)}else{var i=mxUtils.htmlEntities(e.convertValueToString(k.cell),false);if(mxUtils.getValue(k.style,"nl2Br","1")!="0"){i=i.replace(/\n/g,"<br/>")}e.cellLabelChanged(k.cell,e.sanitizeHtml(i))}e.setCellStyles("html",j);f.fireEvent(new mxEventObject("styleChanged","keys",["html"],"values",[(j!=null)?j:"0"],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}}});this.addAction("wordWrap",function(){var i=e.getView().getState(e.getSelectionCell());var h="wrap";e.stopEditing();if(i!=null&&i.style[mxConstants.STYLE_WHITE_SPACE]=="wrap"){h=null}e.setCellStyles(mxConstants.STYLE_WHITE_SPACE,h)});this.addAction("rotation",function(){var i="0";var h=e.getView().getState(e.getSelectionCell());if(h!=null){i=h.style[mxConstants.STYLE_ROTATION]||i}var j=new FilenameDialog(f,i,mxResources.get("apply"),function(k){if(k!=null&&k.length>0){e.setCellStyles(mxConstants.STYLE_ROTATION,k)}},mxResources.get("enterValue")+" ("+mxResources.get("rotation")+" 0-360)");f.showDialog(j.container,300,80,true,true);j.init()});this.addAction("resetView",function(){e.zoomTo(1);f.resetScrollbars()},null,null,"Ctrl+H");this.addAction("zoomIn",function(h){e.zoomIn()},null,null,"Ctrl + / Alt+Mousewheel");this.addAction("zoomOut",function(h){e.zoomOut()},null,null,"Ctrl - / Alt+Mousewheel");this.addAction("fitWindow",function(){e.fit()},null,null,"Ctrl+Shift+H");this.addAction("fitPage",mxUtils.bind(this,function(){if(!e.pageVisible){this.get("pageView").funct()}var i=e.pageFormat;var m=e.pageScale;var h=e.container.clientWidth-10;var j=e.container.clientHeight-10;var l=Math.floor(20*Math.min(h/i.width/m,j/i.height/m))/20;e.zoomTo(l);if(mxUtils.hasScrollbars(e.container)){var k=e.getPagePadding();e.container.scrollTop=k.y*e.view.scale;e.container.scrollLeft=Math.min(k.x*e.view.scale,(e.container.scrollWidth-e.container.clientWidth)/2)}}),null,null,"Ctrl+J");this.addAction("fitTwoPages",mxUtils.bind(this,function(){if(!e.pageVisible){this.get("pageView").funct()}var i=e.pageFormat;var m=e.pageScale;var h=e.container.clientWidth-10;var j=e.container.clientHeight-10;var l=Math.floor(20*Math.min(h/(2*i.width)/m,j/i.height/m))/20;e.zoomTo(l);if(mxUtils.hasScrollbars(e.container)){var k=e.getPagePadding();e.container.scrollTop=Math.min(k.y,(e.container.scrollHeight-e.container.clientHeight)/2);e.container.scrollLeft=Math.min(k.x,(e.container.scrollWidth-e.container.clientWidth)/2)}}),null,null,"Ctrl+Shift+J");this.addAction("fitPageWidth",mxUtils.bind(this,function(){if(!e.pageVisible){this.get("pageView").funct()}var i=e.pageFormat;var l=e.pageScale;var h=e.container.clientWidth-10;var k=Math.floor(20*h/i.width/l)/20;e.zoomTo(k);if(mxUtils.hasScrollbars(e.container)){var j=e.getPagePadding();e.container.scrollLeft=Math.min(j.x*e.view.scale,(e.container.scrollWidth-e.container.clientWidth)/2)}}));this.put("customZoom",new Action(mxResources.get("custom")+"...",mxUtils.bind(this,function(){var h=new FilenameDialog(this.editorUi,parseInt(e.getView().getScale()*100),mxResources.get("apply"),mxUtils.bind(this,function(i){var j=parseInt(i);if(!isNaN(j)&&j>0){e.zoomTo(j/100)}}),mxResources.get("zoom")+" (%)");this.editorUi.showDialog(h.container,300,80,true,true);h.init()}),null,null,"Ctrl+0"));this.addAction("pageScale...",mxUtils.bind(this,function(){var h=new FilenameDialog(this.editorUi,parseInt(e.pageScale*100),mxResources.get("apply"),mxUtils.bind(this,function(i){var j=parseInt(i);if(!isNaN(j)&&j>0){f.setPageScale(j/100)}}),mxResources.get("pageScale")+" (%)");this.editorUi.showDialog(h.container,300,80,true,true);h.init()}));var d=null;d=this.addAction("grid",function(){e.setGridEnabled(!e.isGridEnabled());f.fireEvent(new mxEventObject("gridEnabledChanged"))},null,null,"Ctrl+Shift+G");d.setToggleAction(true);d.setSelectedCallback(function(){return e.isGridEnabled()});d.setEnabled(false);d=this.addAction("guides",function(){e.graphHandler.guidesEnabled=!e.graphHandler.guidesEnabled;f.fireEvent(new mxEventObject("guidesEnabledChanged"))});d.setToggleAction(true);d.setSelectedCallback(function(){return e.graphHandler.guidesEnabled});d.setEnabled(false);d=this.addAction("tooltips",function(){e.tooltipHandler.setEnabled(!e.tooltipHandler.isEnabled())});d.setToggleAction(true);d.setSelectedCallback(function(){return e.tooltipHandler.isEnabled()});d=this.addAction("collapseExpand",function(){f.setFoldingEnabled(!e.foldingEnabled)});d.setToggleAction(true);d.setSelectedCallback(function(){return e.foldingEnabled});d.isEnabled=c;d=this.addAction("scrollbars",function(){f.setScrollbars(!f.hasScrollbars())});d.setToggleAction(true);d.setSelectedCallback(function(){return e.scrollbars});d=this.addAction("pageView",mxUtils.bind(this,function(){f.setPageVisible(!e.pageVisible)}));d.setToggleAction(true);d.setSelectedCallback(function(){return e.pageVisible});this.put("pageBackgroundColor",new Action(mxResources.get("backgroundColor")+"...",function(){f.pickColor(e.background||"none",function(h){f.setBackgroundColor(h)})}));d=this.addAction("connectionArrows",function(){e.connectionArrowsEnabled=!e.connectionArrowsEnabled;f.fireEvent(new mxEventObject("connectionArrowsChanged"))},null,null,"Ctrl+Q");d.setToggleAction(true);d.setSelectedCallback(function(){return e.connectionArrowsEnabled});d=this.addAction("connectionPoints",function(){e.setConnectable(!e.connectionHandler.isEnabled());f.fireEvent(new mxEventObject("connectionPointsChanged"))},null,null,"Ctrl+Shift+Q");d.setToggleAction(true);d.setSelectedCallback(function(){return e.connectionHandler.isEnabled()});d=this.addAction("copyConnect",function(){e.connectionHandler.setCreateTarget(!e.connectionHandler.isCreateTarget());f.fireEvent(new mxEventObject("copyConnectChanged"))});d.setToggleAction(true);d.setSelectedCallback(function(){return e.connectionHandler.isCreateTarget()});d.isEnabled=c;d=this.addAction("autosave",function(){f.editor.setAutosave(!f.editor.autosave)});d.setToggleAction(true);d.setSelectedCallback(function(){return f.editor.autosave});d.isEnabled=c;d.visible=false;this.addAction("help",function(){var h="";if(mxResources.isLanguageSupported(mxClient.language)){h="_"+mxClient.language}window.open(RESOURCES_PATH+"/help"+h+".html")});this.put("about",new Action(mxResources.get("about")+" Graph Editor...",function(){f.showDialog(new AboutDialog(f).container,320,280,true,true)},null,null,"F1"));var g=mxUtils.bind(this,function(i,k,j,h){return this.addAction(i,function(){if(j!=null&&e.cellEditor.isContentEditing()){j()}else{e.stopEditing(false);e.toggleCellStyleFlags(mxConstants.STYLE_FONTSTYLE,k)}},null,null,h)});g("bold",mxConstants.FONT_BOLD,function(){document.execCommand("bold",false,null)},"Ctrl+B");g("italic",mxConstants.FONT_ITALIC,function(){document.execCommand("italic",false,null)},"Ctrl+I");g("underline",mxConstants.FONT_UNDERLINE,function(){document.execCommand("underline",false,null)},"Ctrl+U");this.addAction("fontColor...",function(){f.menus.pickColor(mxConstants.STYLE_FONTCOLOR,"forecolor","000000")});this.addAction("strokeColor...",function(){f.menus.pickColor(mxConstants.STYLE_STROKECOLOR)});this.addAction("fillColor...",function(){f.menus.pickColor(mxConstants.STYLE_FILLCOLOR)});this.addAction("gradientColor...",function(){f.menus.pickColor(mxConstants.STYLE_GRADIENTCOLOR)});this.addAction("backgroundColor...",function(){f.menus.pickColor(mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,"backcolor")});this.addAction("borderColor...",function(){f.menus.pickColor(mxConstants.STYLE_LABEL_BORDERCOLOR)});this.addAction("vertical",function(){f.menus.toggleStyle(mxConstants.STYLE_HORIZONTAL,true)});this.addAction("shadow",function(){f.menus.toggleStyle(mxConstants.STYLE_SHADOW)});this.addAction("solid",function(){e.getModel().beginUpdate();try{e.setCellStyles(mxConstants.STYLE_DASHED,null);e.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null);f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",[null,null],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}});this.addAction("dashed",function(){e.getModel().beginUpdate();try{e.setCellStyles(mxConstants.STYLE_DASHED,"1");e.setCellStyles(mxConstants.STYLE_DASH_PATTERN,null);f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1",null],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}});this.addAction("dotted",function(){e.getModel().beginUpdate();try{e.setCellStyles(mxConstants.STYLE_DASHED,"1");e.setCellStyles(mxConstants.STYLE_DASH_PATTERN,"1 4");f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_DASHED,mxConstants.STYLE_DASH_PATTERN],"values",["1","1 4"],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}});this.addAction("sharp",function(){e.getModel().beginUpdate();try{e.setCellStyles(mxConstants.STYLE_ROUNDED,"0");e.setCellStyles(mxConstants.STYLE_CURVED,"0");f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","0"],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}});this.addAction("rounded",function(){e.getModel().beginUpdate();try{e.setCellStyles(mxConstants.STYLE_ROUNDED,"1");e.setCellStyles(mxConstants.STYLE_CURVED,"0");f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["1","0"],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}});this.addAction("toggleRounded",function(){if(!e.isSelectionEmpty()&&e.isEnabled()){e.getModel().beginUpdate();try{var h=e.getSelectionCells();var k=e.view.getState(h[0]);var i=(k!=null)?k.style:e.getCellStyle(h[0]);var j=(mxUtils.getValue(i,mxConstants.STYLE_ROUNDED,"0")=="1")?"0":"1";e.setCellStyles(mxConstants.STYLE_ROUNDED,j);e.setCellStyles(mxConstants.STYLE_CURVED,null);f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",[j,"0"],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}}});this.addAction("curved",function(){e.getModel().beginUpdate();try{e.setCellStyles(mxConstants.STYLE_ROUNDED,"0");e.setCellStyles(mxConstants.STYLE_CURVED,"1");f.fireEvent(new mxEventObject("styleChanged","keys",[mxConstants.STYLE_ROUNDED,mxConstants.STYLE_CURVED],"values",["0","1"],"cells",e.getSelectionCells()))}finally{e.getModel().endUpdate()}});this.addAction("collapsible",function(){var i=e.view.getState(e.getSelectionCell());var h="1";if(i!=null&&e.getFoldingImage(i)!=null){h="0"}e.setCellStyles("collapsible",h);f.fireEvent(new mxEventObject("styleChanged","keys",["collapsible"],"values",[h],"cells",e.getSelectionCells()))});this.addAction("editStyle...",mxUtils.bind(this,function(){var i=e.getSelectionCells();if(i!=null&&i.length>0){var h=e.getModel();var j=new TextareaDialog(this.editorUi,mxResources.get("editStyle")+":",h.getStyle(i[0])||"",function(k){if(k!=null){e.setCellStyle(mxUtils.trim(k),i)}},null,null,400,220);this.editorUi.showDialog(j.container,420,300,true,true);j.init()}}),null,null,"Ctrl+E");this.addAction("setAsDefaultStyle",function(){if(e.isEnabled()&&!e.isSelectionEmpty()){f.setDefaultStyle(e.getSelectionCell())}},null,null,"Ctrl+Shift+D");this.addAction("clearDefaultStyle",function(){if(e.isEnabled()){f.clearDefaultStyle()}},null,null,"Ctrl+Shift+R");this.addAction("addWaypoint",function(){var l=e.getSelectionCell();if(l!=null&&e.getModel().isEdge(l)){var m=b.graph.selectionCellsHandler.getHandler(l);if(m instanceof mxEdgeHandler){var n=e.view.translate;var p=e.view.scale;var q=n.x;var o=n.y;var k=e.getModel().getParent(l);var h=e.getCellGeometry(k);while(e.getModel().isVertex(k)&&h!=null){q+=h.x;o+=h.y;k=e.getModel().getParent(k);h=e.getCellGeometry(k)}var j=Math.round(e.snap(e.popupMenuHandler.triggerX/p-q));var i=Math.round(e.snap(e.popupMenuHandler.triggerY/p-o));m.addPointAt(m.state,j,i)}}});this.addAction("removeWaypoint",function(){var h=f.actions.get("removeWaypoint");if(h.handler!=null){h.handler.removePoint(h.handler.state,h.index)}});this.addAction("clearWaypoints",function(){var j=e.getSelectionCells();if(j!=null){j=e.addAllEdges(j);e.getModel().beginUpdate();try{for(var k=0;k<j.length;k++){var h=j[k];if(e.getModel().isEdge(h)){var l=e.getCellGeometry(h);if(l!=null){l=l.clone();l.points=null;e.getModel().setGeometry(h,l)}}}}finally{e.getModel().endUpdate()}}},null,null,"Alt+Shift+C");d=this.addAction("subscript",mxUtils.bind(this,function(){if(e.cellEditor.isContentEditing()){document.execCommand("subscript",false,null)}}),null,null,"Ctrl+,");d=this.addAction("superscript",mxUtils.bind(this,function(){if(e.cellEditor.isContentEditing()){document.execCommand("superscript",false,null)}}),null,null,"Ctrl+.");this.addAction("image...",function(){if(e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())){var k=mxResources.get("image")+" ("+mxResources.get("url")+"):";var j=e.getView().getState(e.getSelectionCell());var i="";if(j!=null){i=j.style[mxConstants.STYLE_IMAGE]||i}var h=e.cellEditor.saveSelection();f.showImageDialog(k,i,function(n,r,p){if(e.cellEditor.isContentEditing()){e.cellEditor.restoreSelection(h);e.insertImage(n,r,p)}else{var t=e.getSelectionCells();if(n!=null){var q=null;e.getModel().beginUpdate();try{if(t.length==0){var u=e.getFreeInsertPoint();t=[e.insertVertex(e.getDefaultParent(),null,"",u.x,u.y,r,p,"shape=image;imageAspect=0;aspect=fixed;verticalLabelPosition=bottom;verticalAlign=top;")];q=t}e.setCellStyles(mxConstants.STYLE_IMAGE,n,t);var l=e.view.getState(t[0]);var m=(l!=null)?l.style:e.getCellStyle(t[0]);if(m[mxConstants.STYLE_SHAPE]!="image"&&m[mxConstants.STYLE_SHAPE]!="label"){e.setCellStyles(mxConstants.STYLE_SHAPE,"image",t)}if(e.getSelectionCount()==1){if(r!=null&&p!=null){var s=t[0];var o=e.getModel().getGeometry(s);if(o!=null){o=o.clone();o.width=r;o.height=p;e.getModel().setGeometry(s,o)}}}}finally{e.getModel().endUpdate()}if(q!=null){e.setSelectionCells(q);e.scrollCellToVisible(q[0])}}}},e.cellEditor.isContentEditing(),!e.cellEditor.isContentEditing())}}).isEnabled=c;this.addAction("insertImage...",function(){if(e.isEnabled()&&!e.isCellLocked(e.getDefaultParent())){e.clearSelection();f.actions.get("image").funct()}}).isEnabled=c;d=this.addAction("layers",mxUtils.bind(this,function(){if(this.layersWindow==null){this.layersWindow=new LayersWindow(f,document.body.offsetWidth-280,120,220,180);this.layersWindow.window.addListener("show",function(){f.fireEvent(new mxEventObject("layers"))});this.layersWindow.window.addListener("hide",function(){f.fireEvent(new mxEventObject("layers"))});this.layersWindow.window.setVisible(true);f.fireEvent(new mxEventObject("layers"))}else{this.layersWindow.window.setVisible(!this.layersWindow.window.isVisible())}}),null,null,"Ctrl+Shift+L");d.setToggleAction(true);d.setSelectedCallback(mxUtils.bind(this,function(){return this.layersWindow!=null&&this.layersWindow.window.isVisible()}));d=this.addAction("formatPanel",mxUtils.bind(this,function(){f.toggleFormatPanel()}),null,null,"Ctrl+Shift+P");d.setToggleAction(true);d.setSelectedCallback(mxUtils.bind(this,function(){return f.formatWidth>0}));d=this.addAction("outline",mxUtils.bind(this,function(){if(this.outlineWindow==null){this.outlineWindow=new OutlineWindow(f,document.body.offsetWidth-260,100,180,180);this.outlineWindow.window.addListener("show",function(){f.fireEvent(new mxEventObject("outline"))});this.outlineWindow.window.addListener("hide",function(){f.fireEvent(new mxEventObject("outline"))});this.outlineWindow.window.setVisible(true);f.fireEvent(new mxEventObject("outline"))}else{this.outlineWindow.window.setVisible(!this.outlineWindow.window.isVisible())}f.fireEvent(new mxEventObject("outline"))}),null,null,"Ctrl+Shift+O");d.setToggleAction(true);d.setSelectedCallback(mxUtils.bind(this,function(){return this.outlineWindow!=null&&this.outlineWindow.window.isVisible()}))};Actions.prototype.addAction=function(e,b,c,d,a){var f;if(e.substring(e.length-3)=="..."){e=e.substring(0,e.length-3);f=mxResources.get(e)+"..."}else{f=mxResources.get(e)}return this.put(e,new Action(f,b,c,d,a))};Actions.prototype.put=function(a,b){this.actions[a]=b;return b};Actions.prototype.get=function(a){return this.actions[a]};function Action(d,b,c,e,a){mxEventSource.call(this);this.label=d;this.funct=b;this.enabled=(c!=null)?c:true;this.iconCls=e;this.shortcut=a;this.visible=true}mxUtils.extend(Action,mxEventSource);Action.prototype.setEnabled=function(a){if(this.enabled!=a){this.enabled=a;this.fireEvent(new mxEventObject("stateChanged"))}};Action.prototype.isEnabled=function(){return this.enabled};Action.prototype.setToggleAction=function(a){this.toggleAction=a};Action.prototype.setSelectedCallback=function(a){this.selectedCallback=a};Action.prototype.isSelected=function(){return this.selectedCallback()};