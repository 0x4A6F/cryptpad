EditorUi=function(e,q,c){mxEventSource.call(this);this.destroyFunctions=[];this.editor=e||new Editor();this.container=q||document.body;var b=this.editor.graph;b.lightbox=c;if(mxClient.IS_SVG){mxPopupMenu.prototype.submenuImage="data:image/gif;base64,R0lGODlhCQAJAIAAAP///zMzMyH5BAEAAAAALAAAAAAJAAkAAAIPhI8WebHsHopSOVgb26AAADs="}else{new Image().src=mxPopupMenu.prototype.submenuImage}if(!mxClient.IS_SVG&&mxConnectionHandler.prototype.connectImage!=null){new Image().src=mxConnectionHandler.prototype.connectImage.src}if(this.editor.chromeless){this.footerHeight=0;b.isEnabled=function(){return false};b.panningHandler.isForcePanningEvent=function(i){return !mxEvent.isPopupTrigger(i.getEvent())}}this.actions=new Actions(this);this.menus=this.createMenus();this.createDivs();this.createUi();this.refresh();var z=mxUtils.bind(this,function(i){if(i==null){i=window.event}return this.isSelectionAllowed(i)||b.isEditing()});if(this.container==document.body){this.menubarContainer.onselectstart=z;this.menubarContainer.onmousedown=z;this.toolbarContainer.onselectstart=z;this.toolbarContainer.onmousedown=z;this.diagramContainer.onselectstart=z;this.diagramContainer.onmousedown=z;this.sidebarContainer.onselectstart=z;this.sidebarContainer.onmousedown=z;this.formatContainer.onselectstart=z;this.formatContainer.onmousedown=z;this.footerContainer.onselectstart=z;this.footerContainer.onmousedown=z;if(this.tabContainer!=null){this.tabContainer.onselectstart=z}}if(!this.editor.chromeless){if(mxClient.IS_IE&&(typeof(document.documentMode)==="undefined"||document.documentMode<9)){mxEvent.addListener(this.diagramContainer,"contextmenu",z)}else{this.diagramContainer.oncontextmenu=z}}else{b.panningHandler.usePopupTrigger=false}b.init(this.diagramContainer);this.hoverIcons=this.createHoverIcons();mxEvent.addListener(this.diagramContainer,"mousemove",mxUtils.bind(this,function(i){var j=mxUtils.getOffset(this.diagramContainer);if(mxEvent.getClientX(i)-j.x-this.diagramContainer.clientWidth>0||mxEvent.getClientY(i)-j.y-this.diagramContainer.clientHeight>0){this.diagramContainer.setAttribute("title",mxResources.get("panTooltip"))}else{this.diagramContainer.removeAttribute("title")}}));var C=false;var o=this.hoverIcons.isResetEvent;this.hoverIcons.isResetEvent=function(i,j){return C||o.apply(this,arguments)};this.keydownHandler=mxUtils.bind(this,function(i){if(i.which==32){C=true;this.hoverIcons.reset();b.container.style.cursor="move";if(!b.isEditing()&&mxEvent.getSource(i)==b.container){mxEvent.consume(i)}}else{if(!mxEvent.isConsumed(i)&&i.keyCode==27){this.hideDialog()}}});mxEvent.addListener(document,"keydown",this.keydownHandler);this.keyupHandler=mxUtils.bind(this,function(i){b.container.style.cursor="";C=false});mxEvent.addListener(document,"keyup",this.keyupHandler);var A=b.panningHandler.isForcePanningEvent;b.panningHandler.isForcePanningEvent=function(i){return A.apply(this,arguments)||C||(mxEvent.isMouseEvent(i.getEvent())&&(this.usePopupTrigger||!mxEvent.isPopupTrigger(i.getEvent()))&&((!mxEvent.isControlDown(i.getEvent())&&mxEvent.isRightMouseButton(i.getEvent()))||mxEvent.isMiddleMouseButton(i.getEvent())))};var d=b.cellEditor.isStopEditingEvent;b.cellEditor.isStopEditingEvent=function(i){return d.apply(this,arguments)||(i.keyCode==13&&((!mxClient.IS_SF&&mxEvent.isControlDown(i))||(mxClient.IS_MAC&&mxEvent.isMetaDown(i))||(mxClient.IS_SF&&mxEvent.isShiftDown(i))))};var p=false;var t=null;var h=null;var u=null;var g=mxUtils.bind(this,function(){if(p!=b.cellEditor.isContentEditing()){var H=this.toolbar.container.firstChild;var j=[];while(H!=null){var E=H.nextSibling;if(mxUtils.indexOf(this.toolbar.staticElements,H)<0){H.parentNode.removeChild(H);j.push(H)}H=E}var G=this.toolbar.fontMenu;var F=this.toolbar.sizeMenu;if(u==null){this.toolbar.createTextToolbar()}else{for(var D=0;D<u.length;D++){this.toolbar.container.appendChild(u[D])}this.toolbar.fontMenu=t;this.toolbar.sizeMenu=h}p=b.cellEditor.isContentEditing();t=G;h=F;u=j}});var s=this;var f=b.cellEditor.startEditing;b.cellEditor.startEditing=function(){f.apply(this,arguments);g();if(b.cellEditor.isContentEditing()){var i=false;var j=function(){if(!i){i=true;window.setTimeout(function(){var G=b.getSelectedElement();var F=G;while(F!=null&&F.nodeType!=mxConstants.NODETYPE_ELEMENT){F=F.parentNode}if(F!=null){var E=mxUtils.getCurrentStyle(F);if(E!=null&&s.toolbar!=null){var D=E.fontFamily;if(D.charAt(0)=="'"){D=D.substring(1)}if(D.charAt(D.length-1)=="'"){D=D.substring(0,D.length-1)}s.toolbar.setFontName(D);s.toolbar.setFontSize(parseInt(E.fontSize))}}i=false},0)}};mxEvent.addListener(b.cellEditor.textarea,"input",j);mxEvent.addListener(b.cellEditor.textarea,"touchend",j);mxEvent.addListener(b.cellEditor.textarea,"mouseup",j);mxEvent.addListener(b.cellEditor.textarea,"keyup",j);j()}};var r=b.cellEditor.stopEditing;b.cellEditor.stopEditing=function(i,j){r.apply(this,arguments);g()};b.container.setAttribute("tabindex","0");b.container.style.cursor="default";if(window.self===window.top&&b.container.parentNode!=null){b.container.focus()}var k=b.fireMouseEvent;b.fireMouseEvent=function(D,j,i){if(D==mxEvent.MOUSE_DOWN){this.container.focus()}k.apply(this,arguments)};b.popupMenuHandler.autoExpand=true;if(this.menus!=null){b.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(D,i,j){this.menus.createPopupMenu(D,i,j)})}mxEvent.addGestureListeners(document,mxUtils.bind(this,function(i){b.popupMenuHandler.hideMenu()}));this.keyHandler=this.createKeyHandler(e);this.getKeyHandler=function(){return keyHandler};var m=["rounded","shadow","glass","dashed","dashPattern","comic","labelBackgroundColor"];var a=["shape","edgeStyle","curved","rounded","elbow","comic"];this.setDefaultStyle=function(M){var j=b.view.getState(M);if(j!=null){var H=M.clone();H.style="";var N=b.getCellStyle(H);var L=[];var O=[];for(var K in j.style){if(N[K]!=j.style[K]){L.push(j.style[K]);O.push(K)}}var D=b.getModel().getStyle(j.cell);var G=(D!=null)?D.split(";"):[];for(var F=0;F<G.length;F++){var E=G[F];var I=E.indexOf("=");if(I>=0){var K=E.substring(0,I);var J=E.substring(I+1);if(N[K]!=null&&J=="none"){L.push(J);O.push(K)}}}if(b.getModel().isEdge(j.cell)){b.currentEdgeStyle={}}else{b.currentVertexStyle={}}this.fireEvent(new mxEventObject("styleChanged","keys",O,"values",L,"cells",[j.cell]))}};this.clearDefaultStyle=function(){b.currentEdgeStyle=b.defaultEdgeStyle;b.currentVertexStyle={};this.fireEvent(new mxEventObject("styleChanged","keys",[],"values",[],"cells",[]))};var B=["fontFamily","fontSize","fontColor"];var v=["edgeStyle","startArrow","startFill","startSize","endArrow","endFill","endSize","jettySize","orthogonalLoop"];var n=[["startArrow","startFill","startSize","endArrow","endFill","endSize","jettySize","orthogonalLoop"],["strokeColor","strokeWidth"],["fillColor","gradientColor"],B,["align"],["html"]];for(var y=0;y<n.length;y++){for(var x=0;x<n[y].length;x++){m.push(n[y][x])}}for(var y=0;y<a.length;y++){m.push(a[y])}var w=function(E,N){b.getModel().beginUpdate();try{if(N){var G=b.getModel().isEdge(D);var O=(G)?b.currentEdgeStyle:b.currentVertexStyle;var U=["fontSize","fontFamily","fontColor"];for(var S=0;S<U.length;S++){var P=O[U[S]];if(P!=null){b.setCellStyles(U[S],P,E)}}}else{for(var T=0;T<E.length;T++){var D=E[T];var V=b.getModel().getStyle(D);var M=(V!=null)?V.split(";"):[];var K=m.slice();for(var S=0;S<M.length;S++){var W=M[S];var H=W.indexOf("=");if(H>=0){var X=W.substring(0,H);var I=mxUtils.indexOf(K,X);if(I>=0){K.splice(I,1)}for(var R=0;R<n.length;R++){var J=n[R];if(mxUtils.indexOf(J,X)>=0){for(var Q=0;Q<J.length;Q++){var F=mxUtils.indexOf(K,J[Q]);if(F>=0){K.splice(F,1)}}}}}}var G=b.getModel().isEdge(D);var O=(G)?b.currentEdgeStyle:b.currentVertexStyle;for(var S=0;S<K.length;S++){var X=K[S];var L=O[X];if(L!=null&&(X!="shape"||G)){if(!G||mxUtils.indexOf(a,X)<0){b.setCellStyles(X,L,[D])}}}}}}finally{b.getModel().endUpdate()}};b.addListener("cellsInserted",function(j,i){w(i.getProperty("cells"))});b.addListener("textInserted",function(j,i){w(i.getProperty("cells"),true)});b.connectionHandler.addListener(mxEvent.CONNECT,function(D,i){var j=[i.getProperty("cell")];if(i.getProperty("terminalInserted")){j.push(i.getProperty("terminal"))}w(j)});this.addListener("styleChanged",mxUtils.bind(this,function(E,M){var O=M.getProperty("cells");var H=false;var j=false;if(O.length>0){for(var F=0;F<O.length;F++){H=b.getModel().isVertex(O[F])||H;j=b.getModel().isEdge(O[F])||j;if(j&&H){break}}}else{H=true;j=true}var N=M.getProperty("keys");var L=M.getProperty("values");for(var F=0;F<N.length;F++){var I=mxUtils.indexOf(B,N[F])>=0;if(N[F]!="strokeColor"||(L[F]!=null&&L[F]!="none")){if(mxUtils.indexOf(a,N[F])>=0){if(j||mxUtils.indexOf(v,N[F])>=0){if(L[F]==null){delete b.currentEdgeStyle[N[F]]}else{b.currentEdgeStyle[N[F]]=L[F]}}else{if(H&&mxUtils.indexOf(m,N[F])>=0){if(L[F]==null){delete b.currentVertexStyle[N[F]]}else{b.currentVertexStyle[N[F]]=L[F]}}}}else{if(mxUtils.indexOf(m,N[F])>=0){if(H||I){if(L[F]==null){delete b.currentVertexStyle[N[F]]}else{b.currentVertexStyle[N[F]]=L[F]}}if(j||I||mxUtils.indexOf(v,N[F])>=0){if(L[F]==null){delete b.currentEdgeStyle[N[F]]}else{b.currentEdgeStyle[N[F]]=L[F]}}}}}}if(this.toolbar!=null){this.toolbar.setFontName(b.currentVertexStyle.fontFamily||Menus.prototype.defaultFont);this.toolbar.setFontSize(b.currentVertexStyle.fontSize||Menus.prototype.defaultFontSize);if(this.toolbar.edgeStyleMenu!=null){var J=this.toolbar.edgeStyleMenu.getElementsByTagName("div")[0];if(b.currentEdgeStyle.edgeStyle=="orthogonalEdgeStyle"&&b.currentEdgeStyle.curved=="1"){J.className="geSprite geSprite-curved"}else{if(b.currentEdgeStyle.edgeStyle=="straight"||b.currentEdgeStyle.edgeStyle=="none"||b.currentEdgeStyle.edgeStyle==null){J.className="geSprite geSprite-straight"}else{if(b.currentEdgeStyle.edgeStyle=="entityRelationEdgeStyle"){J.className="geSprite geSprite-entity"}else{if(b.currentEdgeStyle.edgeStyle=="elbowEdgeStyle"){J.className="geSprite geSprite-"+((b.currentEdgeStyle.elbow=="vertical")?"verticalelbow":"horizontalelbow")}else{if(b.currentEdgeStyle.edgeStyle=="isometricEdgeStyle"){J.className="geSprite geSprite-"+((b.currentEdgeStyle.elbow=="vertical")?"verticalisometric":"horizontalisometric")}else{J.className="geSprite geSprite-orthogonal"}}}}}}if(this.toolbar.edgeShapeMenu!=null){var G=this.toolbar.edgeShapeMenu.getElementsByTagName("div")[0];if(b.currentEdgeStyle.shape=="link"){G.className="geSprite geSprite-linkedge"}else{if(b.currentEdgeStyle.shape=="flexArrow"){G.className="geSprite geSprite-arrow"}else{if(b.currentEdgeStyle.shape=="arrow"){G.className="geSprite geSprite-simplearrow"}else{G.className="geSprite geSprite-connection"}}}}if(this.toolbar.lineStartMenu!=null){var K=this.toolbar.lineStartMenu.getElementsByTagName("div")[0];K.className=this.getCssClassForMarker("start",b.currentEdgeStyle.shape,b.currentEdgeStyle[mxConstants.STYLE_STARTARROW],mxUtils.getValue(b.currentEdgeStyle,"startFill","1"))}if(this.toolbar.lineEndMenu!=null){var D=this.toolbar.lineEndMenu.getElementsByTagName("div")[0];D.className=this.getCssClassForMarker("end",b.currentEdgeStyle.shape,b.currentEdgeStyle[mxConstants.STYLE_ENDARROW],mxUtils.getValue(b.currentEdgeStyle,"endFill","1"))}}}));if(this.toolbar!=null){var l=mxUtils.bind(this,function(){var j=b.currentVertexStyle.fontFamily||"Helvetica";var i=String(b.currentVertexStyle.fontSize||"12");var D=b.getView().getState(b.getSelectionCell());if(D!=null){j=D.style[mxConstants.STYLE_FONTFAMILY]||j;i=D.style[mxConstants.STYLE_FONTSIZE]||i;if(j.length>10){j=j.substring(0,8)+"..."}}this.toolbar.setFontName(j);this.toolbar.setFontSize(i)});b.getSelectionModel().addListener(mxEvent.CHANGE,l);b.getModel().addListener(mxEvent.CHANGE,l)}b.addListener(mxEvent.CELLS_ADDED,function(D,i){var j=i.getProperty("cells");var E=i.getProperty("parent");if(b.getModel().isLayer(E)&&!b.isCellVisible(E)&&j!=null&&j.length>0){b.getModel().setVisible(E,true)}});this.gestureHandler=mxUtils.bind(this,function(i){if(this.currentMenu!=null&&mxEvent.getSource(i)!=this.currentMenu.div){this.hideCurrentMenu()}});mxEvent.addGestureListeners(document,this.gestureHandler);this.resizeHandler=mxUtils.bind(this,function(){window.setTimeout(mxUtils.bind(this,function(){this.refresh()}),0)});mxEvent.addListener(window,"resize",this.resizeHandler);this.orientationChangeHandler=mxUtils.bind(this,function(){this.refresh()});mxEvent.addListener(window,"orientationchange",this.orientationChangeHandler);if(mxClient.IS_IOS&&!window.navigator.standalone){this.scrollHandler=mxUtils.bind(this,function(){window.scrollTo(0,0)});mxEvent.addListener(window,"scroll",this.scrollHandler)}this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){this.resetScrollbars()}));this.addListener("gridEnabledChanged",mxUtils.bind(this,function(){b.view.validateBackground()}));this.addListener("backgroundColorChanged",mxUtils.bind(this,function(){b.view.validateBackground()}));b.addListener("gridSizeChanged",mxUtils.bind(this,function(){if(b.isGridEnabled()){b.view.validateBackground()}}));this.editor.resetGraph();this.init();this.open()};mxUtils.extend(EditorUi,mxEventSource);EditorUi.compactUi=true;EditorUi.prototype.splitSize=(mxClient.IS_TOUCH||mxClient.IS_POINTER)?12:8;EditorUi.prototype.menubarHeight=30;EditorUi.prototype.formatEnabled=true;EditorUi.prototype.formatWidth=240;EditorUi.prototype.toolbarHeight=34;EditorUi.prototype.footerHeight=28;EditorUi.prototype.sidebarFooterHeight=34;EditorUi.prototype.editButtonLink=null;EditorUi.prototype.hsplitPosition=(screen.width<=500)?116:208;EditorUi.prototype.allowAnimation=true;EditorUi.prototype.init=function(){var b=this.editor.graph;mxEvent.addListener(b.container,"keydown",mxUtils.bind(this,function(d){if(d.which==9&&b.isEnabled()&&!mxEvent.isAltDown(d)){if(b.isEditing()){b.stopEditing(false)}else{b.selectCell(!mxEvent.isShiftDown(d))}mxEvent.consume(d)}}));mxEvent.addListener(b.container,"keypress",mxUtils.bind(this,function(d){if(this.isImmediateEditingEvent(d)&&!b.isEditing()&&!b.isSelectionEmpty()&&d.which!==0&&!mxEvent.isAltDown(d)&&!mxEvent.isControlDown(d)&&!mxEvent.isMetaDown(d)){b.escape();b.startEditing();if(mxClient.IS_FF){var g=b.cellEditor;g.textarea.innerHTML=String.fromCharCode(d.which);var e=document.createRange();e.selectNodeContents(g.textarea);e.collapse(false);var f=window.getSelection();f.removeAllRanges();f.addRange(e)}}}));this.addUndoListener();this.addBeforeUnloadListener();b.getSelectionModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));b.getModel().addListener(mxEvent.CHANGE,mxUtils.bind(this,function(){this.updateActionStates()}));var c=b.setDefaultParent;var a=this;this.editor.graph.setDefaultParent=function(){c.apply(this,arguments);a.updateActionStates()};b.editLink=a.actions.get("editLink").funct;this.updateActionStates();this.initClipboard();this.initCanvas();if(this.format!=null){this.format.init()}};EditorUi.prototype.isImmediateEditingEvent=function(a){return true};EditorUi.prototype.getCssClassForMarker=function(d,c,b,e){var a="";if(c=="flexArrow"){a=(b!=null&&b!=mxConstants.NONE)?"geSprite geSprite-"+d+"blocktrans":"geSprite geSprite-noarrow"}else{if(b==mxConstants.ARROW_CLASSIC){a=(e=="1")?"geSprite geSprite-"+d+"classic":"geSprite geSprite-"+d+"classictrans"}else{if(b==mxConstants.ARROW_CLASSIC_THIN){a=(e=="1")?"geSprite geSprite-"+d+"classicthin":"geSprite geSprite-"+d+"classicthintrans"}else{if(b==mxConstants.ARROW_OPEN){a="geSprite geSprite-"+d+"open"}else{if(b==mxConstants.ARROW_OPEN_THIN){a="geSprite geSprite-"+d+"openthin"}else{if(b==mxConstants.ARROW_BLOCK){a=(e=="1")?"geSprite geSprite-"+d+"block":"geSprite geSprite-"+d+"blocktrans"}else{if(b==mxConstants.ARROW_BLOCK_THIN){a=(e=="1")?"geSprite geSprite-"+d+"blockthin":"geSprite geSprite-"+d+"blockthintrans"}else{if(b==mxConstants.ARROW_OVAL){a=(e=="1")?"geSprite geSprite-"+d+"oval":"geSprite geSprite-"+d+"ovaltrans"}else{if(b==mxConstants.ARROW_DIAMOND){a=(e=="1")?"geSprite geSprite-"+d+"diamond":"geSprite geSprite-"+d+"diamondtrans"}else{if(b==mxConstants.ARROW_DIAMOND_THIN){a=(e=="1")?"geSprite geSprite-"+d+"thindiamond":"geSprite geSprite-"+d+"thindiamondtrans"}else{if(b=="openAsync"){a="geSprite geSprite-"+d+"openasync"}else{if(b=="dash"){a="geSprite geSprite-"+d+"dash"}else{if(b=="cross"){a="geSprite geSprite-"+d+"cross"}else{if(b=="async"){a=(e=="1")?"geSprite geSprite-"+d+"async":"geSprite geSprite-"+d+"asynctrans"}else{if(b=="circle"||b=="circlePlus"){a=(e=="1"||b=="circle")?"geSprite geSprite-"+d+"circle":"geSprite geSprite-"+d+"circleplus"}else{if(b=="ERone"){a="geSprite geSprite-"+d+"erone"}else{if(b=="ERmandOne"){a="geSprite geSprite-"+d+"eronetoone"}else{if(b=="ERmany"){a="geSprite geSprite-"+d+"ermany"}else{if(b=="ERoneToMany"){a="geSprite geSprite-"+d+"eronetomany"}else{if(b=="ERzeroToOne"){a="geSprite geSprite-"+d+"eroneopt"}else{if(b=="ERzeroToMany"){a="geSprite geSprite-"+d+"ermanyopt"}else{a="geSprite geSprite-noarrow"}}}}}}}}}}}}}}}}}}}}}return a};EditorUi.prototype.createMenus=function(){return null};EditorUi.prototype.updatePasteActionStates=function(){var c=this.editor.graph;var b=this.actions.get("paste");var a=this.actions.get("pasteHere");b.setEnabled(this.editor.graph.cellEditor.isContentEditing()||(!mxClipboard.isEmpty()&&c.isEnabled()&&!c.isCellLocked(c.getDefaultParent())));a.setEnabled(b.isEnabled())};EditorUi.prototype.initClipboard=function(){var d=this;var b=mxClipboard.cut;mxClipboard.cut=function(g){if(g.cellEditor.isContentEditing()){document.execCommand("cut",false,null)}else{b.apply(this,arguments)}d.updatePasteActionStates()};var e=mxClipboard.copy;mxClipboard.copy=function(g){if(g.cellEditor.isContentEditing()){document.execCommand("copy",false,null)}else{e.apply(this,arguments)}d.updatePasteActionStates()};var c=mxClipboard.paste;mxClipboard.paste=function(h){var g=null;if(h.cellEditor.isContentEditing()){document.execCommand("paste",false,null)}else{g=c.apply(this,arguments)}d.updatePasteActionStates();return g};var a=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){a.apply(this,arguments);d.updatePasteActionStates()};var f=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(g,h){f.apply(this,arguments);d.updatePasteActionStates()};this.updatePasteActionStates()};EditorUi.prototype.initCanvas=function(){var c=this.editor.graph;var c=this.editor.graph;c.timerAutoScroll=true;c.getPagePadding=function(){return new mxPoint(Math.max(0,Math.round((c.container.offsetWidth-34)/c.view.scale)),Math.max(0,Math.round((c.container.offsetHeight-34)/c.view.scale)))};c.view.getBackgroundPageBounds=function(){var w=this.graph.getPageLayout();var x=this.graph.getPageSize();return new mxRectangle(this.scale*(this.translate.x+w.x*x.width),this.scale*(this.translate.y+w.y*x.height),this.scale*w.width*x.width,this.scale*w.height*x.height)};c.getPreferredPageSize=function(A,z,x){var w=this.getPageLayout();var y=this.getPageSize();return new mxRectangle(0,0,w.width*y.width,w.height*y.height)};var s=null;if(this.editor.chromeless){s=mxUtils.bind(this,function(x){if(c.container!=null){var D=(c.pageVisible)?c.view.getBackgroundPageBounds():c.getGraphBounds();var A=c.view.translate;var H=c.view.scale;D=mxRectangle.fromRectangle(D);D.x=D.x/H-A.x;D.y=D.y/H-A.y;D.width/=H;D.height/=H;var F=c.container.scrollTop;var y=c.container.scrollLeft;var C=(mxClient.IS_QUIRKS||document.documentMode>=8)?20:14;if(document.documentMode==8||document.documentMode==9){C+=3}var z=c.container.offsetWidth-C;var w=c.container.offsetHeight-C;var B=(x)?Math.max(0.3,Math.min(1,z/D.width)):H;var G=Math.max((z-B*D.width)/2,0)/B;var E=Math.max((w-B*D.height)/4,0)/B;c.view.scaleAndTranslate(B,G-D.x,E-D.y);c.container.scrollTop=F*B/H;c.container.scrollLeft=y*B/H}});this.chromelessResize=s;var v=mxUtils.bind(this,function(){s(false)});mxEvent.addListener(window,"resize",v);this.destroyFunctions.push(function(){mxEvent.removeListener(window,"resize",v)});this.editor.addListener("resetGraphView",mxUtils.bind(this,function(){s(true)}));this.actions.get("zoomIn").funct=function(w){c.zoomIn();s(false)};this.actions.get("zoomOut").funct=function(w){c.zoomOut();s(false)};this.chromelessToolbar=document.createElement("div");this.chromelessToolbar.style.position="fixed";this.chromelessToolbar.style.overflow="hidden";this.chromelessToolbar.style.boxSizing="border-box";this.chromelessToolbar.style.whiteSpace="nowrap";this.chromelessToolbar.style.backgroundColor="#000000";this.chromelessToolbar.style.padding="10px 10px 8px 10px";this.chromelessToolbar.style.left="50%";mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"borderRadius","20px");mxUtils.setPrefixedStyle(this.chromelessToolbar.style,"transition","opacity 600ms ease-in-out");var l=mxUtils.bind(this,function(){var w=mxUtils.getCurrentStyle(c.container);this.chromelessToolbar.style.bottom=((w!=null)?parseInt(w["margin-bottom"]||0):0)+((this.tabContainer!=null)?(20+parseInt(this.tabContainer.style.height)):20)+"px"});this.editor.addListener("resetGraphView",l);l();var a=0;var n=mxUtils.bind(this,function(z,y,A){a++;var w=document.createElement("span");w.style.paddingLeft="8px";w.style.paddingRight="8px";w.style.cursor="pointer";mxEvent.addListener(w,"click",z);if(A!=null){w.setAttribute("title",A)}var x=document.createElement("img");x.setAttribute("border","0");x.setAttribute("src",y);w.appendChild(x);this.chromelessToolbar.appendChild(w);return w});var u=n(mxUtils.bind(this,function(w){this.actions.get("previousPage").funct();mxEvent.consume(w)}),Editor.previousLargeImage,mxResources.get("previousPage")||"Previous Page");var d=document.createElement("div");d.style.display="inline-block";d.style.verticalAlign="top";d.style.fontFamily="Helvetica,Arial";d.style.marginTop="8px";d.style.color="#ffffff";this.chromelessToolbar.appendChild(d);var i=n(mxUtils.bind(this,function(w){this.actions.get("nextPage").funct();mxEvent.consume(w)}),Editor.nextLargeImage,mxResources.get("nextPage")||"Next Page");var g=mxUtils.bind(this,function(){if(this.pages!=null&&this.pages.length>1&&this.currentPage!=null){d.innerHTML="";mxUtils.write(d,(mxUtils.indexOf(this.pages,this.currentPage)+1)+" / "+this.pages.length)}});u.style.paddingLeft="0px";u.style.paddingRight="4px";i.style.paddingLeft="4px";i.style.paddingRight="0px";var m=mxUtils.bind(this,function(){if(this.pages!=null&&this.pages.length>1&&this.currentPage!=null){i.style.display="";u.style.display="";d.style.display="inline-block"}else{i.style.display="none";u.style.display="none";d.style.display="none"}g()});this.editor.addListener("resetGraphView",m);this.editor.addListener("pageSelected",g);n(mxUtils.bind(this,function(w){this.actions.get("zoomOut").funct();mxEvent.consume(w)}),Editor.zoomOutLargeImage,(mxResources.get("zoomOut")||"Zoom Out")+" (Alt+Mousewheel)");n(mxUtils.bind(this,function(w){this.actions.get("zoomIn").funct();mxEvent.consume(w)}),Editor.zoomInLargeImage,(mxResources.get("zoomIn")||"Zoom In")+" (Alt+Mousewheel)");n(mxUtils.bind(this,function(w){if(c.lightbox){if(c.view.scale==1){this.lightboxFit()}else{c.zoomTo(1)}s(false)}else{s(true)}mxEvent.consume(w)}),Editor.actualSizeLargeImage,mxResources.get("fit")||"Fit");var h=null;var p=null;var b=mxUtils.bind(this,function(w){if(h!=null){window.clearTimeout(h);fadeThead=null}if(p!=null){window.clearTimeout(p);fadeThead2=null}h=window.setTimeout(mxUtils.bind(this,function(){mxUtils.setOpacity(this.chromelessToolbar,0);h=null;p=window.setTimeout(mxUtils.bind(this,function(){this.chromelessToolbar.style.display="none";p=null}),600)}),w||200)});var k=mxUtils.bind(this,function(w){if(h!=null){window.clearTimeout(h);fadeThead=null}if(p!=null){window.clearTimeout(p);fadeThead2=null}this.chromelessToolbar.style.display="";mxUtils.setOpacity(this.chromelessToolbar,w||30)});if(urlParams.layers=="1"){this.layersDialog=null;var r=n(mxUtils.bind(this,function(w){if(this.layersDialog!=null){this.layersDialog.parentNode.removeChild(this.layersDialog);this.layersDialog=null}else{this.layersDialog=c.createLayersDialog();mxEvent.addListener(this.layersDialog,"mouseleave",mxUtils.bind(this,function(){this.layersDialog.parentNode.removeChild(this.layersDialog);this.layersDialog=null}));var y=r.getBoundingClientRect();mxUtils.setPrefixedStyle(this.layersDialog.style,"borderRadius","5px");this.layersDialog.style.position="fixed";this.layersDialog.style.fontFamily="Helvetica,Arial";this.layersDialog.style.backgroundColor="#000000";this.layersDialog.style.width="160px";this.layersDialog.style.padding="4px 2px 4px 2px";this.layersDialog.style.color="#ffffff";mxUtils.setOpacity(this.layersDialog,70);this.layersDialog.style.left=y.left+"px";this.layersDialog.style.bottom=parseInt(this.chromelessToolbar.style.bottom)+this.chromelessToolbar.offsetHeight+4+"px";var x=mxUtils.getCurrentStyle(this.editor.graph.container);this.layersDialog.style.zIndex=x.zIndex;document.body.appendChild(this.layersDialog)}mxEvent.consume(w)}),Editor.layersLargeImage,mxResources.get("layers")||"Layers");var e=c.getModel();e.addListener(mxEvent.CHANGE,function(){r.style.display=(e.getChildCount(e.root)>1)?"":"none"})}if(this.editor.editButtonLink!=null){n(mxUtils.bind(this,function(w){if(this.editor.editButtonLink=="_blank"){this.editor.editAsNew(this.getEditBlankXml(),null,true)}else{window.open(this.editor.editButtonLink,"editWindow")}mxEvent.consume(w)}),Editor.editLargeImage,mxResources.get("openInNewWindow")||"Open in New Window")}if(c.lightbox&&this.container!=document.body){n(mxUtils.bind(this,function(w){if(urlParams.close=="1"){window.close()}else{this.destroy();mxEvent.consume(w)}}),Editor.closeLargeImage,(mxResources.get("close")||"Close")+" (Escape)")}this.chromelessToolbar.style.display="none";c.container.appendChild(this.chromelessToolbar);this.chromelessToolbar.style.marginLeft=-(a*24+10)+"px";this.addChromelessClickHandler();mxEvent.addListener(c.container,(mxClient.IS_POINTER)?"pointermove":"mousemove",mxUtils.bind(this,function(w){if(!mxEvent.isTouchEvent(w)){if(!mxEvent.isShiftDown(w)){k(30)}b()}}));mxEvent.addListener(this.chromelessToolbar,(mxClient.IS_POINTER)?"pointermove":"mousemove",function(w){mxEvent.consume(w)});mxEvent.addListener(this.chromelessToolbar,"mouseenter",mxUtils.bind(this,function(w){if(!mxEvent.isShiftDown(w)){k(100)}else{b()}}));mxEvent.addListener(this.chromelessToolbar,"mousemove",mxUtils.bind(this,function(w){if(!mxEvent.isShiftDown(w)){k(100)}else{b()}mxEvent.consume(w)}));mxEvent.addListener(this.chromelessToolbar,"mouseleave",mxUtils.bind(this,function(w){if(!mxEvent.isTouchEvent(w)){k(30)}}));var o=c.getTolerance();var j=this;c.addMouseListener({startX:0,startY:0,scrollLeft:0,scrollTop:0,mouseDown:function(w,x){this.startX=x.getGraphX();this.startY=x.getGraphY();this.scrollLeft=c.container.scrollLeft;this.scrollTop=c.container.scrollTop},mouseMove:function(w,x){},mouseUp:function(w,x){if(mxEvent.isTouchEvent(x.getEvent())){if((Math.abs(this.scrollLeft-c.container.scrollLeft)<o&&Math.abs(this.scrollTop-c.container.scrollTop)<o)&&(Math.abs(this.startX-x.getGraphX())<o&&Math.abs(this.startY-x.getGraphY())<o)){if(parseFloat(j.chromelessToolbar.style.opacity||0)>0){b()}else{k(30)}}}}})}else{if(this.editor.extendCanvas){var t=c.view.validate;c.view.validate=function(){if(this.graph.container!=null&&mxUtils.hasScrollbars(this.graph.container)){var z=this.graph.getPagePadding();var y=this.graph.getPageSize();var x=this.translate.x;var w=this.translate.y;this.translate.x=z.x-(this.x0||0)*y.width;this.translate.y=z.y-(this.y0||0)*y.height}t.apply(this,arguments)};var f=c.sizeDidChange;c.sizeDidChange=function(){if(this.container!=null&&mxUtils.hasScrollbars(this.container)){var w=this.getPageLayout();var x=this.getPagePadding();var E=this.getPageSize();var C=Math.ceil(2*x.x+w.width*E.width);var B=Math.ceil(2*x.y+w.height*E.height);var z=c.minimumGraphSize;if(z==null||z.width!=C||z.height!=B){c.minimumGraphSize=new mxRectangle(0,0,C,B)}var F=x.x-w.x*E.width;var D=x.y-w.y*E.height;if(!this.autoTranslate&&(this.view.translate.x!=F||this.view.translate.y!=D)){this.autoTranslate=true;this.view.x0=w.x;this.view.y0=w.y;var A=c.view.translate.x;var y=c.view.translate.y;c.view.setTranslate(F,D);c.container.scrollLeft+=Math.round((F-A)*c.view.scale);c.container.scrollTop+=Math.round((D-y)*c.view.scale);this.autoTranslate=false;return}f.apply(this,arguments)}}}}c.updateZoomTimeout=null;c.cumulativeZoomFactor=1;var q=null;c.lazyZoom=function(w){if(this.updateZoomTimeout!=null){window.clearTimeout(this.updateZoomTimeout)}if(w){if(this.view.scale*this.cumulativeZoomFactor<0.15){this.cumulativeZoomFactor=(this.view.scale+0.01)/this.view.scale}else{this.cumulativeZoomFactor*=this.zoomFactor;this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale}}else{if(this.view.scale*this.cumulativeZoomFactor<=0.15){this.cumulativeZoomFactor=(this.view.scale-0.01)/this.view.scale}else{this.cumulativeZoomFactor/=this.zoomFactor;this.cumulativeZoomFactor=Math.round(this.view.scale*this.cumulativeZoomFactor*20)/20/this.view.scale}}this.cumulativeZoomFactor=Math.max(0.01,Math.min(this.view.scale*this.cumulativeZoomFactor,160)/this.view.scale);this.updateZoomTimeout=window.setTimeout(mxUtils.bind(this,function(){this.zoom(this.cumulativeZoomFactor);if(s!=null){s(false)}if(q!=null&&mxUtils.hasScrollbars(c.container)){var z=mxUtils.getOffset(c.container);var y=c.container.offsetWidth/2-q.x+z.x;var x=c.container.offsetHeight/2-q.y+z.y;c.container.scrollLeft-=y*(this.cumulativeZoomFactor-1);c.container.scrollTop-=x*(this.cumulativeZoomFactor-1)}this.cumulativeZoomFactor=1;this.updateZoomTimeout=null}),20)};mxEvent.addMouseWheelListener(mxUtils.bind(this,function(x,w){if((mxEvent.isAltDown(x)||(mxEvent.isControlDown(x)&&!mxClient.IS_MAC)||c.panningHandler.isActive())&&(this.dialogs==null||this.dialogs.length==0)){var y=mxEvent.getSource(x);while(y!=null){if(y==c.container){q=new mxPoint(mxEvent.getClientX(x),mxEvent.getClientY(x));c.lazyZoom(w);mxEvent.consume(x);return}y=y.parentNode}}}))};EditorUi.prototype.createTemporaryGraph=function(a){var b=new Graph(document.createElement("div"),null,null,a);b.resetViewOnRootChange=false;b.setConnectable(false);b.gridEnabled=false;b.autoScroll=false;b.setTooltips(false);b.setEnabled(false);b.container.style.visibility="hidden";b.container.style.position="absolute";b.container.style.overflow="hidden";b.container.style.height="1px";b.container.style.width="1px";return b};EditorUi.prototype.addChromelessClickHandler=function(){var a=urlParams.highlight;if(a!=null&&a.length>0){a="#"+a}this.editor.graph.addClickHandler(a)};EditorUi.prototype.toggleFormatPanel=function(a){this.formatWidth=(a||this.formatWidth>0)?0:240;this.formatContainer.style.display=(a||this.formatWidth>0)?"":"none";this.refresh();this.format.refresh();this.fireEvent(new mxEventObject("formatWidthChanged"))};EditorUi.prototype.lightboxFit=function(){this.editor.graph.maxFitScale=2;this.editor.graph.fit(60);this.editor.graph.maxFitScale=null};EditorUi.prototype.isSelectionAllowed=function(a){return mxEvent.getSource(a).nodeName=="SELECT"||(mxEvent.getSource(a).nodeName=="INPUT"&&mxUtils.isAncestorNode(this.formatContainer,mxEvent.getSource(a)))};EditorUi.prototype.addBeforeUnloadListener=function(){window.onbeforeunload=mxUtils.bind(this,function(){if(!this.editor.chromeless){return this.onBeforeUnload()}})};EditorUi.prototype.onBeforeUnload=function(){if(this.editor.modified){return mxResources.get("allChangesLost")}};EditorUi.prototype.open=function(){try{if(window.opener!=null&&window.opener.openFile!=null){window.opener.openFile.setConsumer(mxUtils.bind(this,function(c,b){try{var f=mxUtils.parseXml(c);this.editor.setGraphXml(f.documentElement);this.editor.setModified(false);this.editor.undoManager.clear();if(b!=null){this.editor.setFilename(b);this.updateDocumentTitle()}return}catch(d){mxUtils.alert(mxResources.get("invalidOrMissingFile")+": "+d.message)}}))}}catch(a){}this.editor.graph.view.validate();this.editor.graph.sizeDidChange();this.editor.fireEvent(new mxEventObject("resetGraphView"))};EditorUi.prototype.setCurrentMenu=function(b,a){this.currentMenuElt=a;this.currentMenu=b};EditorUi.prototype.resetCurrentMenu=function(){this.currentMenuElt=null;this.currentMenu=null};EditorUi.prototype.hideCurrentMenu=function(b,a){if(this.currentMenu!=null){this.currentMenu.hideMenu();this.resetCurrentMenu()}};EditorUi.prototype.updateDocumentTitle=function(){var a=this.editor.getOrCreateFilename();if(this.editor.appName!=null){a+=" - "+this.editor.appName}document.title=a};EditorUi.prototype.createHoverIcons=function(){return new HoverIcons(this.editor.graph)};EditorUi.prototype.redo=function(){try{var a=this.editor.graph;if(a.isEditing()){document.execCommand("redo",false,null)}else{this.editor.undoManager.redo()}}catch(b){}};EditorUi.prototype.undo=function(){try{var b=this.editor.graph;if(b.isEditing()){var a=b.cellEditor.textarea.innerHTML;document.execCommand("undo",false,null);if(a==b.cellEditor.textarea.innerHTML){b.stopEditing(true);this.editor.undoManager.undo()}}else{this.editor.undoManager.undo()}}catch(c){}};EditorUi.prototype.canRedo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canRedo()};EditorUi.prototype.canUndo=function(){return this.editor.graph.isEditing()||this.editor.undoManager.canUndo()};EditorUi.prototype.getEditBlankXml=function(){return mxUtils.getXml(this.getGraphXml())};EditorUi.prototype.getUrl=function(d){var a=(d!=null)?d:window.location.pathname;var c=(a.indexOf("?")>0)?1:0;for(var b in urlParams){if(c==0){a+="?"}else{a+="&"}a+=b+"="+urlParams[b];c++}return a};EditorUi.prototype.setScrollbars=function(f){var e=this.editor.graph;var d=e.container.style.overflow;e.scrollbars=f;this.editor.updateGraphComponents();if(d!=e.container.style.overflow){if(e.container.style.overflow=="hidden"){var c=e.view.translate;e.view.setTranslate(c.x-e.container.scrollLeft/e.view.scale,c.y-e.container.scrollTop/e.view.scale);e.container.scrollLeft=0;e.container.scrollTop=0;e.minimumGraphSize=null;e.sizeDidChange()}else{var b=e.view.translate.x;var a=e.view.translate.y;e.view.translate.x=0;e.view.translate.y=0;e.sizeDidChange();e.container.scrollLeft-=Math.round(b*e.view.scale);e.container.scrollTop-=Math.round(a*e.view.scale)}}this.fireEvent(new mxEventObject("scrollbarsChanged"))};EditorUi.prototype.hasScrollbars=function(){return this.editor.graph.scrollbars};EditorUi.prototype.resetScrollbars=function(){var f=this.editor.graph;if(!this.editor.extendCanvas){f.container.scrollTop=0;f.container.scrollLeft=0;if(!mxUtils.hasScrollbars(f.container)){f.view.setTranslate(0,0)}}else{if(!this.editor.chromeless){if(mxUtils.hasScrollbars(f.container)){if(f.pageVisible){var g=f.getPagePadding();f.container.scrollTop=Math.floor(g.y-this.editor.initialTopSpacing);f.container.scrollLeft=Math.floor(Math.min(g.x,(f.container.scrollWidth-f.container.clientWidth)/2));var e=f.getGraphBounds();if(e.width>0&&e.height>0){if(e.x>f.container.scrollLeft+f.container.clientWidth*0.9){f.container.scrollLeft=Math.min(e.x+e.width-f.container.clientWidth,e.x-10)}if(e.y>f.container.scrollTop+f.container.clientHeight*0.9){f.container.scrollTop=Math.min(e.y+e.height-f.container.clientHeight,e.y-10)}}}else{var e=f.getGraphBounds();var d=Math.max(e.width,f.scrollTileSize.width*f.view.scale);var c=Math.max(e.height,f.scrollTileSize.height*f.view.scale);f.container.scrollTop=Math.floor(Math.max(0,e.y-Math.max(20,(f.container.clientHeight-c)/4)));f.container.scrollLeft=Math.floor(Math.max(0,e.x-Math.max(0,(f.container.clientWidth-d)/2)))}}else{if(f.pageVisible){var a=f.view.getBackgroundPageBounds();f.view.setTranslate(Math.floor(Math.max(0,(f.container.clientWidth-a.width)/2)-a.x),Math.floor(Math.max(0,(f.container.clientHeight-a.height)/2)-a.y))}else{var e=f.getGraphBounds();f.view.setTranslate(Math.floor(Math.max(0,Math.max(0,(f.container.clientWidth-e.width)/2)-e.x)),Math.floor(Math.max(0,Math.max(20,(f.container.clientHeight-e.height)/4))-e.y))}}}}};EditorUi.prototype.setPageVisible=function(e){var d=this.editor.graph;var f=mxUtils.hasScrollbars(d.container);var b=0;var a=0;if(f){b=d.view.translate.x*d.view.scale-d.container.scrollLeft;a=d.view.translate.y*d.view.scale-d.container.scrollTop}d.pageVisible=e;d.pageBreaksVisible=e;d.preferPageSize=e;d.view.validateBackground();if(f){var c=d.getSelectionCells();d.clearSelection();d.setSelectionCells(c)}d.sizeDidChange();if(f){d.container.scrollLeft=d.view.translate.x*d.view.scale-b;d.container.scrollTop=d.view.translate.y*d.view.scale-a}this.fireEvent(new mxEventObject("pageViewChanged"))};EditorUi.prototype.setBackgroundColor=function(a){this.editor.graph.background=a;this.editor.graph.view.validateBackground();this.fireEvent(new mxEventObject("backgroundColorChanged"))};EditorUi.prototype.setFoldingEnabled=function(a){this.editor.graph.foldingEnabled=a;this.editor.graph.view.revalidate();this.fireEvent(new mxEventObject("foldingEnabledChanged"))};EditorUi.prototype.setPageFormat=function(a){this.editor.graph.pageFormat=a;if(!this.editor.graph.pageVisible){this.actions.get("pageView").funct()}else{this.editor.graph.view.validateBackground();this.editor.graph.sizeDidChange()}this.fireEvent(new mxEventObject("pageFormatChanged"))};EditorUi.prototype.setPageScale=function(a){this.editor.graph.pageScale=a;if(!this.editor.graph.pageVisible){this.actions.get("pageView").funct()}else{this.editor.graph.view.validateBackground();this.editor.graph.sizeDidChange()}this.fireEvent(new mxEventObject("pageScaleChanged"))};EditorUi.prototype.setGridColor=function(a){this.editor.graph.view.gridColor=a;this.editor.graph.view.validateBackground();this.fireEvent(new mxEventObject("gridColorChanged"))};EditorUi.prototype.addUndoListener=function(){var b=this.actions.get("undo");var c=this.actions.get("redo");var e=this.editor.undoManager;var d=mxUtils.bind(this,function(){b.setEnabled(this.canUndo());c.setEnabled(this.canRedo())});e.addListener(mxEvent.ADD,d);e.addListener(mxEvent.UNDO,d);e.addListener(mxEvent.REDO,d);e.addListener(mxEvent.CLEAR,d);var a=this.editor.graph.cellEditor.startEditing;this.editor.graph.cellEditor.startEditing=function(){a.apply(this,arguments);d()};var f=this.editor.graph.cellEditor.stopEditing;this.editor.graph.cellEditor.stopEditing=function(g,h){f.apply(this,arguments);d()};d()};EditorUi.prototype.updateActionStates=function(){var j=this.editor.graph;var c=!j.isSelectionEmpty();var k=false;var d=false;var l=j.getSelectionCells();if(l!=null){for(var e=0;e<l.length;e++){var h=l[e];if(j.getModel().isEdge(h)){d=true}if(j.getModel().isVertex(h)){k=true}if(d&&k){break}}}var b=["cut","copy","bold","italic","underline","delete","duplicate","editStyle","editTooltip","editLink","backgroundColor","borderColor","edit","toFront","toBack","lockUnlock","solid","dashed","dotted","fillColor","gradientColor","shadow","fontColor","formattedText","rounded","toggleRounded","sharp","strokeColor"];for(var e=0;e<b.length;e++){this.actions.get(b[e]).setEnabled(c)}this.actions.get("setAsDefaultStyle").setEnabled(j.getSelectionCount()==1);this.actions.get("clearWaypoints").setEnabled(!j.isSelectionEmpty());this.actions.get("turn").setEnabled(!j.isSelectionEmpty());this.actions.get("curved").setEnabled(d);this.actions.get("rotation").setEnabled(k);this.actions.get("wordWrap").setEnabled(k);this.actions.get("autosize").setEnabled(k);this.actions.get("collapsible").setEnabled(k);var g=k&&j.getSelectionCount()==1;this.actions.get("group").setEnabled(j.getSelectionCount()>1||(g&&!j.isContainer(j.getSelectionCell())));this.actions.get("ungroup").setEnabled(j.getSelectionCount()==1&&(j.getModel().getChildCount(j.getSelectionCell())>0||(g&&j.isContainer(j.getSelectionCell()))));this.actions.get("removeFromGroup").setEnabled(g&&j.getModel().isVertex(j.getModel().getParent(j.getSelectionCell())));var a=j.view.getState(j.getSelectionCell());this.menus.get("navigation").setEnabled(c||j.view.currentRoot!=null);this.actions.get("collapsible").setEnabled(k&&j.getSelectionCount()==1&&(j.isContainer(j.getSelectionCell())||j.model.getChildCount(j.getSelectionCell())>0));this.actions.get("home").setEnabled(j.view.currentRoot!=null);this.actions.get("exitGroup").setEnabled(j.view.currentRoot!=null);this.actions.get("enterGroup").setEnabled(j.getSelectionCount()==1&&j.isValidRoot(j.getSelectionCell()));var f=j.getSelectionCount()==1&&j.isCellFoldable(j.getSelectionCell());this.actions.get("expand").setEnabled(f);this.actions.get("collapse").setEnabled(f);this.actions.get("editLink").setEnabled(j.getSelectionCount()==1);this.actions.get("openLink").setEnabled(j.getSelectionCount()==1&&j.getLinkForCell(j.getSelectionCell())!=null);this.actions.get("guides").setEnabled(j.isEnabled());this.actions.get("grid").setEnabled(!this.editor.chromeless);var m=j.isEnabled()&&!j.isCellLocked(j.getDefaultParent());this.menus.get("layout").setEnabled(m);this.menus.get("insert").setEnabled(m);this.menus.get("direction").setEnabled(m&&k);this.menus.get("align").setEnabled(m&&k&&j.getSelectionCount()>1);this.menus.get("distribute").setEnabled(m&&k&&j.getSelectionCount()>1);this.actions.get("selectVertices").setEnabled(m);this.actions.get("selectEdges").setEnabled(m);this.actions.get("selectAll").setEnabled(m);this.actions.get("selectNone").setEnabled(m);this.updatePasteActionStates()};EditorUi.prototype.refresh=function(b){b=(b!=null)?b:true;var k=mxClient.IS_IE&&(document.documentMode==null||document.documentMode==5);var n=this.container.clientWidth;var j=this.container.clientHeight;if(this.container==document.body){n=document.body.clientWidth||document.documentElement.clientWidth;j=(k)?document.body.clientHeight||document.documentElement.clientHeight:document.documentElement.clientHeight}var f=0;if(mxClient.IS_IOS&&!window.navigator.standalone){if(window.innerHeight!=document.documentElement.clientHeight){f=document.documentElement.clientHeight-window.innerHeight;window.scrollTo(0,0)}}var l=Math.max(0,Math.min(this.hsplitPosition,n-this.splitSize-20));var i=0;if(this.menubar!=null){this.menubarContainer.style.height=this.menubarHeight+"px";i+=this.menubarHeight}if(this.toolbar!=null){this.toolbarContainer.style.top=this.menubarHeight+"px";this.toolbarContainer.style.height=this.toolbarHeight+"px";i+=this.toolbarHeight}if(i>0&&!mxClient.IS_QUIRKS){i+=1}var m=0;if(this.sidebarFooterContainer!=null){var a=this.footerHeight+f;m=Math.max(0,Math.min(j-i-a,this.sidebarFooterHeight));this.sidebarFooterContainer.style.width=l+"px";this.sidebarFooterContainer.style.height=m+"px";this.sidebarFooterContainer.style.bottom=a+"px"}var g=(this.format!=null)?this.formatWidth:0;this.sidebarContainer.style.top=i+"px";this.sidebarContainer.style.width=l+"px";this.formatContainer.style.top=i+"px";this.formatContainer.style.width=g+"px";this.formatContainer.style.display=(this.format!=null)?"":"none";this.diagramContainer.style.left=(this.hsplit.parentNode!=null)?(l+this.splitSize)+"px":"0px";this.diagramContainer.style.top=this.sidebarContainer.style.top;this.footerContainer.style.height=this.footerHeight+"px";this.hsplit.style.top=this.sidebarContainer.style.top;this.hsplit.style.bottom=(this.footerHeight+f)+"px";this.hsplit.style.left=l+"px";if(this.tabContainer!=null){this.tabContainer.style.left=this.diagramContainer.style.left}if(k){this.menubarContainer.style.width=n+"px";this.toolbarContainer.style.width=this.menubarContainer.style.width;var e=Math.max(0,j-this.footerHeight-this.menubarHeight-this.toolbarHeight);this.sidebarContainer.style.height=(e-m)+"px";this.formatContainer.style.height=e+"px";this.diagramContainer.style.width=(this.hsplit.parentNode!=null)?Math.max(0,n-l-this.splitSize-g)+"px":n+"px";this.footerContainer.style.width=this.menubarContainer.style.width;var d=Math.max(0,j-this.footerHeight-this.menubarHeight-this.toolbarHeight);if(this.tabContainer!=null){this.tabContainer.style.width=this.diagramContainer.style.width;this.tabContainer.style.bottom=(this.footerHeight+f)+"px";d-=this.tabContainer.clientHeight}this.diagramContainer.style.height=d+"px";this.hsplit.style.height=d+"px"}else{if(this.footerHeight>0){this.footerContainer.style.bottom=f+"px"}this.diagramContainer.style.right=g+"px";var c=0;if(this.tabContainer!=null){this.tabContainer.style.bottom=(this.footerHeight+f)+"px";this.tabContainer.style.right=this.diagramContainer.style.right;c=this.tabContainer.clientHeight}this.sidebarContainer.style.bottom=(this.footerHeight+m+f)+"px";this.formatContainer.style.bottom=(this.footerHeight+f)+"px";this.diagramContainer.style.bottom=(this.footerHeight+f+c)+"px"}if(b){this.editor.graph.sizeDidChange()}};EditorUi.prototype.createTabContainer=function(){return null};EditorUi.prototype.createDivs=function(){this.menubarContainer=this.createDiv("geMenubarContainer");this.toolbarContainer=this.createDiv("geToolbarContainer");this.sidebarContainer=this.createDiv("geSidebarContainer");this.formatContainer=this.createDiv("geSidebarContainer");this.diagramContainer=this.createDiv("geDiagramContainer");this.footerContainer=this.createDiv("geFooterContainer");this.hsplit=this.createDiv("geHsplit");this.hsplit.setAttribute("title",mxResources.get("collapseExpand"));this.menubarContainer.style.top="0px";this.menubarContainer.style.left="0px";this.menubarContainer.style.right="0px";this.toolbarContainer.style.left="0px";this.toolbarContainer.style.right="0px";this.sidebarContainer.style.left="0px";this.formatContainer.style.right="0px";this.formatContainer.style.zIndex="1";this.diagramContainer.style.right=((this.format!=null)?this.formatWidth:0)+"px";this.footerContainer.style.left="0px";this.footerContainer.style.right="0px";this.footerContainer.style.bottom="0px";this.footerContainer.style.zIndex=mxPopupMenu.prototype.zIndex-2;this.hsplit.style.width=this.splitSize+"px";this.formatContainer.style.backgroundColor="whiteSmoke";this.formatContainer.style.overflowX="hidden";this.formatContainer.style.overflowY="auto";this.formatContainer.style.fontSize="12px";this.sidebarFooterContainer=this.createSidebarFooterContainer();if(this.sidebarFooterContainer){this.sidebarFooterContainer.style.left="0px"}if(!this.editor.chromeless){this.tabContainer=this.createTabContainer()}};EditorUi.prototype.createSidebarFooterContainer=function(){return null};EditorUi.prototype.createUi=function(){this.menubar=(this.editor.chromeless)?null:this.menus.createMenubar(this.createDiv("geMenubar"));if(this.menubar!=null){this.menubarContainer.appendChild(this.menubar.container)}if(this.menubar!=null){this.statusContainer=this.createStatusContainer();this.editor.addListener("statusChanged",mxUtils.bind(this,function(){this.setStatusText(this.editor.getStatus())}));this.setStatusText(this.editor.getStatus());this.menubar.container.appendChild(this.statusContainer);this.container.appendChild(this.menubarContainer)}this.sidebar=(this.editor.chromeless)?null:this.createSidebar(this.sidebarContainer);if(this.sidebar!=null){this.container.appendChild(this.sidebarContainer)}this.format=(this.editor.chromeless||!this.formatEnabled)?null:this.createFormat(this.formatContainer);if(this.format!=null){this.container.appendChild(this.formatContainer)}var a=(this.editor.chromeless)?null:this.createFooter();if(a!=null){this.footerContainer.appendChild(a);this.container.appendChild(this.footerContainer)}if(this.sidebar!=null&&this.sidebarFooterContainer){this.container.appendChild(this.sidebarFooterContainer)}this.container.appendChild(this.diagramContainer);if(this.container!=null&&this.tabContainer!=null){this.container.appendChild(this.tabContainer)}this.toolbar=(this.editor.chromeless)?null:this.createToolbar(this.createDiv("geToolbar"));if(this.toolbar!=null){this.toolbarContainer.appendChild(this.toolbar.container);this.container.appendChild(this.toolbarContainer)}if(this.sidebar!=null){this.container.appendChild(this.hsplit);this.addSplitHandler(this.hsplit,true,0,mxUtils.bind(this,function(b){this.hsplitPosition=b;this.refresh()}))}};EditorUi.prototype.createStatusContainer=function(){var a=document.createElement("a");a.className="geItem geStatus";return a};EditorUi.prototype.setStatusText=function(a){this.statusContainer.innerHTML=a};EditorUi.prototype.createToolbar=function(a){return new Toolbar(this,a)};EditorUi.prototype.createSidebar=function(a){return new Sidebar(this,a)};EditorUi.prototype.createFormat=function(a){return new Format(this,a)};EditorUi.prototype.createFooter=function(){return this.createDiv("geFooter")};EditorUi.prototype.createDiv=function(b){var a=document.createElement("div");a.className=b;return a};EditorUi.prototype.addSplitHandler=function(d,a,j,h){var c=null;var g=null;var k=true;var i=null;if(mxClient.IS_POINTER){d.style.touchAction="none"}var e=mxUtils.bind(this,function(){var l=parseInt(((a)?d.style.left:d.style.bottom));if(!a){l=l+j-this.footerHeight}return l});function f(l){if(c!=null){var m=new mxPoint(mxEvent.getClientX(l),mxEvent.getClientY(l));h(Math.max(0,g+((a)?(m.x-c.x):(c.y-m.y))-j));mxEvent.consume(l);if(g!=e()){k=true;i=null}}}function b(l){f(l);g=null;c=null}mxEvent.addGestureListeners(d,function(l){c=new mxPoint(mxEvent.getClientX(l),mxEvent.getClientY(l));g=e();k=false;mxEvent.consume(l)});mxEvent.addListener(d,"click",function(l){if(!k){var m=(i!=null)?i-j:0;i=e();h(m);mxEvent.consume(l)}});mxEvent.addGestureListeners(document,null,f,b);this.destroyFunctions.push(function(){mxEvent.removeGestureListeners(document,null,f,b)})};EditorUi.prototype.showDialog=function(c,b,e,f,d,a){this.editor.graph.tooltipHandler.hideTooltip();if(this.dialogs==null){this.dialogs=[]}this.dialog=new Dialog(this,c,b,e,f,d,a);this.dialogs.push(this.dialog)};EditorUi.prototype.hideDialog=function(a){if(this.dialogs!=null&&this.dialogs.length>0){var b=this.dialogs.pop();b.close(a);this.dialog=(this.dialogs.length>0)?this.dialogs[this.dialogs.length-1]:null;if(this.dialog==null&&this.editor.graph.container.style.visibility!="hidden"){this.editor.graph.container.focus()}this.editor.fireEvent(new mxEventObject("hideDialog"))}};EditorUi.prototype.pickColor=function(b,a){var d=this.editor.graph;var c=d.cellEditor.saveSelection();var e=new ColorDialog(this,b||"none",function(f){d.cellEditor.restoreSelection(c);a(f)},function(){d.cellEditor.restoreSelection(c)});this.showDialog(e.container,220,430,true,false);e.init()};EditorUi.prototype.openFile=function(){window.openFile=new OpenFile(mxUtils.bind(this,function(a){this.hideDialog(a)}));this.showDialog(new OpenDialog(this).container,(Editor.useLocalStorage)?640:320,(Editor.useLocalStorage)?480:220,true,true,function(){window.openFile=null})};EditorUi.prototype.extractGraphModelFromHtml=function(d){var b=null;try{var a=d.indexOf("&lt;mxGraphModel ");if(a>=0){var c=d.lastIndexOf("&lt;/mxGraphModel&gt;");if(c>a){b=d.substring(a,c+21).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/\\&quot;/g,'"').replace(/\n/g,"")}}}catch(f){}return b};EditorUi.prototype.extractGraphModelFromEvent=function(b){var a=null;var d=null;if(b!=null){var e=(b.dataTransfer!=null)?b.dataTransfer:b.clipboardData;if(e!=null){if(document.documentMode==10||document.documentMode==11){d=e.getData("Text")}else{d=(mxUtils.indexOf(e.types,"text/html")>=0)?e.getData("text/html"):null;if(mxUtils.indexOf(e.types,"text/plain"&&(d==null||d.length==0))){d=e.getData("text/plain")}}if(d!=null){d=this.editor.graph.zapGremlins(mxUtils.trim(d));var c=this.extractGraphModelFromHtml(d);if(c!=null){d=c}}}}if(d!=null&&this.isCompatibleString(d)){a=d}return a};EditorUi.prototype.isCompatibleString=function(a){return false};EditorUi.prototype.saveFile=function(a){if(!a&&this.editor.filename!=null){this.save(this.editor.getOrCreateFilename())}else{var b=new FilenameDialog(this,this.editor.getOrCreateFilename(),mxResources.get("save"),mxUtils.bind(this,function(c){this.save(c)}),null,mxUtils.bind(this,function(c){if(c!=null&&c.length>0){return true}mxUtils.confirm(mxResources.get("invalidName"));return false}));this.showDialog(b.container,300,100,true,true);b.init()}};EditorUi.prototype.save=function(b){if(b!=null){if(this.editor.graph.isEditing()){this.editor.graph.stopEditing()}var a=mxUtils.getXml(this.editor.getGraphXml());try{if(Editor.useLocalStorage){if(localStorage.getItem(b)!=null&&!mxUtils.confirm(mxResources.get("replaceIt",[b]))){return}localStorage.setItem(b,a);this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("saved"))+" "+new Date())}else{if(a.length<MAX_REQUEST_SIZE){new mxXmlRequest(SAVE_URL,"filename="+encodeURIComponent(b)+"&xml="+encodeURIComponent(a)).simulate(document,"_blank")}else{mxUtils.alert(mxResources.get("drawingTooLarge"));mxUtils.popup(a);return}}this.editor.setModified(false);this.editor.setFilename(b);this.updateDocumentTitle()}catch(c){this.editor.setStatus(mxUtils.htmlEntities(mxResources.get("errorSavingFile")))}}};EditorUi.prototype.executeLayout=function(a,b,c){var f=this.editor.graph;if(f.isEnabled()){f.getModel().beginUpdate();try{a()}catch(g){throw g}finally{if(this.allowAnimation&&b&&navigator.userAgent.indexOf("Camino")<0){var d=new mxMorphing(f);d.addListener(mxEvent.DONE,mxUtils.bind(this,function(){f.getModel().endUpdate();if(c!=null){c()}}));d.startAnimation()}else{f.getModel().endUpdate();if(c!=null){c()}}}}};EditorUi.prototype.showImageDialog=function(h,f,d,a){var c=this.editor.graph.cellEditor;var e=c.saveSelection();var g=mxUtils.prompt(h,f);c.restoreSelection(e);if(g!=null&&g.length>0){var b=new Image();b.onload=function(){d(g,b.width,b.height)};b.onerror=function(){d(null);mxUtils.alert(mxResources.get("fileNotFound"))};b.src=g}else{d(null)}};EditorUi.prototype.showLinkDialog=function(c,a,b){var d=new LinkDialog(this,c,a,b);this.showDialog(d.container,420,90,true,true);d.init()};EditorUi.prototype.showBackgroundImageDialog=function(b){b=(b!=null)?b:mxUtils.bind(this,function(d){this.setBackgroundImage(d)});var c=mxUtils.prompt(mxResources.get("backgroundImage"),"");if(c!=null&&c.length>0){var a=new Image();a.onload=function(){b(new mxImage(c,a.width,a.height))};a.onerror=function(){b(null);mxUtils.alert(mxResources.get("fileNotFound"))};a.src=c}else{b(null)}};EditorUi.prototype.setBackgroundImage=function(a){this.editor.graph.setBackgroundImage(a);this.editor.graph.view.validateBackgroundImage();this.fireEvent(new mxEventObject("backgroundImageChanged"))};EditorUi.prototype.confirm=function(c,b,a){if(mxUtils.confirm(c)){if(b!=null){b()}}else{if(a!=null){a()}}};EditorUi.prototype.createOutline=function(b){var a=new mxOutline(this.editor.graph);a.border=20;mxEvent.addListener(window,"resize",function(){a.update()});this.addListener("pageFormatChanged",function(){a.update()});return a};EditorUi.prototype.createKeyHandler=function(f){var k=this;var l=this.editor.graph;var c=new mxKeyHandler(l);var m=c.isEventIgnored;c.isEventIgnored=function(n){return(!this.isControlDown(n)||mxEvent.isShiftDown(n)||(n.keyCode!=90&&n.keyCode!=89&&n.keyCode!=188&&n.keyCode!=190&&n.keyCode!=85))&&((n.keyCode!=66&&n.keyCode!=73)||!this.isControlDown(n)||(this.graph.cellEditor.isContentEditing()&&!mxClient.IS_FF&&!mxClient.IS_SF))&&m.apply(this,arguments)};c.isEnabledForEvent=function(n){return(!mxEvent.isConsumed(n)&&this.isGraphEvent(n)&&this.isEnabled())};c.isControlDown=function(n){return mxEvent.isControlDown(n)||(mxClient.IS_MAC&&n.metaKey)};var e=[];var h=null;function b(p,n,o){e.push(function(){if(!l.isSelectionEmpty()&&l.isEnabled()){n=(n!=null)?n:1;if(o){l.getModel().beginUpdate();try{var x=l.getSelectionCells();for(var r=0;r<x.length;r++){if(l.getModel().isVertex(x[r])&&l.isCellResizable(x[r])){var q=l.getCellGeometry(x[r]);if(q!=null){q=q.clone();if(p==37){q.width=Math.max(0,q.width-n)}else{if(p==38){q.height=Math.max(0,q.height-n)}else{if(p==39){q.width+=n}else{if(p==40){q.height+=n}}}}l.getModel().setGeometry(x[r],q)}}}}finally{l.getModel().endUpdate()}}else{var v=l.getSelectionCell();var u=l.model.getParent(v);var s=null;if(l.getSelectionCount()==1&&l.model.isVertex(v)&&l.layoutManager!=null&&!l.isCellLocked(v)){s=l.layoutManager.getLayout(u)}if(s!=null&&s.constructor==mxStackLayout){var t=u.getIndex(v);if(p==37||p==38){l.model.add(u,v,Math.max(0,t-1))}else{if(p==39||p==40){l.model.add(u,v,Math.min(l.model.getChildCount(u),t+1))}}}else{var y=0;var w=0;if(p==37){y=-n}else{if(p==38){w=-n}else{if(p==39){y=n}else{if(p==40){w=n}}}}l.moveCells(l.getMovableCells(l.getSelectionCells()),y,w)}}}});if(h!=null){window.clearTimeout(h)}h=window.setTimeout(function(){if(e.length>0){l.getModel().beginUpdate();try{for(var q=0;q<e.length;q++){e[q]()}e=[]}finally{l.getModel().endUpdate()}l.scrollCellToVisible(l.getSelectionCell())}},200)}var i={37:mxConstants.DIRECTION_WEST,38:mxConstants.DIRECTION_NORTH,39:mxConstants.DIRECTION_EAST,40:mxConstants.DIRECTION_SOUTH};var g=c.getFunction;var d={67:this.actions.get("clearWaypoints")};mxKeyHandler.prototype.getFunction=function(n){if(l.isEnabled()){if(!l.isSelectionEmpty()&&mxEvent.isShiftDown(n)&&mxEvent.isAltDown(n)){var o=d[n.keyCode];if(o!=null){return o.funct}}if(n.keyCode==9&&mxEvent.isAltDown(n)){if(mxEvent.isShiftDown(n)){return function(){l.selectParentCell()}}else{return function(){l.selectChildCell()}}}else{if(i[n.keyCode]!=null&&!l.isSelectionEmpty()){if(mxEvent.isShiftDown(n)&&mxEvent.isAltDown(n)){if(l.model.isVertex(l.getSelectionCell())){return function(){var p=l.connectVertex(l.getSelectionCell(),i[n.keyCode],l.defaultEdgeLength,n,true);if(p!=null&&p.length>0){if(p.length==1&&l.model.isEdge(p[0])){l.setSelectionCell(l.model.getTerminal(p[0],false))}else{l.setSelectionCell(p[p.length-1])}if(k.hoverIcons!=null){k.hoverIcons.update(l.view.getState(l.getSelectionCell()))}}}}}else{if(this.isControlDown(n)){return function(){b(n.keyCode,(mxEvent.isShiftDown(n))?l.gridSize:null,true)}}else{return function(){b(n.keyCode,(mxEvent.isShiftDown(n))?l.gridSize:null)}}}}}}return g.apply(this,arguments)};c.bindAction=mxUtils.bind(this,function(p,s,o,n){var r=this.actions.get(o);if(r!=null){var q=function(){if(r.isEnabled()){r.funct()}};if(s){if(n){c.bindControlShiftKey(p,q)}else{c.bindControlKey(p,q)}}else{if(n){c.bindShiftKey(p,q)}else{c.bindKey(p,q)}}}});var j=this;var a=c.escape;c.escape=function(n){a.apply(this,arguments)};c.enter=function(){};c.bindControlShiftKey(36,function(){l.exitGroup()});c.bindControlShiftKey(35,function(){l.enterGroup()});c.bindKey(36,function(){l.home()});c.bindKey(35,function(){l.refresh()});c.bindAction(107,true,"zoomIn");c.bindAction(109,true,"zoomOut");c.bindAction(80,true,"print");c.bindAction(79,true,"outline",true);c.bindAction(112,false,"about");if(!this.editor.chromeless){c.bindControlKey(36,function(){if(l.isEnabled()){l.foldCells(true)}});c.bindControlKey(35,function(){if(l.isEnabled()){l.foldCells(false)}});c.bindControlKey(13,function(){if(l.isEnabled()){l.setSelectionCells(l.duplicateCells(l.getSelectionCells(),false))}});c.bindAction(8,false,"delete");c.bindAction(8,true,"deleteAll");c.bindAction(46,false,"delete");c.bindAction(46,true,"deleteAll");c.bindAction(72,true,"resetView");c.bindAction(72,true,"fitWindow",true);c.bindAction(74,true,"fitPage");c.bindAction(74,true,"fitTwoPages",true);c.bindAction(48,true,"customZoom");c.bindAction(82,true,"turn");c.bindAction(82,true,"clearDefaultStyle",true);c.bindAction(83,true,"save");c.bindAction(83,true,"saveAs",true);c.bindAction(65,true,"selectAll");c.bindAction(65,true,"selectNone",true);c.bindAction(73,true,"selectVertices",true);c.bindAction(69,true,"selectEdges",true);c.bindAction(69,true,"editStyle");c.bindAction(66,true,"bold");c.bindAction(66,true,"toBack",true);c.bindAction(70,true,"toFront",true);c.bindAction(68,true,"duplicate");c.bindAction(68,true,"setAsDefaultStyle",true);c.bindAction(90,true,"undo");c.bindAction(89,true,"autosize",true);c.bindAction(88,true,"cut");c.bindAction(67,true,"copy");c.bindAction(81,true,"connectionArrows");c.bindAction(81,true,"connectionPoints",true);c.bindAction(86,true,"paste");c.bindAction(71,true,"group");c.bindAction(77,true,"editData");c.bindAction(71,true,"grid",true);c.bindAction(73,true,"italic");c.bindAction(76,true,"lockUnlock");c.bindAction(76,true,"layers",true);c.bindAction(80,true,"formatPanel",true);c.bindAction(85,true,"underline");c.bindAction(85,true,"ungroup",true);c.bindAction(190,true,"superscript");c.bindAction(188,true,"subscript");c.bindKey(13,function(){if(l.isEnabled()){l.startEditingAtCell()}});c.bindKey(113,function(){if(l.isEnabled()){l.startEditingAtCell()}})}if(!mxClient.IS_WIN){c.bindAction(90,true,"redo",true)}else{c.bindAction(89,true,"redo")}return c};EditorUi.prototype.destroy=function(){if(this.editor!=null){this.editor.destroy();this.editor=null}if(this.menubar!=null){this.menubar.destroy();this.menubar=null}if(this.toolbar!=null){this.toolbar.destroy();this.toolbar=null}if(this.sidebar!=null){this.sidebar.destroy();this.sidebar=null}if(this.keyHandler!=null){this.keyHandler.destroy();this.keyHandler=null}if(this.keydownHandler!=null){mxEvent.removeListener(document,"keydown",this.keydownHandler);this.keydownHandler=null}if(this.keyupHandler!=null){mxEvent.removeListener(document,"keyup",this.keyupHandler);this.keyupHandler=null}if(this.resizeHandler!=null){mxEvent.removeListener(window,"resize",this.resizeHandler);this.resizeHandler=null}if(this.gestureHandler!=null){mxEvent.removeGestureListeners(document,this.gestureHandler);this.gestureHandler=null}if(this.orientationChangeHandler!=null){mxEvent.removeListener(window,"orientationchange",this.orientationChangeHandler);this.orientationChangeHandler=null}if(this.scrollHandler!=null){mxEvent.removeListener(window,"scroll",this.scrollHandler);this.scrollHandler=null}if(this.destroyFunctions!=null){for(var a=0;a<this.destroyFunctions.length;a++){this.destroyFunctions[a]()}this.destroyFunctions=null}var b=[this.menubarContainer,this.toolbarContainer,this.sidebarContainer,this.formatContainer,this.diagramContainer,this.footerContainer,this.chromelessToolbar,this.hsplit,this.sidebarFooterContainer,this.layersDialog];for(var a=0;a<b.length;a++){if(b[a]!=null&&b[a].parentNode!=null){b[a].parentNode.removeChild(b[a])}}};