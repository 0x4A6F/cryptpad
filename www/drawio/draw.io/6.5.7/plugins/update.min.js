Draw.loadPlugin(function(g){if(g.editor.chromeless){var i=g.editor.graph;var a=60000;function b(k){var j=new mxCellOverlay(k.image||i.warningImage,k.tooltip,k.align,k.valign,k.offset);j.addListener(mxEvent.CLICK,function(m,l){g.alert(k.tooltip)});return j}function f(p){if(p!=null&&p.length>0){var u=mxUtils.parseXml(p);if(u!=null&&u.documentElement!=null){var q=i.getModel();var l=u.documentElement.getElementsByTagName("update");if(l!=null&&l.length>0){q.beginUpdate();try{for(var o=0;o<l.length;o++){var x=q.getCell(l[o].getAttribute("id"));if(x!=null){try{var v=l[o].getAttribute("value");if(v!=null){var m=mxUtils.parseXml(v).documentElement;if(m!=null){if(l[o].getAttribute("replace-value")=="1"){i.model.setValue(x,m)}else{var w=m.attributes;for(var n=0;n<w.length;n++){i.setAttributeForCell(x,w[n].nodeName,(w[n].nodeValue.length>0)?w[n].nodeValue:null)}}}}}catch(s){console.log("Error in value for "+x.id+": "+s)}try{var k=l[o].getAttribute("style");if(k!=null){i.model.setStyle(x,k)}}catch(s){console.log("Error in style for "+x.id+": "+s)}try{var t=l[o].getAttribute("icon");if(t!=null){var r=(t.length>0)?JSON.parse(t):null;if(r==null||!r.append){i.removeCellOverlays(x)}if(r!=null){i.addCellOverlay(x,b(r))}}}catch(s){console.log("Error in icon for "+x.id+": "+s)}}}}finally{q.endUpdate()}}}}}var c=null;function h(){var k=g.editor.graph.getModel().getRoot();var j=false;if(k.value!=null&&typeof(k.value)=="object"){a=parseInt(k.value.getAttribute("updateInterval")||a);var l=k.value.getAttribute("updateUrl");if(l!=null){var m=mxUtils.getXml(g.editor.getGraphXml());function o(){if(l==="demo"){f(mxUtils.getXml(e().documentElement));n()}else{mxUtils.post(l,"xml="+encodeURIComponent(m),function(p){if(k===g.editor.graph.getModel().getRoot()){if(p.getStatus()>=200&&p.getStatus()<=300){f(mxUtils.getXml(p.getDocumentElement()));n()}else{g.handleError({message:mxResources.get("error")+" "+p.getStatus()})}}},function(p){g.handleError(p)})}}function n(){c=window.setTimeout(o,a)}o();j=true}}return j}function d(){var j=h();if(j){g.editor.addListener("pageSelected",function(){window.clearTimeout(c);h()})}return j}function e(){var l=mxUtils.createXmlDocument();var k=l.createElement("updates");for(var n in i.model.cells){var j=i.model.cells[n];if(i.model.isVertex(j)){if(j.value!=null&&typeof(j.value)=="object"&&j.value.getAttribute("update")=="1"){if(Math.random()>0.5){var m=l.createElement("update");m.setAttribute("id",j.id);m.setAttribute("value",'<object tooltip="%load%% Done" load="'+Math.round(Math.random()*100)+'" placeholders="1">');m.setAttribute("style",j.style+";fillColor=#d5e8d4;gradientColor=white;");m.setAttribute("icon",JSON.stringify({tooltip:"Running",align:"right",valign:"top",image:{src:IMAGE_PATH+"/spin.gif",width:12,height:12}}));k.appendChild(m);if(Math.random()>0.5){var m=l.createElement("update");m.setAttribute("id",j.id);m.setAttribute("icon",JSON.stringify({tooltip:"Locked",append:true,image:{src:IMAGE_PATH+"/locked.png",width:12,height:12}}));k.appendChild(m)}}else{var m=l.createElement("update");m.setAttribute("id",j.id);m.setAttribute("style",j.style+";fillColor=#d4e1f5;gradientColor=white;");m.setAttribute("value",'<object tooltip="">');m.setAttribute("icon","");k.appendChild(m)}}}}l.appendChild(k);return l}if(!d()){g.editor.addListener("fileLoaded",d)}}});