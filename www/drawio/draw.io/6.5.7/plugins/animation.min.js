Draw.loadPlugin(function(o){mxResources.parse("animation=Animation...");o.actions.addAction("animation",function(){if(this.animationWindow==null){this.animationWindow=new m(o,(document.body.offsetWidth-480)/2,120,640,480);this.animationWindow.window.setVisible(true)}else{this.animationWindow.window.setVisible(!this.animationWindow.window.isVisible())}});var b=o.menus.get("extras");var c=b.funct;b.funct=function(r,q){c.apply(this,arguments);o.menus.addMenuItems(r,["-","animation"],q)};function p(w,t){var r=[];for(var u=0;u<t.length;u++){var v=w.view.getState(t[u]);if(v!=null){var q=w.cellRenderer.getShapesForState(v);for(var s=0;s<q.length;s++){if(q[s]!=null&&q[s].node!=null){r.push(q[s].node)}}if(v.control!=null&&v.control.node!=null){r.push(v.control.node)}}}return r}function j(q){if(q!=null){for(var r=0;r<q.length;r++){mxUtils.setPrefixedStyle(q[r].style,"transition",null);q[r].style.opacity="0"}window.setTimeout(function(){for(var s=0;s<q.length;s++){mxUtils.setPrefixedStyle(q[s].style,"transition","all 1s ease-in-out");q[s].style.opacity="1"}},0)}}function g(q){if(q!=null){for(var r=0;r<q.length;r++){mxUtils.setPrefixedStyle(q[r].style,"transition",null);q[r].style.opacity="1"}window.setTimeout(function(){for(var s=0;s<q.length;s++){mxUtils.setPrefixedStyle(q[s].style,"transition","all 1s ease-in-out");q[s].style.opacity="0"}},0)}}function f(s){var t=s.absolutePoints.slice();var q=s.segments;var r=s.length;var u=t.length;return{execute:function(y,v){if(s.shape!=null){var x=[t[0]];var z=r*y/v;for(var w=1;w<u;w++){if(z<=q[w-1]){x.push(new mxPoint(t[w-1].x+(t[w].x-t[w-1].x)*z/q[w-1],t[w-1].y+(t[w].y-t[w-1].y)*z/q[w-1]));break}else{z-=q[w-1];x.push(t[w])}}s.shape.points=x;s.shape.redraw()}},stop:function(){if(s.shape!=null){s.shape.points=t;s.shape.redraw()}}}}function l(s){var q=new mxRectangle.fromRectangle(s.shape.bounds);var r=null;if(s.text!=null&&s.text.node!=null&&s.text.node.firstChild!=null){r=s.text.node.firstChild.getAttribute("transform")}return{execute:function(u,t){if(s.shape!=null){var v=u/t;s.shape.bounds=new mxRectangle(q.x,q.y,q.width*v,q.height);s.shape.redraw();if(r!=null){s.text.node.firstChild.setAttribute("transform",r+" scale("+v+",1)")}}},stop:function(){if(s.shape!=null){s.shape.bounds=q;s.shape.redraw();if(r!=null){s.text.node.firstChild.setAttribute("transform",r)}}}}}function k(x,z,w,u){w=(w!=null)?w:30;u=(u!=null)?u:30;var y=[];for(var t=0;t<z.length;t++){var q=x.view.getState(z[t]);if(q!=null&&q.shape!=null&&x.model.isEdge(q.cell)&&q.absolutePoints!=null&&q.absolutePoints.length>1){y.push(f(q))}else{if(q!=null&&x.model.isVertex(q.cell)&&q.shape!=null&&q.shape.bounds!=null){y.push(l(q))}}}var s=0;function r(){if(s==w){window.clearInterval(v);for(var A=0;A<y.length;A++){y[A].stop()}}else{for(var A=0;A<y.length;A++){y[A].execute(s,w)}s++}}var v=window.setInterval(r,u);r()}function e(q,u,s){s=(s!=null)?s:new Object();s[q.id]=u;var r=q.getChildCount();for(var t=0;t<r;t++){e(q.getChildAt(t),u.getChildAt(t),s)}return s}var a=false;var i=false;function n(){a=false}function d(w,s,r){if(!i){a=true;i=true;w.getModel().beginUpdate();try{for(var x in w.getModel().cells){var q=w.getModel().cells[x];if(w.getModel().isVertex(q)||w.getModel().isEdge(q)){w.setCellStyles("opacity","0",[q]);w.setCellStyles("noLabel","1",[q])}}}finally{w.getModel().endUpdate()}var t=e(o.editor.graph.getModel().getRoot(),w.getModel().getRoot());var v=0;function u(){if(a&&v<s.length){var z=s[v].split(" ");if(z.length>0){if(z[0]=="wait"&&z.length>1){window.setTimeout(function(){v++;u()},parseFloat(z[1]))}else{if(z.length>1){var y=t[z[1]];if(y!=null){if(z[0]=="show"){w.setCellStyles("opacity","100",[y]);w.setCellStyles("noLabel",null,[y]);if(z.length>2&&z[2]=="fade"){j(p(w,[y]))}else{k(w,[y])}}else{if(z[0]=="hide"){g(p(w,[y]))}}}else{console.log("cell not found",x,s[v])}}v++;u()}}}else{i=false;if(r){w.refresh();d(w,s,r)}}}u()}}var m=function(J,D,C,E,K){var L=document.createElement("table");L.style.width="100%";L.style.height="100%";var q=document.createElement("tbody");var O=document.createElement("tr");var z=document.createElement("td");z.style.width="140px";var u=document.createElement("td");var N=document.createElement("tr");N.style.height="40px";var G=document.createElement("td");G.setAttribute("colspan","2");var M=document.createElement("textarea");M.style.overflow="auto";M.style.width="100%";M.style.height="100%";z.appendChild(M);var I=J.editor.graph.getModel().getRoot();if(I.value!=null&&typeof(I.value)=="object"){M.value=I.value.getAttribute("animation")}var F=document.createElement("div");F.style.border="1px solid lightGray";F.style.background="#ffffff";F.style.width="100%";F.style.height="100%";F.style.overflow="auto";mxEvent.disableContextMenu(F);u.appendChild(F);var t=new Graph(F);t.setEnabled(false);t.setPanning(true);t.foldingEnabled=false;t.panningHandler.ignoreCell=true;t.panningHandler.useLeftButtonForPanning=true;t.minFitScale=null;t.maxFitScale=null;t.centerZoom=true;var P=mxUtils.button("Fade In",function(){var w=J.editor.graph.getSelectionCells();if(w.length>0){for(var x=0;x<w.length;x++){M.value=M.value+"show "+w[x].id+" fade\n"}M.value=M.value+"wait 1000\n"}});G.appendChild(P);var s=mxUtils.button("Wipe In",function(){var w=J.editor.graph.getSelectionCells();if(w.length>0){for(var x=0;x<w.length;x++){M.value=M.value+"show "+w[x].id+"\n"}M.value=M.value+"wait 1000\n"}});G.appendChild(s);var r=mxUtils.button("Fade Out",function(){var w=J.editor.graph.getSelectionCells();if(w.length>0){for(var x=0;x<w.length;x++){M.value=M.value+"hide "+w[x].id+"\n"}M.value=M.value+"wait 1000\n"}});G.appendChild(r);var B=mxUtils.button("Wait",function(){M.value=M.value+"wait 1000\n"});G.appendChild(B);var v=mxUtils.button("Preview",function(){t.getModel().clear();t.getModel().setRoot(t.cloneCells([J.editor.graph.getModel().getRoot()])[0]);t.maxFitScale=1;t.fit(8);t.center();d(t,M.value.split("\n"))});G.appendChild(v);var H=mxUtils.button("Stop",function(){t.getModel().clear();n()});G.appendChild(H);var A=mxUtils.button("Apply",function(){J.editor.graph.setAttributeForCell(I,"animation",M.value)});G.appendChild(A);O.appendChild(z);O.appendChild(u);q.appendChild(O);N.appendChild(G);q.appendChild(N);L.appendChild(q);this.window=new mxWindow("Animation",L,D,C,E,K,true,true);this.window.destroyOnClose=false;this.window.setMaximizable(false);this.window.setResizable(true);this.window.setClosable(true);this.window.setVisible(true)};if(o.editor.chromeless){function h(){var r=o.editor.graph.getModel().getRoot();var q=false;if(r.value!=null&&typeof(r.value)=="object"){var s=r.value.getAttribute("animation");if(s!=null){d(o.editor.graph,s.split("\n"),true);q=true}}return q}if(!h()){o.editor.addListener("fileLoaded",h)}}});