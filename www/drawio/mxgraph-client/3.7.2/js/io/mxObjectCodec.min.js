function mxObjectCodec(e,a,d,b){this.template=e;this.exclude=(a!=null)?a:[];this.idrefs=(d!=null)?d:[];this.mapping=(b!=null)?b:[];this.reverse=new Object();for(var c in this.mapping){this.reverse[this.mapping[c]]=c}}mxObjectCodec.allowEval=false;mxObjectCodec.prototype.template=null;mxObjectCodec.prototype.exclude=null;mxObjectCodec.prototype.idrefs=null;mxObjectCodec.prototype.mapping=null;mxObjectCodec.prototype.reverse=null;mxObjectCodec.prototype.getName=function(){return mxUtils.getFunctionName(this.template.constructor)};mxObjectCodec.prototype.cloneTemplate=function(){return new this.template.constructor()};mxObjectCodec.prototype.getFieldName=function(b){if(b!=null){var a=this.reverse[b];if(a!=null){b=a}}return b};mxObjectCodec.prototype.getAttributeName=function(b){if(b!=null){var a=this.mapping[b];if(a!=null){b=a}}return b};mxObjectCodec.prototype.isExcluded=function(d,a,c,b){return a==mxObjectIdentity.FIELD_NAME||mxUtils.indexOf(this.exclude,a)>=0};mxObjectCodec.prototype.isReference=function(d,a,c,b){return mxUtils.indexOf(this.idrefs,a)>=0};mxObjectCodec.prototype.encode=function(a,c){var b=a.document.createElement(this.getName());c=this.beforeEncode(a,c,b);this.encodeObject(a,c,b);return this.afterEncode(a,c,b)};mxObjectCodec.prototype.encodeObject=function(a,f,d){a.setAttribute(d,"id",a.getId(f));for(var c in f){var b=c;var e=f[b];if(e!=null&&!this.isExcluded(f,b,e,true)){if(mxUtils.isInteger(b)){b=null}this.encodeValue(a,f,b,e,d)}}};mxObjectCodec.prototype.encodeValue=function(b,g,c,f,e){if(f!=null){if(this.isReference(g,c,f,true)){var d=b.getId(f);if(d==null){mxLog.warn("mxObjectCodec.encode: No ID for "+this.getName()+"."+c+"="+f);return}f=d}var a=this.template[c];if(c==null||b.encodeDefaults||a!=f){c=this.getAttributeName(c);this.writeAttribute(b,g,c,f,e)}}};mxObjectCodec.prototype.writeAttribute=function(a,e,b,d,c){if(typeof(d)!="object"){this.writePrimitiveAttribute(a,e,b,d,c)}else{this.writeComplexAttribute(a,e,b,d,c)}};mxObjectCodec.prototype.writePrimitiveAttribute=function(a,e,b,d,c){d=this.convertAttributeToXml(a,e,b,d,c);if(b==null){var f=a.document.createElement("add");if(typeof(d)=="function"){f.appendChild(a.document.createTextNode(d))}else{a.setAttribute(f,"value",d)}c.appendChild(f)}else{if(typeof(d)!="function"){a.setAttribute(c,b,d)}}};mxObjectCodec.prototype.writeComplexAttribute=function(a,e,b,d,c){var f=a.encode(d);if(f!=null){if(b!=null){f.setAttribute("as",b)}c.appendChild(f)}else{mxLog.warn("mxObjectCodec.encode: No node for "+this.getName()+"."+b+": "+d)}};mxObjectCodec.prototype.convertAttributeToXml=function(a,d,b,c){if(this.isBooleanAttribute(a,d,b,c)){c=(c==true)?"1":"0"}return c};mxObjectCodec.prototype.isBooleanAttribute=function(a,d,b,c){return(typeof(c.length)=="undefined"&&(c==true||c==false))};mxObjectCodec.prototype.convertAttributeFromXml=function(d,a,c){var b=a.value;if(this.isNumericAttribute(d,a,c)){b=parseFloat(b)}return b};mxObjectCodec.prototype.isNumericAttribute=function(c,a,b){return mxUtils.isNumeric(a.value)};mxObjectCodec.prototype.beforeEncode=function(a,c,b){return c};mxObjectCodec.prototype.afterEncode=function(a,c,b){return b};mxObjectCodec.prototype.decode=function(e,b,a){var d=b.getAttribute("id");var c=e.objects[d];if(c==null){c=a||this.cloneTemplate();if(d!=null){e.putObject(d,c)}}b=this.beforeDecode(e,b,c);this.decodeNode(e,b,c);return this.afterDecode(e,b,c)};mxObjectCodec.prototype.decodeNode=function(c,a,b){if(a!=null){this.decodeAttributes(c,a,b);this.decodeChildren(c,a,b)}};mxObjectCodec.prototype.decodeAttributes=function(e,c,d){var a=c.attributes;if(a!=null){for(var b=0;b<a.length;b++){this.decodeAttribute(e,a[b],d)}}};mxObjectCodec.prototype.isIgnoredAttribute=function(c,a,b){return a.nodeName=="as"||a.nodeName=="id"};mxObjectCodec.prototype.decodeAttribute=function(g,a,f){if(!this.isIgnoredAttribute(g,a,f)){var c=a.nodeName;var e=this.convertAttributeFromXml(g,a,f);var b=this.getFieldName(c);if(this.isReference(f,b,e,false)){var d=g.getObject(e);if(d==null){mxLog.warn("mxObjectCodec.decode: No object for "+this.getName()+"."+c+"="+e);return}e=d}if(!this.isExcluded(f,c,e,false)){f[c]=e}}};mxObjectCodec.prototype.decodeChildren=function(e,b,c){var d=b.firstChild;while(d!=null){var a=d.nextSibling;if(d.nodeType==mxConstants.NODETYPE_ELEMENT&&!this.processInclude(e,d,c)){this.decodeChild(e,d,c)}d=a}};mxObjectCodec.prototype.decodeChild=function(dec,child,obj){var fieldname=this.getFieldName(child.getAttribute("as"));if(fieldname==null||!this.isExcluded(obj,fieldname,child,false)){var template=this.getFieldTemplate(obj,fieldname,child);var value=null;if(child.nodeName=="add"){value=child.getAttribute("value");if(value==null&&mxObjectCodec.allowEval){value=mxUtils.eval(mxUtils.getTextContent(child))}}else{value=dec.decode(child,template)}this.addObjectValue(obj,fieldname,value,template)}};mxObjectCodec.prototype.getFieldTemplate=function(c,a,d){var b=c[a];if(b instanceof Array&&b.length>0){b=null}return b};mxObjectCodec.prototype.addObjectValue=function(d,a,c,b){if(c!=null&&c!=b){if(a!=null&&a.length>0){d[a]=c}else{d.push(c)}}};mxObjectCodec.prototype.processInclude=function(g,d,c){if(d.nodeName=="include"){var b=d.getAttribute("name");if(b!=null){try{var a=mxUtils.load(b).getDocumentElement();if(a!=null){g.decode(a,c)}}catch(f){}}return true}return false};mxObjectCodec.prototype.beforeDecode=function(c,a,b){return a};mxObjectCodec.prototype.afterDecode=function(c,a,b){return b};