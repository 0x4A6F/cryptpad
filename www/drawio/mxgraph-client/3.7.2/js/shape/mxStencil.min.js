function mxStencil(a){this.desc=a;this.parseDescription();this.parseConstraints()}mxStencil.defaultLocalized=false;mxStencil.allowEval=false;mxStencil.prototype.desc=null;mxStencil.prototype.constraints=null;mxStencil.prototype.aspect=null;mxStencil.prototype.w0=null;mxStencil.prototype.h0=null;mxStencil.prototype.bgNode=null;mxStencil.prototype.fgNode=null;mxStencil.prototype.strokewidth=null;mxStencil.prototype.parseDescription=function(){this.fgNode=this.desc.getElementsByTagName("foreground")[0];this.bgNode=this.desc.getElementsByTagName("background")[0];this.w0=Number(this.desc.getAttribute("w")||100);this.h0=Number(this.desc.getAttribute("h")||100);var b=this.desc.getAttribute("aspect");this.aspect=(b!=null)?b:"variable";var a=this.desc.getAttribute("strokewidth");this.strokewidth=(a!=null)?a:"1"};mxStencil.prototype.parseConstraints=function(){var a=this.desc.getElementsByTagName("connections")[0];if(a!=null){var c=mxUtils.getChildNodes(a);if(c!=null&&c.length>0){this.constraints=[];for(var b=0;b<c.length;b++){this.constraints.push(this.parseConstraint(c[b]))}}}};mxStencil.prototype.parseConstraint=function(d){var a=Number(d.getAttribute("x"));var e=Number(d.getAttribute("y"));var b=d.getAttribute("perimeter")=="1";var c=d.getAttribute("name");return new mxConnectionConstraint(new mxPoint(a,e),b,c)};mxStencil.prototype.evaluateTextAttribute=function(d,c,b){var a=this.evaluateAttribute(d,c,b);var e=d.getAttribute("localized");if((mxStencil.defaultLocalized&&e==null)||e=="1"){a=mxResources.get(a)}return a};mxStencil.prototype.evaluateAttribute=function(node,attribute,shape){var result=node.getAttribute(attribute);if(result==null){var text=mxUtils.getTextContent(node);if(text!=null&&mxStencil.allowEval){var funct=mxUtils.eval(text);if(typeof(funct)=="function"){result=funct(shape)}}}return result};mxStencil.prototype.drawShape=function(b,e,i,f,k,d){var g=mxUtils.getValue(e.style,mxConstants.STYLE_DIRECTION,null);var a=this.computeAspect(e.style,i,f,k,d,g);var c=Math.min(a.width,a.height);var j=(this.strokewidth=="inherit")?Number(mxUtils.getNumber(e.style,mxConstants.STYLE_STROKEWIDTH,1)):Number(this.strokewidth)*c;b.setStrokeWidth(j);this.drawChildren(b,e,i,f,k,d,this.bgNode,a,false);this.drawChildren(b,e,i,f,k,d,this.fgNode,a,true)};mxStencil.prototype.drawChildren=function(b,f,j,g,k,e,c,a,i){if(c!=null&&k>0&&e>0){var d=c.firstChild;while(d!=null){if(d.nodeType==mxConstants.NODETYPE_ELEMENT){this.drawNode(b,f,d,a,i)}d=d.nextSibling}}};mxStencil.prototype.computeAspect=function(d,j,f,l,c,i){var a=j;var k=f;var g=l/this.w0;var e=c/this.h0;var b=(i==mxConstants.DIRECTION_NORTH||i==mxConstants.DIRECTION_SOUTH);if(b){e=l/this.h0;g=c/this.w0;var m=(l-c)/2;a+=m;k-=m}if(this.aspect=="fixed"){e=Math.min(g,e);g=e;if(b){a+=(c-this.w0*g)/2;k+=(l-this.h0*e)/2}else{a+=(l-this.w0*g)/2;k+=(c-this.h0*e)/2}}return new mxRectangle(a,k,g,e)};mxStencil.prototype.drawNode=function(d,a,C,q,e){var L=C.nodeName;var I=q.x;var c=q.y;var u=q.width;var p=q.height;var J=Math.min(u,p);if(L=="save"){d.save()}else{if(L=="restore"){d.restore()}else{if(L=="path"){d.begin();var b=C.firstChild;while(b!=null){if(b.nodeType==mxConstants.NODETYPE_ELEMENT){this.drawNode(d,a,b,q,e)}b=b.nextSibling}}else{if(L=="close"){d.close()}else{if(L=="move"){d.moveTo(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p)}else{if(L=="line"){d.lineTo(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p)}else{if(L=="quad"){d.quadTo(I+Number(C.getAttribute("x1"))*u,c+Number(C.getAttribute("y1"))*p,I+Number(C.getAttribute("x2"))*u,c+Number(C.getAttribute("y2"))*p)}else{if(L=="curve"){d.curveTo(I+Number(C.getAttribute("x1"))*u,c+Number(C.getAttribute("y1"))*p,I+Number(C.getAttribute("x2"))*u,c+Number(C.getAttribute("y2"))*p,I+Number(C.getAttribute("x3"))*u,c+Number(C.getAttribute("y3"))*p)}else{if(L=="arc"){d.arcTo(Number(C.getAttribute("rx"))*u,Number(C.getAttribute("ry"))*p,Number(C.getAttribute("x-axis-rotation")),Number(C.getAttribute("large-arc-flag")),Number(C.getAttribute("sweep-flag")),I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p)}else{if(L=="rect"){d.rect(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p,Number(C.getAttribute("w"))*u,Number(C.getAttribute("h"))*p)}else{if(L=="roundrect"){var k=Number(C.getAttribute("arcsize"));if(k==0){k=mxConstants.RECTANGLE_ROUNDING_FACTOR*100}var m=Number(C.getAttribute("w"))*u;var H=Number(C.getAttribute("h"))*p;var v=Number(k)/100;var t=Math.min(m*v,H*v);d.roundrect(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p,m,H,t,t)}else{if(L=="ellipse"){d.ellipse(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p,Number(C.getAttribute("w"))*u,Number(C.getAttribute("h"))*p)}else{if(L=="image"){if(!a.outline){var f=this.evaluateAttribute(C,"src",a);d.image(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p,Number(C.getAttribute("w"))*u,Number(C.getAttribute("h"))*p,f,false,C.getAttribute("flipH")=="1",C.getAttribute("flipV")=="1")}}else{if(L=="text"){if(!a.outline){var B=this.evaluateTextAttribute(C,"str",a);var E=C.getAttribute("vertical")=="1"?-90:0;if(C.getAttribute("align-shape")=="0"){var z=a.rotation;var D=mxUtils.getValue(a.style,mxConstants.STYLE_FLIPH,0)==1;var g=mxUtils.getValue(a.style,mxConstants.STYLE_FLIPV,0)==1;if(D&&g){E-=z}else{if(D||g){E+=z}else{E-=z}}}E-=C.getAttribute("rotation");d.text(I+Number(C.getAttribute("x"))*u,c+Number(C.getAttribute("y"))*p,0,0,B,C.getAttribute("align")||"left",C.getAttribute("valign")||"top",false,"",null,false,E)}}else{if(L=="include-shape"){var F=mxStencilRegistry.getStencil(C.getAttribute("name"));if(F!=null){var l=I+Number(C.getAttribute("x"))*u;var j=c+Number(C.getAttribute("y"))*p;var m=Number(C.getAttribute("w"))*u;var H=Number(C.getAttribute("h"))*p;F.drawShape(d,a,l,j,m,H)}}else{if(L=="fillstroke"){d.fillAndStroke()}else{if(L=="fill"){d.fill()}else{if(L=="stroke"){d.stroke()}else{if(L=="strokewidth"){var o=(C.getAttribute("fixed")=="1")?1:J;d.setStrokeWidth(Number(C.getAttribute("width"))*o)}else{if(L=="dashed"){d.setDashed(C.getAttribute("dashed")=="1")}else{if(L=="dashpattern"){var A=C.getAttribute("pattern");if(A!=null){var K=A.split(" ");var n=[];for(var G=0;G<K.length;G++){if(K[G].length>0){n.push(Number(K[G])*J)}}A=n.join(" ");d.setDashPattern(A)}}else{if(L=="strokecolor"){d.setStrokeColor(C.getAttribute("color"))}else{if(L=="linecap"){d.setLineCap(C.getAttribute("cap"))}else{if(L=="linejoin"){d.setLineJoin(C.getAttribute("join"))}else{if(L=="miterlimit"){d.setMiterLimit(Number(C.getAttribute("limit")))}else{if(L=="fillcolor"){d.setFillColor(C.getAttribute("color"))}else{if(L=="alpha"){d.setAlpha(C.getAttribute("alpha"))}else{if(L=="fontcolor"){d.setFontColor(C.getAttribute("color"))}else{if(L=="fontstyle"){d.setFontStyle(C.getAttribute("style"))}else{if(L=="fontfamily"){d.setFontFamily(C.getAttribute("family"))}else{if(L=="fontsize"){d.setFontSize(Number(C.getAttribute("size"))*J)}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}if(e&&(L=="fillstroke"||L=="fill"||L=="stroke")){e=false;d.setShadow(false)}};