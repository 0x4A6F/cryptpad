function mxText(m,g,p,f,o,r,k,d,e,t,b,i,c,s,q,n,j,a,l,u,h){mxShape.call(this);this.value=m;this.bounds=g;this.color=(o!=null)?o:"black";this.align=(p!=null)?p:mxConstants.ALIGN_CENTER;this.valign=(f!=null)?f:mxConstants.ALIGN_MIDDLE;this.family=(r!=null)?r:mxConstants.DEFAULT_FONTFAMILY;this.size=(k!=null)?k:mxConstants.DEFAULT_FONTSIZE;this.fontStyle=(d!=null)?d:mxConstants.DEFAULT_FONTSTYLE;this.spacing=parseInt(e||2);this.spacingTop=this.spacing+parseInt(t||0);this.spacingRight=this.spacing+parseInt(b||0);this.spacingBottom=this.spacing+parseInt(i||0);this.spacingLeft=this.spacing+parseInt(c||0);this.horizontal=(s!=null)?s:true;this.background=q;this.border=n;this.wrap=(j!=null)?j:false;this.clipped=(a!=null)?a:false;this.overflow=(l!=null)?l:"visible";this.labelPadding=(u!=null)?u:0;this.textDirection=h;this.rotation=0;this.updateMargin()}mxUtils.extend(mxText,mxShape);mxText.prototype.baseSpacingTop=0;mxText.prototype.baseSpacingBottom=0;mxText.prototype.baseSpacingLeft=0;mxText.prototype.baseSpacingRight=0;mxText.prototype.replaceLinefeeds=true;mxText.prototype.verticalTextRotation=-90;mxText.prototype.ignoreClippedStringSize=true;mxText.prototype.ignoreStringSize=false;mxText.prototype.textWidthPadding=(document.documentMode==8&&!mxClient.IS_EM)?4:3;mxText.prototype.lastValue=null;mxText.prototype.cacheEnabled=true;mxText.prototype.isParseVml=function(){return false};mxText.prototype.isHtmlAllowed=function(){return document.documentMode!=8||mxClient.IS_EM};mxText.prototype.getSvgScreenOffset=function(){return 0};mxText.prototype.checkBounds=function(){return(!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds!=null&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height))};mxText.prototype.paint=function(i,e){var n=this.scale;var l=this.bounds.x/n;var k=this.bounds.y/n;var m=this.bounds.width/n;var g=this.bounds.height/n;this.updateTransform(i,l,k,m,g);this.configureCanvas(i,l,k,m,g);if(e){var j=(this.state!=null)?this.state.unscaledWidth:null;if(this.node.firstChild!=null&&this.lastUnscaledWidth!=j){i.invalidateCachedOffsetSize(this.node)}i.updateText(l,k,m,g,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node)}else{var f=mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML;var b=(f||i instanceof mxVmlCanvas2D)?"html":"";var a=this.value;if(!f&&b=="html"){a=mxUtils.htmlEntities(a,false)}if(b=="html"&&!mxUtils.isNode(this.value)){a=mxUtils.replaceTrailingNewlines(a,"<div><br></div>")}a=(!mxUtils.isNode(this.value)&&this.replaceLinefeeds&&b=="html")?a.replace(/\n/g,"<br/>"):a;var d=this.textDirection;if(d==mxConstants.TEXT_DIRECTION_AUTO&&!f){d=this.getAutoDirection()}if(d!=mxConstants.TEXT_DIRECTION_LTR&&d!=mxConstants.TEXT_DIRECTION_RTL){d=null}i.text(l,k,m,g,a,this.align,this.valign,this.wrap,b,this.overflow,this.clipped,this.getTextRotation(),d)}this.lastUnscaledWidth=(this.state!=null)?this.state.unscaledWidth:null};mxText.prototype.redraw=function(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue==this.value&&(mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML)){if(this.node.nodeName=="DIV"&&(this.isHtmlAllowed()||!mxClient.IS_VML)){this.updateSize(this.node,(this.state==null||this.state.view.textDiv==null));if(mxClient.IS_IE&&(document.documentMode==null||document.documentMode<=8)){this.updateHtmlFilter()}else{this.updateHtmlTransform()}this.updateBoundingBox()}else{var a=this.createCanvas();if(a!=null&&a.updateText!=null&&a.invalidateCachedOffsetSize!=null){this.paint(a,true);this.destroyCanvas(a);this.updateBoundingBox()}else{mxShape.prototype.redraw.apply(this,arguments)}}}else{mxShape.prototype.redraw.apply(this,arguments);if(mxUtils.isNode(this.value)||this.dialect==mxConstants.DIALECT_STRICTHTML){this.lastValue=this.value}else{this.lastValue=null}}};mxText.prototype.resetStyles=function(){mxShape.prototype.resetStyles.apply(this,arguments);this.color="black";this.align=mxConstants.ALIGN_CENTER;this.valign=mxConstants.ALIGN_MIDDLE;this.family=mxConstants.DEFAULT_FONTFAMILY;this.size=mxConstants.DEFAULT_FONTSIZE;this.fontStyle=mxConstants.DEFAULT_FONTSTYLE;this.spacing=2;this.spacingTop=0;this.spacingRight=0;this.spacingBottom=0;this.spacingLeft=0;this.horizontal=true;delete this.background;delete this.border;this.textDirection=mxConstants.DEFAULT_TEXT_DIRECTION;delete this.margin};mxText.prototype.apply=function(a){mxShape.prototype.apply.apply(this,arguments);if(this.style!=null){this.fontStyle=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSTYLE,this.fontStyle);this.family=mxUtils.getValue(this.style,mxConstants.STYLE_FONTFAMILY,this.family);this.size=mxUtils.getValue(this.style,mxConstants.STYLE_FONTSIZE,this.size);this.color=mxUtils.getValue(this.style,mxConstants.STYLE_FONTCOLOR,this.color);this.align=mxUtils.getValue(this.style,mxConstants.STYLE_ALIGN,this.align);this.valign=mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_ALIGN,this.valign);this.spacing=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING,this.spacing);this.spacingTop=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_TOP,this.spacingTop)+this.spacing;this.spacingRight=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_RIGHT,this.spacingRight)+this.spacing;this.spacingBottom=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_BOTTOM,this.spacingBottom)+this.spacing;this.spacingLeft=mxUtils.getValue(this.style,mxConstants.STYLE_SPACING_LEFT,this.spacingLeft)+this.spacing;this.horizontal=mxUtils.getValue(this.style,mxConstants.STYLE_HORIZONTAL,this.horizontal);this.background=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BACKGROUNDCOLOR,this.background);this.border=mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_BORDERCOLOR,this.border);this.textDirection=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);this.opacity=mxUtils.getValue(this.style,mxConstants.STYLE_TEXT_OPACITY,100);this.updateMargin()}this.flipV=null;this.flipH=null};mxText.prototype.getAutoDirection=function(){var a=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(this.value);return(a!=null&&a.length>0&&a[0]>"z")?mxConstants.TEXT_DIRECTION_RTL:mxConstants.TEXT_DIRECTION_LTR};mxText.prototype.updateBoundingBox=function(){var d=this.node;this.boundingBox=this.bounds.clone();var a=this.getTextRotation();var g=(this.style!=null)?mxUtils.getValue(this.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER):null;var o=(this.style!=null)?mxUtils.getValue(this.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE):null;if(!this.ignoreStringSize&&d!=null&&this.overflow!="fill"&&(!this.clipped||!this.ignoreClippedStringSize||g!=mxConstants.ALIGN_CENTER||o!=mxConstants.ALIGN_MIDDLE)){var c=null;var n=null;if(d.ownerSVGElement!=null){if(d.firstChild!=null&&d.firstChild.firstChild!=null&&d.firstChild.firstChild.nodeName=="foreignObject"){d=d.firstChild.firstChild;c=parseInt(d.getAttribute("width"))*this.scale;n=parseInt(d.getAttribute("height"))*this.scale}else{try{var l=d.getBBox();if(typeof(this.value)=="string"&&mxUtils.trim(this.value)==0){this.boundingBox=null}else{if(l.width==0&&l.height==0){this.boundingBox=null}else{this.boundingBox=new mxRectangle(l.x,l.y,l.width,l.height)}}return}catch(i){}}}else{var f=(this.state!=null)?this.state.view.textDiv:null;if(this.offsetWidth!=null&&this.offsetHeight!=null){c=this.offsetWidth*this.scale;n=this.offsetHeight*this.scale}else{if(f!=null){this.updateFont(f);this.updateSize(f,false);this.updateInnerHtml(f);d=f}var j=d;if(document.documentMode==8&&!mxClient.IS_EM){var m=Math.round(this.bounds.width/this.scale);if(this.wrap&&m>0){d.style.wordWrap=mxConstants.WORD_WRAP;d.style.whiteSpace="normal";if(d.style.wordWrap!="break-word"){var k=j.getElementsByTagName("div");if(k.length>0){j=k[k.length-1]}c=j.offsetWidth+2;k=this.node.getElementsByTagName("div");if(this.clipped){c=Math.min(m,c)}if(k.length>1){k[k.length-2].style.width=c+"px"}}}else{d.style.whiteSpace="nowrap"}}else{if(j.firstChild!=null&&j.firstChild.nodeName=="DIV"){j=j.firstChild}}this.offsetWidth=j.offsetWidth+this.textWidthPadding;this.offsetHeight=j.offsetHeight;c=this.offsetWidth*this.scale;n=this.offsetHeight*this.scale}}if(c!=null&&n!=null){this.boundingBox=new mxRectangle(this.bounds.x,this.bounds.y,c,n)}}if(this.boundingBox!=null){if(a!=0){var p=mxUtils.getBoundingBox(new mxRectangle(this.margin.x*this.boundingBox.width,this.margin.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),a,new mxPoint(0,0));this.unrotatedBoundingBox=mxRectangle.fromRectangle(this.boundingBox);this.unrotatedBoundingBox.x+=this.margin.x*this.unrotatedBoundingBox.width;this.unrotatedBoundingBox.y+=this.margin.y*this.unrotatedBoundingBox.height;this.boundingBox.x+=p.x;this.boundingBox.y+=p.y;this.boundingBox.width=p.width;this.boundingBox.height=p.height}else{this.boundingBox.x+=this.margin.x*this.boundingBox.width;this.boundingBox.y+=this.margin.y*this.boundingBox.height;this.unrotatedBoundingBox=null}}};mxText.prototype.getShapeRotation=function(){return 0};mxText.prototype.getTextRotation=function(){return(this.state!=null&&this.state.shape!=null)?this.state.shape.getTextRotation():0};mxText.prototype.isPaintBoundsInverted=function(){return !this.horizontal&&this.state!=null&&this.state.view.graph.model.isVertex(this.state.cell)};mxText.prototype.configureCanvas=function(f,a,e,b,d){mxShape.prototype.configureCanvas.apply(this,arguments);f.setFontColor(this.color);f.setFontBackgroundColor(this.background);f.setFontBorderColor(this.border);f.setFontFamily(this.family);f.setFontSize(this.size);f.setFontStyle(this.fontStyle)};mxText.prototype.updateVmlContainer=function(){this.node.style.left=Math.round(this.bounds.x)+"px";this.node.style.top=Math.round(this.bounds.y)+"px";this.node.style.width="1px";this.node.style.height="1px";this.node.style.overflow="visible"};mxText.prototype.redrawHtmlShape=function(){var a=this.node.style;a.whiteSpace="normal";a.overflow="";a.width="";a.height="";this.updateValue();this.updateFont(this.node);this.updateSize(this.node,(this.state==null||this.state.view.textDiv==null));this.offsetWidth=null;this.offsetHeight=null;if(mxClient.IS_IE&&(document.documentMode==null||document.documentMode<=8)){this.updateHtmlFilter()}else{this.updateHtmlTransform()}};mxText.prototype.updateHtmlTransform=function(){var c=this.getTextRotation();var d=this.node.style;var b=this.margin.x;var a=this.margin.y;if(c!=0){mxUtils.setPrefixedStyle(d,"transformOrigin",(-b*100)+"% "+(-a*100)+"%");mxUtils.setPrefixedStyle(d,"transform","translate("+(b*100)+"%,"+(a*100)+"%)scale("+this.scale+") rotate("+c+"deg)")}else{mxUtils.setPrefixedStyle(d,"transformOrigin","0% 0%");mxUtils.setPrefixedStyle(d,"transform","scale("+this.scale+")translate("+(b*100)+"%,"+(a*100)+"%)")}d.left=Math.round(this.bounds.x-Math.ceil(b*((this.overflow!="fill"&&this.overflow!="width")?3:1)))+"px";d.top=Math.round(this.bounds.y-a*((this.overflow!="fill")?3:1))+"px";if(this.opacity<100){d.opacity=this.opacity/100}else{d.opacity=""}};mxText.prototype.updateInnerHtml=function(a){if(mxUtils.isNode(this.value)){a.innerHTML=this.value.outerHTML}else{var b=this.value;if(this.dialect!=mxConstants.DIALECT_STRICTHTML){b=mxUtils.htmlEntities(b,false)}b=mxUtils.replaceTrailingNewlines(b,"<div>&nbsp;</div>");b=(this.replaceLinefeeds)?b.replace(/\n/g,"<br/>"):b;b='<div style="display:inline-block;_display:inline;">'+b+"</div>";a.innerHTML=b}};mxText.prototype.updateHtmlFilter=function(){var q=this.node.style;var l=this.margin.x;var j=this.margin.y;var m=this.scale;mxUtils.setOpacity(this.node,this.opacity);var g=0;var n=0;var i=(this.state!=null)?this.state.view.textDiv:null;var d=this.node;if(i!=null){i.style.overflow="";i.style.height="";i.style.width="";this.updateFont(i);this.updateSize(i,false);this.updateInnerHtml(i);var k=Math.round(this.bounds.width/this.scale);if(this.wrap&&k>0){i.style.whiteSpace="normal";i.style.wordWrap=mxConstants.WORD_WRAP;g=k;if(this.clipped){g=Math.min(g,this.bounds.width)}i.style.width=g+"px"}else{i.style.whiteSpace="nowrap"}d=i;if(d.firstChild!=null&&d.firstChild.nodeName=="DIV"){d=d.firstChild;if(this.wrap&&i.style.wordWrap=="break-word"){d.style.width="100%"}}if(!this.clipped&&this.wrap&&k>0){g=d.offsetWidth+this.textWidthPadding;i.style.width=g+"px"}n=d.offsetHeight+2;if(mxClient.IS_QUIRKS&&this.border!=null&&this.border!=mxConstants.NONE){n+=3}}else{if(d.firstChild!=null&&d.firstChild.nodeName=="DIV"){d=d.firstChild;n=d.offsetHeight}}g=d.offsetWidth+this.textWidthPadding;if(this.clipped){n=Math.min(n,this.bounds.height)}var k=this.bounds.width/m;var p=this.bounds.height/m;if(this.overflow=="fill"){n=p;g=k}else{if(this.overflow=="width"){n=d.scrollHeight;g=k}}this.offsetWidth=g;this.offsetHeight=n;if(mxClient.IS_QUIRKS&&(this.clipped||(this.overflow=="width"&&p>0))){p=Math.min(p,n);q.height=Math.round(p)+"px"}else{p=n}if(this.overflow!="fill"&&this.overflow!="width"){if(this.clipped){g=Math.min(k,g)}k=g;if((mxClient.IS_QUIRKS&&this.clipped)||this.wrap){q.width=Math.round(k)+"px"}}p*=m;k*=m;var v=this.getTextRotation()*(Math.PI/180);var e=parseFloat(parseFloat(Math.cos(v)).toFixed(8));var b=parseFloat(parseFloat(Math.sin(-v)).toFixed(8));v%=2*Math.PI;if(v<0){v+=2*Math.PI}v%=Math.PI;if(v>Math.PI/2){v=Math.PI-v}var c=Math.cos(v);var a=Math.sin(-v);var u=k*-(l+0.5);var t=p*-(j+0.5);var x=(p-p*c+k*a)/2+b*u-e*t;var o=(k-k*c+p*a)/2-e*u-b*t;if(v!=0){var r="progid:DXImageTransform.Microsoft.Matrix(M11="+e+", M12="+b+", M21="+(-b)+", M22="+e+", sizingMethod='auto expand')";if(q.filter!=null&&q.filter.length>0){q.filter+=" "+r}else{q.filter=r}}var j=0;if(this.overflow!="fill"&&mxClient.IS_QUIRKS){if(this.valign==mxConstants.ALIGN_TOP){j-=1}else{if(this.valign==mxConstants.ALIGN_BOTTOM){j+=2}else{j+=1}}}q.zoom=m;q.left=Math.round(this.bounds.x+o-k/2)+"px";q.top=Math.round(this.bounds.y+x-p/2+j)+"px"};mxText.prototype.updateValue=function(){if(mxUtils.isNode(this.value)){this.node.innerHTML="";this.node.appendChild(this.value)}else{var g=this.value;if(this.dialect!=mxConstants.DIALECT_STRICTHTML){g=mxUtils.htmlEntities(g,false)}g=mxUtils.replaceTrailingNewlines(g,"<div><br></div>");g=(this.replaceLinefeeds)?g.replace(/\n/g,"<br/>"):g;var d=(this.background!=null&&this.background!=mxConstants.NONE)?this.background:null;var f=(this.border!=null&&this.border!=mxConstants.NONE)?this.border:null;if(this.overflow=="fill"||this.overflow=="width"){if(d!=null){this.node.style.backgroundColor=d}if(f!=null){this.node.style.border="1px solid "+f}}else{var c="";if(d!=null){c+="background-color:"+d+";"}if(f!=null){c+="border:1px solid "+f+";"}var a=(mxConstants.ABSOLUTE_LINE_HEIGHT)?(this.size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;g='<div style="zoom:1;'+c+"display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:"+a+'">'+g+"</div>"}this.node.innerHTML=g;var e=this.node.getElementsByTagName("div");if(e.length>0){var b=this.textDirection;if(b==mxConstants.TEXT_DIRECTION_AUTO&&this.dialect!=mxConstants.DIALECT_STRICTHTML){b=this.getAutoDirection()}if(b==mxConstants.TEXT_DIRECTION_LTR||b==mxConstants.TEXT_DIRECTION_RTL){e[e.length-1].setAttribute("dir",b)}else{e[e.length-1].removeAttribute("dir")}}}};mxText.prototype.updateFont=function(b){var a=b.style;a.lineHeight=(mxConstants.ABSOLUTE_LINE_HEIGHT)?(this.size*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;a.fontSize=this.size+"px";a.fontFamily=this.family;a.verticalAlign="top";a.color=this.color;if((this.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD){a.fontWeight="bold"}else{a.fontWeight=""}if((this.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC){a.fontStyle="italic"}else{a.fontStyle=""}if((this.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE){a.textDecoration="underline"}else{a.textDecoration=""}if(this.align==mxConstants.ALIGN_CENTER){a.textAlign="center"}else{if(this.align==mxConstants.ALIGN_RIGHT){a.textAlign="right"}else{a.textAlign="left"}}};mxText.prototype.updateSize=function(g,b){var a=Math.max(0,Math.round(this.bounds.width/this.scale));var e=Math.max(0,Math.round(this.bounds.height/this.scale));var d=g.style;if(this.clipped){d.overflow="hidden";if(!mxClient.IS_QUIRKS){d.maxHeight=e+"px";d.maxWidth=a+"px"}else{d.width=a+"px"}}else{if(this.overflow=="fill"){d.width=(a+1)+"px";d.height=(e+1)+"px";d.overflow="hidden"}else{if(this.overflow=="width"){d.width=(a+1)+"px";d.maxHeight=(e+1)+"px";d.overflow="hidden"}}}if(this.wrap&&a>0){d.wordWrap=mxConstants.WORD_WRAP;d.whiteSpace="normal";d.width=a+"px";if(b&&this.overflow!="fill"&&this.overflow!="width"){var i=g;if(i.firstChild!=null&&i.firstChild.nodeName=="DIV"){i=i.firstChild;if(g.style.wordWrap=="break-word"){i.style.width="100%"}}var c=i.offsetWidth;if(c==0){var f=g.parentNode;g.style.visibility="hidden";document.body.appendChild(g);c=i.offsetWidth;g.style.visibility="";f.appendChild(g)}c+=3;if(this.clipped){c=Math.min(c,a)}d.width=c+"px"}}else{d.whiteSpace="nowrap"}};mxText.prototype.updateMargin=function(){this.margin=mxUtils.getAlignmentAsPoint(this.align,this.valign)};mxText.prototype.getSpacing=function(){var b=0;var a=0;if(this.align==mxConstants.ALIGN_CENTER){b=(this.spacingLeft-this.spacingRight)/2}else{if(this.align==mxConstants.ALIGN_RIGHT){b=-this.spacingRight-this.baseSpacingRight}else{b=this.spacingLeft+this.baseSpacingLeft}}if(this.valign==mxConstants.ALIGN_MIDDLE){a=(this.spacingTop-this.spacingBottom)/2}else{if(this.valign==mxConstants.ALIGN_BOTTOM){a=-this.spacingBottom-this.baseSpacingBottom}else{a=this.spacingTop+this.baseSpacingTop}}return new mxPoint(b,a)};