function mxDefaultToolbar(a,b){this.editor=b;if(a!=null&&b!=null){this.init(a)}}mxDefaultToolbar.prototype.editor=null;mxDefaultToolbar.prototype.toolbar=null;mxDefaultToolbar.prototype.resetHandler=null;mxDefaultToolbar.prototype.spacing=4;mxDefaultToolbar.prototype.connectOnDrop=false;mxDefaultToolbar.prototype.init=function(a){if(a!=null){this.toolbar=new mxToolbar(a);this.toolbar.addListener(mxEvent.SELECT,mxUtils.bind(this,function(d,c){var b=c.getProperty("function");if(b!=null){this.editor.insertFunction=mxUtils.bind(this,function(){b.apply(this,arguments);this.toolbar.resetMode()})}else{this.editor.insertFunction=null}}));this.resetHandler=mxUtils.bind(this,function(){if(this.toolbar!=null){this.toolbar.resetMode(true)}});this.editor.graph.addListener(mxEvent.DOUBLE_CLICK,this.resetHandler);this.editor.addListener(mxEvent.ESCAPE,this.resetHandler)}};mxDefaultToolbar.prototype.addItem=function(d,a,c,b){var e=mxUtils.bind(this,function(){if(c!=null&&c.length>0){this.editor.execute(c)}});return this.toolbar.addItem(d,a,e,b)};mxDefaultToolbar.prototype.addSeparator=function(a){a=a||mxClient.imageBasePath+"/separator.gif";this.toolbar.addSeparator(a)};mxDefaultToolbar.prototype.addCombo=function(){return this.toolbar.addCombo()};mxDefaultToolbar.prototype.addActionCombo=function(a){return this.toolbar.addActionCombo(a)};mxDefaultToolbar.prototype.addActionOption=function(b,c,a){var d=mxUtils.bind(this,function(){this.editor.execute(a)});this.addOption(b,c,d)};mxDefaultToolbar.prototype.addOption=function(b,c,a){return this.toolbar.addOption(b,c,a)};mxDefaultToolbar.prototype.addMode=function(e,b,d,c,a){var f=mxUtils.bind(this,function(){this.editor.setMode(d);if(a!=null){a(this.editor)}});return this.toolbar.addSwitchMode(e,b,f,c)};mxDefaultToolbar.prototype.addPrototype=function(h,g,j,b,i,e){var d=mxUtils.bind(this,function(){if(typeof(j)=="function"){return j()}else{if(j!=null){return this.editor.graph.cloneCells([j])[0]}}return null});var f=mxUtils.bind(this,function(l,k){if(typeof(i)=="function"){i(this.editor,d(),l,k)}else{this.drop(d(),l,k)}this.toolbar.resetMode();mxEvent.consume(l)});var c=this.toolbar.addMode(h,g,f,b,null,e);var a=function(m,l,k){f(l,k)};this.installDropHandler(c,a);return c};mxDefaultToolbar.prototype.drop=function(d,a,e){var c=this.editor.graph;var b=c.getModel();if(e==null||b.isEdge(e)||!this.connectOnDrop||!c.isCellConnectable(e)){while(e!=null&&!c.isValidDropTarget(e,[d],a)){e=b.getParent(e)}this.insert(d,a,e)}else{this.connect(d,a,e)}};mxDefaultToolbar.prototype.insert=function(d,b,f){var c=this.editor.graph;if(c.canImportCell(d)){var a=mxEvent.getClientX(b);var g=mxEvent.getClientY(b);var e=mxUtils.convertPoint(c.container,a,g);if(c.isSplitEnabled()&&c.isSplitTarget(f,[d],b)){return c.splitEdge(f,[d],null,e.x,e.y)}else{return this.editor.addVertex(f,d,e.x,e.y)}}return null};mxDefaultToolbar.prototype.connect=function(f,l,a){var m=this.editor.graph;var e=m.getModel();if(a!=null&&m.isCellConnectable(f)&&m.isEdgeValid(null,a,f)){var b=null;e.beginUpdate();try{var d=e.getGeometry(a);var h=e.getGeometry(f).clone();h.x=d.x+(d.width-h.width)/2;h.y=d.y+(d.height-h.height)/2;var c=this.spacing*m.gridSize;var i=e.getDirectedEdgeCount(a,true)*20;if(this.editor.horizontalFlow){h.x+=(h.width+d.width)/2+c+i}else{h.y+=(h.height+d.height)/2+c+i}f.setGeometry(h);var k=e.getParent(a);m.addCell(f,k);m.constrainChild(f);b=this.editor.createEdge(a,f);if(e.getGeometry(b)==null){var j=new mxGeometry();j.relative=true;e.setGeometry(b,j)}m.addEdge(b,k,a,f)}finally{e.endUpdate()}m.setSelectionCells([f,b]);m.scrollCellToVisible(f)}};mxDefaultToolbar.prototype.installDropHandler=function(c,b){var d=document.createElement("img");d.setAttribute("src",c.getAttribute("src"));var a=mxUtils.bind(this,function(e){d.style.width=(2*c.offsetWidth)+"px";d.style.height=(2*c.offsetHeight)+"px";mxUtils.makeDraggable(c,this.editor.graph,b,d);mxEvent.removeListener(d,"load",a)});if(mxClient.IS_IE){a()}else{mxEvent.addListener(d,"load",a)}};mxDefaultToolbar.prototype.destroy=function(){if(this.resetHandler!=null){this.editor.graph.removeListener("dblclick",this.resetHandler);this.editor.removeListener("escape",this.resetHandler);this.resetHandler=null}if(this.toolbar!=null){this.toolbar.destroy();this.toolbar=null}};