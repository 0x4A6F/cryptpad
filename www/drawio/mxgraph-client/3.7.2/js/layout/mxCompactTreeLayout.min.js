function mxCompactTreeLayout(b,a,c){mxGraphLayout.call(this,b);this.horizontal=(a!=null)?a:true;this.invert=(c!=null)?c:false}mxCompactTreeLayout.prototype=new mxGraphLayout();mxCompactTreeLayout.prototype.constructor=mxCompactTreeLayout;mxCompactTreeLayout.prototype.horizontal=null;mxCompactTreeLayout.prototype.invert=null;mxCompactTreeLayout.prototype.resizeParent=true;mxCompactTreeLayout.prototype.maintainParentLocation=false;mxCompactTreeLayout.prototype.groupPadding=10;mxCompactTreeLayout.prototype.groupPaddingTop=0;mxCompactTreeLayout.prototype.groupPaddingRight=0;mxCompactTreeLayout.prototype.groupPaddingBottom=0;mxCompactTreeLayout.prototype.groupPaddingLeft=0;mxCompactTreeLayout.prototype.parentsChanged=null;mxCompactTreeLayout.prototype.moveTree=false;mxCompactTreeLayout.prototype.visited=null;mxCompactTreeLayout.prototype.levelDistance=10;mxCompactTreeLayout.prototype.nodeDistance=20;mxCompactTreeLayout.prototype.resetEdges=true;mxCompactTreeLayout.prototype.prefHozEdgeSep=5;mxCompactTreeLayout.prototype.prefVertEdgeOff=4;mxCompactTreeLayout.prototype.minEdgeJetty=8;mxCompactTreeLayout.prototype.channelBuffer=4;mxCompactTreeLayout.prototype.edgeRouting=true;mxCompactTreeLayout.prototype.sortEdges=false;mxCompactTreeLayout.prototype.alignRanks=false;mxCompactTreeLayout.prototype.maxRankHeight=null;mxCompactTreeLayout.prototype.root=null;mxCompactTreeLayout.prototype.node=null;mxCompactTreeLayout.prototype.isVertexIgnored=function(a){return mxGraphLayout.prototype.isVertexIgnored.apply(this,arguments)||this.graph.getConnections(a).length==0};mxCompactTreeLayout.prototype.isHorizontal=function(){return this.horizontal};mxCompactTreeLayout.prototype.execute=function(k,h){this.parent=k;var e=this.graph.getModel();if(h==null){if(this.graph.getEdges(k,e.getParent(k),this.invert,!this.invert,false).length>0){this.root=k}else{var l=this.graph.findTreeRoots(k,true,this.invert);if(l.length>0){for(var d=0;d<l.length;d++){if(!this.isVertexIgnored(l[d])&&this.graph.getEdges(l[d],null,this.invert,!this.invert,false).length>0){this.root=l[d];break}}}}}else{this.root=h}if(this.root!=null){if(this.resizeParent){this.parentsChanged=new Object()}else{this.parentsChanged=null}this.parentX=null;this.parentY=null;if(k!=this.root&&e.isVertex(k)!=null&&this.maintainParentLocation){var c=this.graph.getCellGeometry(k);if(c!=null){this.parentX=c.x;this.parentY=c.y}}e.beginUpdate();try{this.visited=new Object();this.node=this.dfs(this.root,k);if(this.alignRanks){this.maxRankHeight=[];this.findRankHeights(this.node,0);this.setCellHeights(this.node,0)}if(this.node!=null){this.layout(this.node);var b=this.graph.gridSize;var j=b;if(!this.moveTree){var f=this.getVertexBounds(this.root);if(f!=null){b=f.x;j=f.y}}var a=null;if(this.isHorizontal()){a=this.horizontalLayout(this.node,b,j)}else{a=this.verticalLayout(this.node,null,b,j)}if(a!=null){var n=0;var m=0;if(a.x<0){n=Math.abs(b-a.x)}if(a.y<0){m=Math.abs(j-a.y)}if(n!=0||m!=0){this.moveNode(this.node,n,m)}if(this.resizeParent){this.adjustParents()}if(this.edgeRouting){this.localEdgeProcessing(this.node)}}if(this.parentX!=null&&this.parentY!=null){var c=this.graph.getCellGeometry(k);if(c!=null){c=c.clone();c.x=this.parentX;c.y=this.parentY;e.setGeometry(k,c)}}}}finally{e.endUpdate()}}};mxCompactTreeLayout.prototype.moveNode=function(c,b,a){c.x+=b;c.y+=a;this.apply(c);var d=c.child;while(d!=null){this.moveNode(d,b,a);d=d.next}};mxCompactTreeLayout.prototype.sortOutgoingEdges=function(b,a){var c=new mxDictionary();a.sort(function(i,g){var e=i.getTerminal(i.getTerminal(false)==b);var h=c.get(e);if(h==null){h=mxCellPath.create(e).split(mxCellPath.PATH_SEPARATOR);c.put(e,h)}var d=g.getTerminal(g.getTerminal(false)==b);var f=c.get(d);if(f==null){f=mxCellPath.create(d).split(mxCellPath.PATH_SEPARATOR);c.put(d,f)}return mxCellPath.compare(h,f)})};mxCompactTreeLayout.prototype.findRankHeights=function(a,b){if(this.maxRankHeight[b]==null||this.maxRankHeight[b]<a.height){this.maxRankHeight[b]=a.height}var c=a.child;while(c!=null){this.findRankHeights(c,b+1);c=c.next}};mxCompactTreeLayout.prototype.setCellHeights=function(a,b){if(this.maxRankHeight[b]!=null&&this.maxRankHeight[b]>a.height){a.height=this.maxRankHeight[b]}var c=a.child;while(c!=null){this.setCellHeights(c,b+1);c=c.next}};mxCompactTreeLayout.prototype.dfs=function(n,m){var b=mxCellPath.create(n);var d=null;if(n!=null&&this.visited[b]==null&&!this.isVertexIgnored(n)){this.visited[b]=n;d=this.createNode(n);var j=this.graph.getModel();var e=null;var f=this.graph.getEdges(n,m,this.invert,!this.invert,false,true);var l=this.graph.getView();if(this.sortEdges){this.sortOutgoingEdges(n,f)}for(var h=0;h<f.length;h++){var c=f[h];if(!this.isEdgeIgnored(c)){if(this.resetEdges){this.setEdgePoints(c,null)}if(this.edgeRouting){this.setEdgeStyleEnabled(c,false);this.setEdgePoints(c,null)}var a=l.getState(c);var k=(a!=null)?a.getVisibleTerminal(this.invert):l.getVisibleTerminal(c,this.invert);var g=this.dfs(k,m);if(g!=null&&j.getGeometry(k)!=null){if(e==null){d.child=g}else{e.next=g}e=g}}}}return d};mxCompactTreeLayout.prototype.layout=function(a){if(a!=null){var b=a.child;while(b!=null){this.layout(b);b=b.next}if(a.child!=null){this.attachParent(a,this.join(a))}else{this.layoutLeaf(a)}}};mxCompactTreeLayout.prototype.horizontalLayout=function(f,b,e,d){f.x+=b+f.offsetX;f.y+=e+f.offsetY;d=this.apply(f,d);var g=f.child;if(g!=null){d=this.horizontalLayout(g,f.x,f.y,d);var a=f.y+g.offsetY;var c=g.next;while(c!=null){d=this.horizontalLayout(c,f.x+g.offsetX,a,d);a+=c.offsetY;c=c.next}}return d};mxCompactTreeLayout.prototype.verticalLayout=function(g,d,b,f,e){g.x+=b+g.offsetY;g.y+=f+g.offsetX;e=this.apply(g,e);var h=g.child;if(h!=null){e=this.verticalLayout(h,g,g.x,g.y,e);var a=g.x+h.offsetY;var c=h.next;while(c!=null){e=this.verticalLayout(c,g,a,g.y+h.offsetX,e);a+=c.offsetY;c=c.next}}return e};mxCompactTreeLayout.prototype.attachParent=function(e,b){var a=this.nodeDistance+this.levelDistance;var c=(b-e.width)/2-this.nodeDistance;var d=c+e.width+2*this.nodeDistance-b;e.child.offsetX=a+e.height;e.child.offsetY=d;e.contour.upperHead=this.createLine(e.height,0,this.createLine(a,d,e.contour.upperHead));e.contour.lowerHead=this.createLine(e.height,0,this.createLine(a,c,e.contour.lowerHead))};mxCompactTreeLayout.prototype.layoutLeaf=function(a){var b=2*this.nodeDistance;a.contour.upperTail=this.createLine(a.height+b,0);a.contour.upperHead=a.contour.upperTail;a.contour.lowerTail=this.createLine(0,-a.width-b);a.contour.lowerHead=this.createLine(a.height+b,0,a.contour.lowerTail)};mxCompactTreeLayout.prototype.join=function(c){var f=2*this.nodeDistance;var g=c.child;c.contour=g.contour;var b=g.width+f;var a=b;g=g.next;while(g!=null){var e=this.merge(c.contour,g.contour);g.offsetY=e+b;g.offsetX=0;b=g.width+f;a+=e+b;g=g.next}return a};mxCompactTreeLayout.prototype.merge=function(k,i){var h=0;var f=0;var g=0;var j=k.lowerHead;var a=i.upperHead;while(a!=null&&j!=null){var c=this.offset(h,f,a.dx,a.dy,j.dx,j.dy);f+=c;g+=c;if(h+a.dx<=j.dx){h+=a.dx;f+=a.dy;a=a.next}else{h-=j.dx;f-=j.dy;j=j.next}}if(a!=null){var e=this.bridge(k.upperTail,0,0,a,h,f);k.upperTail=(e.next!=null)?i.upperTail:e;k.lowerTail=i.lowerTail}else{var e=this.bridge(i.lowerTail,h,f,j,0,0);if(e.next==null){k.lowerTail=e}}k.lowerHead=i.lowerHead;return g};mxCompactTreeLayout.prototype.offset=function(h,g,b,a,f,e){var c=0;if(f<=h||h+b<=0){return 0}var i=f*a-b*e;if(i>0){if(h<0){var j=h*a;c=j/b-g}else{if(h>0){var j=h*e;c=j/f-g}else{c=-g}}}else{if(f<h+b){var j=(f-h)*a;c=e-(g+j/b)}else{if(f>h+b){var j=(b+h)*e;c=j/f-(g+a)}else{c=e-(g+a)}}}if(c>0){return c}else{return 0}};mxCompactTreeLayout.prototype.bridge=function(g,c,e,f,b,d){var j=b+f.dx-c;var h=0;var i=0;if(f.dx==0){h=f.dy}else{i=j*f.dy;h=i/f.dx}var a=this.createLine(j,h,f.next);g.next=this.createLine(0,d+f.dy-h-e,a);return a};mxCompactTreeLayout.prototype.createNode=function(a){var b=new Object();b.cell=a;b.x=0;b.y=0;b.width=0;b.height=0;var c=this.getVertexBounds(a);if(c!=null){if(this.isHorizontal()){b.width=c.height;b.height=c.width}else{b.width=c.width;b.height=c.height}}b.offsetX=0;b.offsetY=0;b.contour=new Object();return b};mxCompactTreeLayout.prototype.apply=function(f,e){var b=this.graph.getModel();var a=f.cell;var d=b.getGeometry(a);if(a!=null&&d!=null){if(this.isVertexMovable(a)){d=this.setVertexLocation(a,f.x,f.y);if(this.resizeParent){var c=b.getParent(a);var h=mxCellPath.create(c);if(this.parentsChanged[h]==null){this.parentsChanged[h]=c}}}if(e==null){e=new mxRectangle(d.x,d.y,d.width,d.height)}else{e=new mxRectangle(Math.min(e.x,d.x),Math.min(e.y,d.y),Math.max(e.x+e.width,d.x+d.width),Math.max(e.y+e.height,d.y+d.height))}}return e};mxCompactTreeLayout.prototype.createLine=function(c,b,d){var a=new Object();a.dx=c;a.dy=b;a.next=d;return a};mxCompactTreeLayout.prototype.adjustParents=function(){var a=[];for(var b in this.parentsChanged){a.push(this.parentsChanged[b])}this.arrangeGroups(mxUtils.sortCells(a,true),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)};mxCompactTreeLayout.prototype.localEdgeProcessing=function(a){this.processNodeOutgoing(a);var b=a.child;while(b!=null){this.localEdgeProcessing(b);b=b.next}};mxCompactTreeLayout.prototype.processNodeOutgoing=function(p){var h=p.child;var t=p.cell;var s=0;var k=[];while(h!=null){s++;var g=h.x;if(this.horizontal){g=h.y}k.push(new WeightedCellSorter(h,g));h=h.next}k.sort(WeightedCellSorter.prototype.compare);var b=p.width;var e=(s+1)*this.prefHozEdgeSep;if(b>e+(2*this.prefHozEdgeSep)){b-=2*this.prefHozEdgeSep}var f=b/s;var a=f/2;if(b>e+(2*this.prefHozEdgeSep)){a+=this.prefHozEdgeSep}var n=this.minEdgeJetty-this.prefVertEdgeOff;var d=0;var u=this.getVertexBounds(t);h=p.child;for(var q=0;q<k.length;q++){var o=k[q].cell.cell;var w=this.getVertexBounds(o);var c=this.graph.getEdgesBetween(t,o,false);var v=[];var m=0;var l=0;for(var r=0;r<c.length;r++){if(this.horizontal){m=u.x+u.width;l=u.y+a;v.push(new mxPoint(m,l));m=u.x+u.width+n;v.push(new mxPoint(m,l));l=w.y+w.height/2;v.push(new mxPoint(m,l));this.setEdgePoints(c[r],v)}else{m=u.x+a;l=u.y+u.height;v.push(new mxPoint(m,l));l=u.y+u.height+n;v.push(new mxPoint(m,l));m=w.x+w.width/2;v.push(new mxPoint(m,l));this.setEdgePoints(c[r],v)}}if(q<s/2){n+=this.prefVertEdgeOff}else{if(q>s/2){n-=this.prefVertEdgeOff}}a+=f;d=Math.max(d,n)}};function WeightedCellSorter(a,b){this.cell=a;this.weightedValue=b}WeightedCellSorter.prototype.weightedValue=0;WeightedCellSorter.prototype.nudge=false;WeightedCellSorter.prototype.visited=false;WeightedCellSorter.prototype.rankIndex=null;WeightedCellSorter.prototype.cell=null;WeightedCellSorter.prototype.compare=function(d,c){if(d!=null&&c!=null){if(c.weightedValue>d.weightedValue){return 1}else{if(c.weightedValue<d.weightedValue){return -1}else{if(c.nudge){return 1}else{return -1}}}}else{return 0}};