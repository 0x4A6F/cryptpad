function mxGraphHierarchyModel(k,l,p,n,q){var o=k.getGraph();this.tightenToSource=q;this.roots=p;this.parent=n;this.vertexMapper=new mxDictionary();this.edgeMapper=new mxDictionary();this.maxRank=0;var m=[];if(l==null){l=this.graph.getChildVertices(n)}this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(k,l,m);for(var g=0;g<l.length;g++){var f=m[g].connectsAsSource;for(var e=0;e<f.length;e++){var h=f[e];var a=h.edges;if(a!=null&&a.length>0){var b=a[0];var c=k.getVisibleTerminal(b,false);var d=this.vertexMapper.get(c);if(m[g]==d){c=k.getVisibleTerminal(b,true);d=this.vertexMapper.get(c)}if(d!=null&&m[g]!=d){h.target=d;if(d.connectsAsTarget.length==0){d.connectsAsTarget=[]}if(mxUtils.indexOf(d.connectsAsTarget,h)<0){d.connectsAsTarget.push(h)}}}}m[g].temp[0]=1}}mxGraphHierarchyModel.prototype.maxRank=null;mxGraphHierarchyModel.prototype.vertexMapper=null;mxGraphHierarchyModel.prototype.edgeMapper=null;mxGraphHierarchyModel.prototype.ranks=null;mxGraphHierarchyModel.prototype.roots=null;mxGraphHierarchyModel.prototype.parent=null;mxGraphHierarchyModel.prototype.dfsCount=0;mxGraphHierarchyModel.prototype.SOURCESCANSTARTRANK=100000000;mxGraphHierarchyModel.prototype.tightenToSource=false;mxGraphHierarchyModel.prototype.createInternalCells=function(h,l,n){var p=h.getGraph();for(var f=0;f<l.length;f++){n[f]=new mxGraphHierarchyNode(l[f]);this.vertexMapper.put(l[f],n[f]);var a=h.getEdges(l[f]);n[f].connectsAsSource=[];for(var e=0;e<a.length;e++){var o=h.getVisibleTerminal(a[e],false);if(o!=l[f]&&h.graph.model.isVertex(o)&&!h.isVertexIgnored(o)){var m=h.getEdgesBetween(l[f],o,false);var d=h.getEdgesBetween(l[f],o,true);if(m!=null&&m.length>0&&this.edgeMapper.get(m[0])==null&&d.length*2>=m.length){var g=new mxGraphHierarchyEdge(m);for(var c=0;c<m.length;c++){var b=m[c];this.edgeMapper.put(b,g);p.resetEdge(b);if(h.disableEdgeStyle){h.setEdgeStyleEnabled(b,false);h.setOrthogonalEdge(b,true)}}g.source=n[f];if(mxUtils.indexOf(n[f].connectsAsSource,g)<0){n[f].connectsAsSource.push(g)}}}}n[f].temp[0]=0}};mxGraphHierarchyModel.prototype.initialRank=function(){var h=[];if(this.roots!=null){for(var k=0;k<this.roots.length;k++){var n=this.vertexMapper.get(this.roots[k]);if(n!=null){h.push(n)}}}var b=this.vertexMapper.getValues();for(var k=0;k<b.length;k++){b[k].temp[0]=-1}var m=h.slice();while(h.length>0){var n=h[0];var p;var o;p=n.connectsAsTarget;o=n.connectsAsSource;var c=true;var d=this.SOURCESCANSTARTRANK;for(var k=0;k<p.length;k++){var l=p[k];if(l.temp[0]==5270620){var g=l.source;d=Math.min(d,g.temp[0]-1)}else{c=false;break}}if(c){n.temp[0]=d;this.maxRank=Math.min(this.maxRank,d);if(o!=null){for(var k=0;k<o.length;k++){var l=o[k];l.temp[0]=5270620;var g=l.target;if(g.temp[0]==-1){h.push(g);g.temp[0]=-2}}}h.shift()}else{var e=h.shift();h.push(n);if(e==n&&h.length==1){break}}}for(var k=0;k<b.length;k++){b[k].temp[0]-=this.maxRank}for(var k=0;k<m.length;k++){var n=m[k];var a=0;var p=n.connectsAsSource;for(var f=0;f<p.length;f++){var l=p[f];var g=l.target;n.temp[0]=Math.max(a,g.temp[0]+1);a=n.temp[0]}}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank};mxGraphHierarchyModel.prototype.fixRanks=function(){var c=[];this.ranks=[];for(var d=0;d<this.maxRank+1;d++){c[d]=[];this.ranks[d]=c[d]}var f=null;if(this.roots!=null){var b=this.roots;f=[];for(var d=0;d<b.length;d++){var a=b[d];var e=this.vertexMapper.get(a);f[d]=e}}this.visit(function(l,n,m,k,h){if(h==0&&n.maxRank<0&&n.minRank<0){c[n.temp[0]].push(n);n.maxRank=n.temp[0];n.minRank=n.temp[0];n.temp[0]=c[n.maxRank].length-1}if(l!=null&&m!=null){var g=l.maxRank-n.maxRank;if(g>1){m.maxRank=l.maxRank;m.minRank=n.maxRank;m.temp=[];m.x=[];m.y=[];for(var j=m.minRank+1;j<m.maxRank;j++){c[j].push(m);m.setGeneralPurposeVariable(j,c[j].length-1)}}}},f,false,null)};mxGraphHierarchyModel.prototype.visit=function(e,a,d,b){if(a!=null){for(var c=0;c<a.length;c++){var f=a[c];if(f!=null){if(b==null){b=new Object()}if(d){f.hashCode=[];f.hashCode[0]=this.dfsCount;f.hashCode[1]=c;this.extendedDfs(null,f,null,e,b,f.hashCode,c,0)}else{this.dfs(null,f,null,e,b,0)}}}this.dfsCount++}};mxGraphHierarchyModel.prototype.dfs=function(j,h,l,f,a,e){if(h!=null){var k=h.id;if(a[k]==null){a[k]=h;f(j,h,l,e,0);var b=h.connectsAsSource.slice();for(var c=0;c<b.length;c++){var d=b[c];var g=d.target;this.dfs(h,g,d,f,a,e+1)}}else{f(j,h,l,e,1)}}};mxGraphHierarchyModel.prototype.extendedDfs=function(m,k,n,h,a,o,c,g){if(k!=null){if(m!=null){if(k.hashCode==null||k.hashCode[0]!=m.hashCode[0]){var b=m.hashCode.length+1;k.hashCode=m.hashCode.slice();k.hashCode[b-1]=c}}var l=k.id;if(a[l]==null){a[l]=k;h(m,k,n,g,0);var d=k.connectsAsSource.slice();for(var e=0;e<d.length;e++){var f=d[e];var j=f.target;this.extendedDfs(k,j,f,h,a,k.hashCode,e,g+1)}}else{h(m,k,n,g,1)}}};