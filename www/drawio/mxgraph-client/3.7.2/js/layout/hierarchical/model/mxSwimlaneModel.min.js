function mxSwimlaneModel(k,l,p,n,q){var o=k.getGraph();this.tightenToSource=q;this.roots=p;this.parent=n;this.vertexMapper=new mxDictionary();this.edgeMapper=new mxDictionary();this.maxRank=0;var m=[];if(l==null){l=this.graph.getChildVertices(n)}this.maxRank=this.SOURCESCANSTARTRANK;this.createInternalCells(k,l,m);for(var g=0;g<l.length;g++){var f=m[g].connectsAsSource;for(var e=0;e<f.length;e++){var h=f[e];var a=h.edges;if(a!=null&&a.length>0){var b=a[0];var c=k.getVisibleTerminal(b,false);var d=this.vertexMapper.get(c);if(m[g]==d){c=k.getVisibleTerminal(b,true);d=this.vertexMapper.get(c)}if(d!=null&&m[g]!=d){h.target=d;if(d.connectsAsTarget.length==0){d.connectsAsTarget=[]}if(mxUtils.indexOf(d.connectsAsTarget,h)<0){d.connectsAsTarget.push(h)}}}}m[g].temp[0]=1}}mxSwimlaneModel.prototype.maxRank=null;mxSwimlaneModel.prototype.vertexMapper=null;mxSwimlaneModel.prototype.edgeMapper=null;mxSwimlaneModel.prototype.ranks=null;mxSwimlaneModel.prototype.roots=null;mxSwimlaneModel.prototype.parent=null;mxSwimlaneModel.prototype.dfsCount=0;mxSwimlaneModel.prototype.SOURCESCANSTARTRANK=100000000;mxGraphHierarchyModel.prototype.tightenToSource=false;mxSwimlaneModel.prototype.ranksPerGroup=null;mxSwimlaneModel.prototype.createInternalCells=function(h,l,n){var q=h.getGraph();var o=h.swimlanes;for(var f=0;f<l.length;f++){n[f]=new mxGraphHierarchyNode(l[f]);this.vertexMapper.put(l[f],n[f]);n[f].swimlaneIndex=-1;for(var r=0;r<o.length;r++){if(q.model.getParent(l[f])==o[r]){n[f].swimlaneIndex=r;break}}var a=h.getEdges(l[f]);n[f].connectsAsSource=[];for(var e=0;e<a.length;e++){var p=h.getVisibleTerminal(a[e],false);if(p!=l[f]&&h.graph.model.isVertex(p)&&!h.isVertexIgnored(p)){var m=h.getEdgesBetween(l[f],p,false);var d=h.getEdgesBetween(l[f],p,true);if(m!=null&&m.length>0&&this.edgeMapper.get(m[0])==null&&d.length*2>=m.length){var g=new mxGraphHierarchyEdge(m);for(var c=0;c<m.length;c++){var b=m[c];this.edgeMapper.put(b,g);q.resetEdge(b);if(h.disableEdgeStyle){h.setEdgeStyleEnabled(b,false);h.setOrthogonalEdge(b,true)}}g.source=n[f];if(mxUtils.indexOf(n[f].connectsAsSource,g)<0){n[f].connectsAsSource.push(g)}}}}n[f].temp[0]=0}};mxSwimlaneModel.prototype.initialRank=function(){this.ranksPerGroup=[];var j=[];var a=new Object();if(this.roots!=null){for(var k=0;k<this.roots.length;k++){var n=this.vertexMapper.get(this.roots[k]);this.maxChainDfs(null,n,null,a,0);if(n!=null){j.push(n)}}}var c=[];var e=[];for(var k=this.ranksPerGroup.length-1;k>=0;k--){if(k==this.ranksPerGroup.length-1){c[k]=0}else{c[k]=e[k+1]+1}e[k]=c[k]+this.ranksPerGroup[k]}this.maxRank=e[0];var b=this.vertexMapper.getValues();for(var k=0;k<b.length;k++){b[k].temp[0]=-1}var m=j.slice();while(j.length>0){var n=j[0];var p;var o;p=n.connectsAsTarget;o=n.connectsAsSource;var d=true;var f=e[0];for(var k=0;k<p.length;k++){var l=p[k];if(l.temp[0]==5270620){var h=l.source;f=Math.min(f,h.temp[0]-1)}else{d=false;break}}if(d){if(f>e[n.swimlaneIndex]){f=e[n.swimlaneIndex]}n.temp[0]=f;if(o!=null){for(var k=0;k<o.length;k++){var l=o[k];l.temp[0]=5270620;var h=l.target;if(h.temp[0]==-1){j.push(h);h.temp[0]=-2}}}j.shift()}else{var g=j.shift();j.push(n);if(g==n&&j.length==1){break}}}};mxSwimlaneModel.prototype.maxChainDfs=function(j,h,l,a,d){if(h!=null){var k=mxCellPath.create(h.cell);if(a[k]==null){a[k]=h;var g=h.swimlaneIndex;if(this.ranksPerGroup[g]==null||this.ranksPerGroup[g]<d){this.ranksPerGroup[g]=d}var b=h.connectsAsSource.slice();for(var c=0;c<b.length;c++){var e=b[c];var f=e.target;if(h.swimlaneIndex<f.swimlaneIndex){this.maxChainDfs(h,f,e,mxUtils.clone(a,null,true),0)}else{if(h.swimlaneIndex==f.swimlaneIndex){this.maxChainDfs(h,f,e,mxUtils.clone(a,null,true),d+1)}}}}}};mxSwimlaneModel.prototype.fixRanks=function(){var c=[];this.ranks=[];for(var d=0;d<this.maxRank+1;d++){c[d]=[];this.ranks[d]=c[d]}var f=null;if(this.roots!=null){var b=this.roots;f=[];for(var d=0;d<b.length;d++){var a=b[d];var e=this.vertexMapper.get(a);f[d]=e}}this.visit(function(l,n,m,k,h){if(h==0&&n.maxRank<0&&n.minRank<0){c[n.temp[0]].push(n);n.maxRank=n.temp[0];n.minRank=n.temp[0];n.temp[0]=c[n.maxRank].length-1}if(l!=null&&m!=null){var g=l.maxRank-n.maxRank;if(g>1){m.maxRank=l.maxRank;m.minRank=n.maxRank;m.temp=[];m.x=[];m.y=[];for(var j=m.minRank+1;j<m.maxRank;j++){c[j].push(m);m.setGeneralPurposeVariable(j,c[j].length-1)}}}},f,false,null)};mxSwimlaneModel.prototype.visit=function(e,a,d,b){if(a!=null){for(var c=0;c<a.length;c++){var f=a[c];if(f!=null){if(b==null){b=new Object()}if(d){f.hashCode=[];f.hashCode[0]=this.dfsCount;f.hashCode[1]=c;this.extendedDfs(null,f,null,e,b,f.hashCode,c,0)}else{this.dfs(null,f,null,e,b,0)}}}this.dfsCount++}};mxSwimlaneModel.prototype.dfs=function(j,h,l,f,a,e){if(h!=null){var k=h.id;if(a[k]==null){a[k]=h;f(j,h,l,e,0);var b=h.connectsAsSource.slice();for(var c=0;c<b.length;c++){var d=b[c];var g=d.target;this.dfs(h,g,d,f,a,e+1)}}else{f(j,h,l,e,1)}}};mxSwimlaneModel.prototype.extendedDfs=function(n,l,o,j,a,p,c,h){if(l!=null){if(n!=null){if(l.hashCode==null||l.hashCode[0]!=n.hashCode[0]){var b=n.hashCode.length+1;l.hashCode=n.hashCode.slice();l.hashCode[b-1]=c}}var m=l.id;if(a[m]==null){a[m]=l;j(n,l,o,h,0);var e=l.connectsAsSource.slice();var d=l.connectsAsTarget.slice();for(var f=0;f<e.length;f++){var g=e[f];var k=g.target;if(l.swimlaneIndex<=k.swimlaneIndex){this.extendedDfs(l,k,g,j,a,l.hashCode,f,h+1)}}for(var f=0;f<d.length;f++){var g=d[f];var k=g.source;if(l.swimlaneIndex<k.swimlaneIndex){this.extendedDfs(l,k,g,j,a,l.hashCode,f,h+1)}}}else{j(n,l,o,h,1)}}};