function mxHierarchicalLayout(c,a,b){mxGraphLayout.call(this,c);this.orientation=(a!=null)?a:mxConstants.DIRECTION_NORTH;this.deterministic=(b!=null)?b:true}var mxHierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4};mxHierarchicalLayout.prototype=new mxGraphLayout();mxHierarchicalLayout.prototype.constructor=mxHierarchicalLayout;mxHierarchicalLayout.prototype.roots=null;mxHierarchicalLayout.prototype.resizeParent=false;mxHierarchicalLayout.prototype.maintainParentLocation=false;mxHierarchicalLayout.prototype.moveParent=false;mxHierarchicalLayout.prototype.parentBorder=0;mxHierarchicalLayout.prototype.intraCellSpacing=30;mxHierarchicalLayout.prototype.interRankCellSpacing=100;mxHierarchicalLayout.prototype.interHierarchySpacing=60;mxHierarchicalLayout.prototype.parallelEdgeSpacing=10;mxHierarchicalLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxHierarchicalLayout.prototype.fineTuning=true;mxHierarchicalLayout.prototype.tightenToSource=true;mxHierarchicalLayout.prototype.disableEdgeStyle=true;mxHierarchicalLayout.prototype.traverseAncestors=true;mxHierarchicalLayout.prototype.model=null;mxHierarchicalLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.edgeSourceTermCache=null;mxHierarchicalLayout.prototype.edgesTargetTermCache=null;mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxHierarchicalLayout.prototype.getModel=function(){return this.model};mxHierarchicalLayout.prototype.execute=function(e,a){this.parent=e;var b=this.graph.model;this.edgesCache=new mxDictionary();this.edgeSourceTermCache=new mxDictionary();this.edgesTargetTermCache=new mxDictionary();if(a!=null&&!(a instanceof Array)){a=[a]}if(a==null&&e==null){return}this.parentX=null;this.parentY=null;if(e!=this.root&&b.isVertex(e)!=null&&this.maintainParentLocation){var g=this.graph.getCellGeometry(e);if(g!=null){this.parentX=g.x;this.parentY=g.y}}if(a!=null){var f=[];for(var d=0;d<a.length;d++){var c=e!=null?b.isAncestor(e,a[d]):true;if(c&&b.isVertex(a[d])){f.push(a[d])}}this.roots=f}b.beginUpdate();try{this.run(e);if(this.resizeParent&&!this.graph.isCellCollapsed(e)){this.graph.updateGroupBounds([e],this.parentBorder,this.moveParent)}if(this.parentX!=null&&this.parentY!=null){var g=this.graph.getCellGeometry(e);if(g!=null){g=g.clone();g.x=this.parentX;g.y=this.parentY;b.setGeometry(e,g)}}}finally{b.endUpdate()}};mxHierarchicalLayout.prototype.findRoots=function(n,j){var p=[];if(n!=null&&j!=null){var f=this.graph.model;var d=null;var l=-100000;for(var e in j){var o=j[e];if(f.isVertex(o)&&this.graph.isCellVisible(o)){var b=this.getEdges(o);var h=0;var g=0;for(var c=0;c<b.length;c++){var a=this.getVisibleTerminal(b[c],true);if(a==o){h++}else{g++}}if(g==0&&h>0){p.push(o)}var m=h-g;if(m>l){l=m;d=o}}}if(p.length==0&&d!=null){p.push(d)}}return p};mxHierarchicalLayout.prototype.getEdges=function(k){var j=this.edgesCache.get(k);if(j!=null){return j}var g=this.graph.model;var c=[];var f=this.graph.isCellCollapsed(k);var d=g.getChildCount(k);for(var e=0;e<d;e++){var b=g.getChildAt(k,e);if(this.isPort(b)){c=c.concat(g.getEdges(b,true,true))}else{if(f||!this.graph.isCellVisible(b)){c=c.concat(g.getEdges(b,true,true))}}}c=c.concat(g.getEdges(k,true,true));var l=[];for(var e=0;e<c.length;e++){var a=this.getVisibleTerminal(c[e],true);var h=this.getVisibleTerminal(c[e],false);if((a==h)||((a!=h)&&((h==k&&(this.parent==null||this.graph.isValidAncestor(a,this.parent,this.traverseAncestors)))||(a==k&&(this.parent==null||this.graph.isValidAncestor(h,this.parent,this.traverseAncestors)))))){l.push(c[e])}}this.edgesCache.put(k,l);return l};mxHierarchicalLayout.prototype.getVisibleTerminal=function(d,f){var a=this.edgesTargetTermCache;if(f){a=this.edgeSourceTermCache}var c=a.get(d);if(c!=null){return c}var e=this.graph.view.getState(d);var b=(e!=null)?e.getVisibleTerminal(f):this.graph.view.getVisibleTerminal(d,f);if(b==null){b=(e!=null)?e.getVisibleTerminal(f):this.graph.view.getVisibleTerminal(d,f)}if(b!=null){if(this.isPort(b)){b=this.graph.model.getParent(b)}a.put(d,b)}return b};mxHierarchicalLayout.prototype.run=function(k){var f=[];var d=[];if(this.roots==null&&k!=null){var j=Object();this.filterDescendants(k,j);this.roots=[];var b=true;for(var l in j){if(j[l]!=null){b=false;break}}while(!b){var a=this.findRoots(k,j);for(var h=0;h<a.length;h++){var c=Object();f.push(c);this.traverse(a[h],true,null,d,c,f,j)}for(var h=0;h<a.length;h++){this.roots.push(a[h])}b=true;for(var l in j){if(j[l]!=null){b=false;break}}}}else{for(var h=0;h<this.roots.length;h++){var c=Object();f.push(c);this.traverse(this.roots[h],true,null,d,c,f,null)}}var e=0;for(var h=0;h<f.length;h++){var c=f[h];var g=[];for(var l in c){g.push(c[l])}this.model=new mxGraphHierarchyModel(this,g,this.roots,k,this.tightenToSource);this.cycleStage(k);this.layeringStage();this.crossingStage(k);e=this.placementStage(e,k)}};mxHierarchicalLayout.prototype.filterDescendants=function(b,a){var d=this.graph.model;if(d.isVertex(b)&&b!=this.parent&&this.graph.isCellVisible(b)){a[mxObjectIdentity.get(b)]=b}if(this.traverseAncestors||b==this.parent&&this.graph.isCellVisible(b)){var c=d.getChildCount(b);for(var e=0;e<c;e++){var f=d.getChildAt(b,e);if(!this.isPort(f)){this.filterDescendants(f,a)}}}};mxHierarchicalLayout.prototype.isPort=function(a){if(a.geometry.relative){return true}return false};mxHierarchicalLayout.prototype.getEdgesBetween=function(f,g,e){e=(e!=null)?e:false;var c=this.getEdges(f);var a=[];for(var d=0;d<c.length;d++){var h=this.getVisibleTerminal(c[d],true);var b=this.getVisibleTerminal(c[d],false);if((h==f&&b==g)||(!e&&h==g&&b==f)){a.push(c[d])}}return a};mxHierarchicalLayout.prototype.traverse=function(p,b,c,h,d,l,r){if(p!=null&&h!=null){var o=mxObjectIdentity.get(p);if((h[o]==null)&&(r==null?true:r[o]!=null)){if(d[o]==null){d[o]=p}if(h[o]==null){h[o]=p}if(r!==null){delete r[o]}var a=this.getEdges(p);var e=[];for(var n=0;n<a.length;n++){e[n]=(this.getVisibleTerminal(a[n],true)==p)}for(var n=0;n<a.length;n++){if(!b||e[n]){var f=this.getVisibleTerminal(a[n],!e[n]);var k=1;for(var m=0;m<a.length;m++){if(m==n){continue}else{var s=e[m];var g=this.getVisibleTerminal(a[m],!s);if(g==f){if(s){k++}else{k--}}}}if(k>=0){d=this.traverse(f,b,a[n],h,d,l,r)}}}}else{if(d[o]==null){for(var n=0;n<l.length;n++){var q=l[n];if(q[o]!=null){for(var t in q){d[t]=q[t]}l.splice(n,1);return d}}}}}return d};mxHierarchicalLayout.prototype.cycleStage=function(b){var a=new mxMinimumCycleRemover(this);a.execute(b)};mxHierarchicalLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxHierarchicalLayout.prototype.crossingStage=function(a){var b=new mxMedianHybridCrossingReduction(this);b.execute(a)};mxHierarchicalLayout.prototype.placementStage=function(a,c){var b=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);b.fineTuning=this.fineTuning;b.execute(c);return b.limitX+this.interHierarchySpacing};