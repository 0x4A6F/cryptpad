function mxSwimlaneLayout(c,a,b){mxGraphLayout.call(this,c);this.orientation=(a!=null)?a:mxConstants.DIRECTION_NORTH;this.deterministic=(b!=null)?b:true}mxSwimlaneLayout.prototype=new mxGraphLayout();mxSwimlaneLayout.prototype.constructor=mxSwimlaneLayout;mxSwimlaneLayout.prototype.roots=null;mxSwimlaneLayout.prototype.swimlanes=null;mxSwimlaneLayout.prototype.dummyVertices=null;mxSwimlaneLayout.prototype.dummyVertexWidth=50;mxSwimlaneLayout.prototype.resizeParent=false;mxSwimlaneLayout.prototype.maintainParentLocation=false;mxSwimlaneLayout.prototype.moveParent=false;mxSwimlaneLayout.prototype.parentBorder=30;mxSwimlaneLayout.prototype.intraCellSpacing=30;mxSwimlaneLayout.prototype.interRankCellSpacing=100;mxSwimlaneLayout.prototype.interHierarchySpacing=60;mxSwimlaneLayout.prototype.parallelEdgeSpacing=10;mxSwimlaneLayout.prototype.orientation=mxConstants.DIRECTION_NORTH;mxSwimlaneLayout.prototype.fineTuning=true;mxSwimlaneLayout.prototype.tightenToSource=true;mxSwimlaneLayout.prototype.disableEdgeStyle=true;mxSwimlaneLayout.prototype.traverseAncestors=true;mxSwimlaneLayout.prototype.model=null;mxSwimlaneLayout.prototype.edgesCache=null;mxHierarchicalLayout.prototype.edgeSourceTermCache=null;mxHierarchicalLayout.prototype.edgesTargetTermCache=null;mxHierarchicalLayout.prototype.edgeStyle=mxHierarchicalEdgeStyle.POLYLINE;mxSwimlaneLayout.prototype.getModel=function(){return this.model};mxSwimlaneLayout.prototype.execute=function(e,b){this.parent=e;var a=this.graph.model;this.edgesCache=new mxDictionary();this.edgeSourceTermCache=new mxDictionary();this.edgesTargetTermCache=new mxDictionary();if(b==null||b.length<1){return}if(e==null){e=a.getParent(b[0])}this.parentX=null;this.parentY=null;if(e!=this.root&&a.isVertex(e)!=null&&this.maintainParentLocation){var g=this.graph.getCellGeometry(e);if(g!=null){this.parentX=g.x;this.parentY=g.y}}this.swimlanes=b;this.dummyVertices=[];for(var d=0;d<b.length;d++){var c=this.graph.getChildCells(b[d]);if(c==null||c.length==0){var f=this.graph.insertVertex(b[d],null,null,0,0,this.dummyVertexWidth,0);this.dummyVertices.push(f)}}a.beginUpdate();try{this.run(e);if(this.resizeParent&&!this.graph.isCellCollapsed(e)){this.graph.updateGroupBounds([e],this.parentBorder,this.moveParent)}if(this.parentX!=null&&this.parentY!=null){var g=this.graph.getCellGeometry(e);if(g!=null){g=g.clone();g.x=this.parentX;g.y=this.parentY;a.setGeometry(e,g)}}this.graph.removeCells(this.dummyVertices)}finally{a.endUpdate()}};mxSwimlaneLayout.prototype.updateGroupBounds=function(){var p=[];var l=this.model;for(var o in l.edgeMapper){var d=l.edgeMapper[o];for(var k=0;k<d.edges.length;k++){p.push(d.edges[k])}}var r=this.graph.getBoundingBoxFromGeometry(p,true);var g=[];for(var k=0;k<this.swimlanes.length;k++){var f=this.swimlanes[k];var j=this.graph.getCellGeometry(f);if(j!=null){var c=this.graph.getChildCells(f);var q=(this.graph.isSwimlane(f))?this.graph.getStartSize(f):new mxRectangle();var b=this.graph.getBoundingBoxFromGeometry(c);g[k]=b;var m=b.y+j.y-q.height-this.parentBorder;var e=b.y+j.y+b.height;if(r==null){r=new mxRectangle(0,m,0,e-m)}else{r.y=Math.min(r.y,m);var a=Math.max(r.y+r.height,e);r.height=a-r.y}}}for(var k=0;k<this.swimlanes.length;k++){var f=this.swimlanes[k];var j=this.graph.getCellGeometry(f);if(j!=null){var c=this.graph.getChildCells(f);var q=(this.graph.isSwimlane(f))?this.graph.getStartSize(f):new mxRectangle();var h=j.clone();var n=(k==0)?this.parentBorder:this.interRankCellSpacing/2;h.x+=g[k].x-q.width-n;h.y=h.y+r.y-j.y-this.parentBorder;h.width=g[k].width+q.width+this.interRankCellSpacing/2+n;h.height=r.height+q.height+2*this.parentBorder;this.graph.model.setGeometry(f,h);this.graph.moveCells(c,-g[k].x+q.width+n,j.y-r.y+this.parentBorder)}}};mxSwimlaneLayout.prototype.findRoots=function(o,l){var q=[];if(o!=null&&l!=null){var f=this.graph.model;var d=null;var m=-100000;for(var e in l){var p=l[e];if(p!=null&&f.isVertex(p)&&this.graph.isCellVisible(p)&&f.isAncestor(o,p)){var b=this.getEdges(p);var j=0;var g=0;for(var c=0;c<b.length;c++){var a=this.getVisibleTerminal(b[c],true);if(a==p){var h=this.getVisibleTerminal(b[c],false);if(f.isAncestor(o,h)){j++}}else{if(f.isAncestor(o,a)){g++}}}if(g==0&&j>0){q.push(p)}var n=j-g;if(n>m){m=n;d=p}}}if(q.length==0&&d!=null){q.push(d)}}return q};mxSwimlaneLayout.prototype.getEdges=function(k){var j=this.edgesCache.get(k);if(j!=null){return j}var g=this.graph.model;var c=[];var f=this.graph.isCellCollapsed(k);var d=g.getChildCount(k);for(var e=0;e<d;e++){var b=g.getChildAt(k,e);if(this.isPort(b)){c=c.concat(g.getEdges(b,true,true))}else{if(f||!this.graph.isCellVisible(b)){c=c.concat(g.getEdges(b,true,true))}}}c=c.concat(g.getEdges(k,true,true));var l=[];for(var e=0;e<c.length;e++){var a=this.getVisibleTerminal(c[e],true);var h=this.getVisibleTerminal(c[e],false);if((a==h)||((a!=h)&&((h==k&&(this.parent==null||this.graph.isValidAncestor(a,this.parent,this.traverseAncestors)))||(a==k&&(this.parent==null||this.graph.isValidAncestor(h,this.parent,this.traverseAncestors)))))){l.push(c[e])}}this.edgesCache.put(k,l);return l};mxSwimlaneLayout.prototype.getVisibleTerminal=function(d,f){var a=this.edgesTargetTermCache;if(f){a=this.edgeSourceTermCache}var c=a.get(d);if(c!=null){return c}var e=this.graph.view.getState(d);var b=(e!=null)?e.getVisibleTerminal(f):this.graph.view.getVisibleTerminal(d,f);if(b==null){b=(e!=null)?e.getVisibleTerminal(f):this.graph.view.getVisibleTerminal(d,f)}if(b!=null){if(this.isPort(b)){b=this.graph.model.getParent(b)}a.put(d,b)}return b};mxSwimlaneLayout.prototype.run=function(k){var e=[];var d=[];if(this.swimlanes!=null&&this.swimlanes.length>0&&k!=null){var h=Object();for(var g=0;g<this.swimlanes.length;g++){this.filterDescendants(this.swimlanes[g],h)}this.roots=[];var b=true;for(var l in h){if(h[l]!=null){b=false;break}}var j=0;while(!b&&j<this.swimlanes.length){var a=this.findRoots(this.swimlanes[j],h);if(a.length==0){j++;continue}for(var g=0;g<a.length;g++){var c=Object();e.push(c);this.traverse(a[g],true,null,d,c,e,h,j)}for(var g=0;g<a.length;g++){this.roots.push(a[g])}b=true;for(var l in h){if(h[l]!=null){b=false;break}}}}else{for(var g=0;g<this.roots.length;g++){var c=Object();e.push(c);this.traverse(this.roots[g],true,null,d,c,e,null)}}var f=[];for(var l in d){f.push(d[l])}this.model=new mxSwimlaneModel(this,f,this.roots,k,this.tightenToSource);this.cycleStage(k);this.layeringStage();this.crossingStage(k);initialX=this.placementStage(0,k)};mxSwimlaneLayout.prototype.filterDescendants=function(b,a){var d=this.graph.model;if(d.isVertex(b)&&b!=this.parent&&d.getParent(b)!=this.parent&&this.graph.isCellVisible(b)){a[mxObjectIdentity.get(b)]=b}if(this.traverseAncestors||b==this.parent&&this.graph.isCellVisible(b)){var c=d.getChildCount(b);for(var e=0;e<c;e++){var f=d.getChildAt(b,e);if(!this.isPort(f)){this.filterDescendants(f,a)}}}};mxSwimlaneLayout.prototype.isPort=function(a){if(a.geometry.relative){return true}return false};mxSwimlaneLayout.prototype.getEdgesBetween=function(f,g,e){e=(e!=null)?e:false;var c=this.getEdges(f);var a=[];for(var d=0;d<c.length;d++){var h=this.getVisibleTerminal(c[d],true);var b=this.getVisibleTerminal(c[d],false);if((h==f&&b==g)||(!e&&h==g&&b==f)){a.push(c[d])}}return a};mxSwimlaneLayout.prototype.traverse=function(m,e,d,a,h,g,n,q){if(m!=null&&a!=null){var r=mxObjectIdentity.get(m);if((a[r]==null)&&(n==null?true:n[r]!=null)){if(h[r]==null){h[r]=m}if(a[r]==null){a[r]=m}if(n!==null){delete n[r]}var f=this.getEdges(m);var k=this.graph.model;for(var j=0;j<f.length;j++){var b=this.getVisibleTerminal(f[j],true);var o=b==m;if(o){b=this.getVisibleTerminal(f[j],false)}var c=0;for(c=0;c<this.swimlanes.length;c++){if(k.isAncestor(this.swimlanes[c],b)){break}}if(c>=this.swimlanes.length){continue}if((c>q)||((!e||o)&&c==q)){h=this.traverse(b,e,f[j],a,h,g,n,c)}}}else{if(h[r]==null){for(var j=0;j<g.length;j++){var l=g[j];if(l[r]!=null){for(var p in l){h[p]=l[p]}g.splice(j,1);return h}}}}}return h};mxSwimlaneLayout.prototype.cycleStage=function(b){var a=new mxSwimlaneOrdering(this);a.execute(b)};mxSwimlaneLayout.prototype.layeringStage=function(){this.model.initialRank();this.model.fixRanks()};mxSwimlaneLayout.prototype.crossingStage=function(a){var b=new mxMedianHybridCrossingReduction(this);b.execute(a)};mxSwimlaneLayout.prototype.placementStage=function(a,c){var b=new mxCoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,a,this.parallelEdgeSpacing);b.fineTuning=this.fineTuning;b.execute(c);return b.limitX+this.interHierarchySpacing};