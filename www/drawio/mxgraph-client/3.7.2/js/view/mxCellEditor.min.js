function mxCellEditor(a){this.graph=a;this.zoomHandler=mxUtils.bind(this,function(){if(this.graph.isEditing()){this.resize()}});this.graph.view.addListener(mxEvent.SCALE,this.zoomHandler);this.graph.view.addListener(mxEvent.SCALE_AND_TRANSLATE,this.zoomHandler);this.changeHandler=mxUtils.bind(this,function(b){if(this.editingCell!=null&&this.graph.getView().getState(this.editingCell)==null){this.stopEditing(true)}});this.graph.getModel().addListener(mxEvent.CHANGE,this.changeHandler)}mxCellEditor.prototype.graph=null;mxCellEditor.prototype.textarea=null;mxCellEditor.prototype.editingCell=null;mxCellEditor.prototype.trigger=null;mxCellEditor.prototype.modified=false;mxCellEditor.prototype.autoSize=true;mxCellEditor.prototype.selectText=true;mxCellEditor.prototype.emptyLabelText=(mxClient.IS_FF)?"<br>":"";mxCellEditor.prototype.escapeCancelsEditing=true;mxCellEditor.prototype.textNode="";mxCellEditor.prototype.zIndex=5;mxCellEditor.prototype.minResize=new mxRectangle(0,20);mxCellEditor.prototype.wordWrapPadding=(mxClient.IS_QUIRKS)?2:(!mxClient.IS_IE11)?1:0;mxCellEditor.prototype.blurEnabled=false;mxCellEditor.prototype.initialValue=null;mxCellEditor.prototype.init=function(){this.textarea=document.createElement("div");this.textarea.className="mxCellEditor mxPlainTextEditor";this.textarea.contentEditable=true;if(mxClient.IS_GC){this.textarea.style.minHeight="1em"}this.installListeners(this.textarea)};mxCellEditor.prototype.applyValue=function(b,a){this.graph.labelChanged(b.cell,a,this.trigger)};mxCellEditor.prototype.getInitialValue=function(c,b){var a=mxUtils.htmlEntities(this.graph.getEditingValue(c.cell,b),false);if(!mxClient.IS_QUIRKS&&document.documentMode!=8&&document.documentMode!=9&&document.documentMode!=10){a=mxUtils.replaceTrailingNewlines(a,"<div><br></div>")}return a.replace(/\n/g,"<br>")};mxCellEditor.prototype.getCurrentValue=function(a){return mxUtils.extractTextWithWhitespace(this.textarea.childNodes)};mxCellEditor.prototype.installListeners=function(a){mxEvent.addListener(a,"blur",mxUtils.bind(this,function(f){if(this.blurEnabled){this.focusLost(f)}}));mxEvent.addListener(a,"keydown",mxUtils.bind(this,function(f){if(!mxEvent.isConsumed(f)){if(this.isStopEditingEvent(f)){this.graph.stopEditing(false);mxEvent.consume(f)}else{if(f.keyCode==27){this.graph.stopEditing(this.escapeCancelsEditing||mxEvent.isShiftDown(f));mxEvent.consume(f)}}}}));var e=mxUtils.bind(this,function(f){if(this.editingCell!=null){if(this.clearOnChange&&a.innerHTML==this.getEmptyLabelText()&&(!mxClient.IS_FF||(f.keyCode!=8&&f.keyCode!=46))){this.clearOnChange=false;a.innerHTML=""}}});mxEvent.addListener(a,"keypress",e);mxEvent.addListener(a,"paste",e);var d=mxUtils.bind(this,function(f){if(this.editingCell!=null){if(this.textarea.innerHTML.length==0||this.textarea.innerHTML=="<br>"){this.textarea.innerHTML=this.getEmptyLabelText();this.clearOnChange=this.textarea.innerHTML.length>0}else{this.clearOnChange=false}}});mxEvent.addListener(a,(!mxClient.IS_IE11&&!mxClient.IS_IE)?"input":"keyup",d);mxEvent.addListener(a,"cut",d);mxEvent.addListener(a,"paste",d);var c=(!mxClient.IS_IE11&&!mxClient.IS_IE)?"input":"keydown";var b=mxUtils.bind(this,function(f){if(this.editingCell!=null&&this.autoSize&&!mxEvent.isConsumed(f)){if(this.resizeThread!=null){window.clearTimeout(this.resizeThread)}this.resizeThread=window.setTimeout(mxUtils.bind(this,function(){this.resizeThread=null;this.resize()}),0)}});mxEvent.addListener(a,c,b);if(document.documentMode>=9){mxEvent.addListener(a,"DOMNodeRemoved",b);mxEvent.addListener(a,"DOMNodeInserted",b)}else{mxEvent.addListener(a,"cut",b);mxEvent.addListener(a,"paste",b)}};mxCellEditor.prototype.isStopEditingEvent=function(a){return a.keyCode==113||(this.graph.isEnterStopsCellEditing()&&a.keyCode==13&&!mxEvent.isControlDown(a)&&!mxEvent.isShiftDown(a))};mxCellEditor.prototype.isEventSource=function(a){return mxEvent.getSource(a)==this.textarea};mxCellEditor.prototype.resize=function(){var a=this.graph.getView().getState(this.editingCell);if(a==null){this.stopEditing(true)}else{if(this.textarea!=null){var o=this.graph.getModel().isEdge(a.cell);var f=this.graph.getView().scale;var e=null;if(!this.autoSize||(a.style[mxConstants.STYLE_OVERFLOW]=="fill")){this.bounds=this.getEditorBounds(a);this.textarea.style.width=Math.round(this.bounds.width/f)+"px";this.textarea.style.height=Math.round(this.bounds.height/f)+"px";if(document.documentMode==8||mxClient.IS_QUIRKS){this.textarea.style.left=Math.round(this.bounds.x)+"px";this.textarea.style.top=Math.round(this.bounds.y)+"px"}else{this.textarea.style.left=Math.max(0,Math.round(this.bounds.x+1))+"px";this.textarea.style.top=Math.max(0,Math.round(this.bounds.y+1))+"px"}if(this.graph.isWrapping(a.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!=this.getEmptyLabelText()){this.textarea.style.wordWrap=mxConstants.WORD_WRAP;this.textarea.style.whiteSpace="normal";if(a.style[mxConstants.STYLE_OVERFLOW]!="fill"){this.textarea.style.width=Math.round(this.bounds.width/f)+this.wordWrapPadding+"px"}}else{this.textarea.style.whiteSpace="nowrap";if(a.style[mxConstants.STYLE_OVERFLOW]!="fill"){this.textarea.style.width=""}}}else{var d=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_WIDTH,null);e=(a.text!=null)?a.text.margin:null;if(e==null){e=mxUtils.getAlignmentAsPoint(mxUtils.getValue(a.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER),mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_ALIGN,mxConstants.ALIGN_MIDDLE))}if(o){this.bounds=new mxRectangle(a.absoluteOffset.x,a.absoluteOffset.y,0,0);if(d!=null){var h=(parseFloat(d)+2)*f;this.bounds.width=h;this.bounds.x+=e.x*h}}else{var i=mxRectangle.fromRectangle(a);var l=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);var q=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);i=(a.shape!=null&&l==mxConstants.ALIGN_CENTER&&q==mxConstants.ALIGN_MIDDLE)?a.shape.getLabelBounds(i):i;if(d!=null){i.width=parseFloat(d)*f}if(!a.view.graph.cellRenderer.legacySpacing||a.style[mxConstants.STYLE_OVERFLOW]!="width"){var n=parseInt(a.style[mxConstants.STYLE_SPACING]||2)*f;var k=(parseInt(a.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*f+n;var g=(parseInt(a.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*f+n;var b=(parseInt(a.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*f+n;var j=(parseInt(a.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*f+n;var l=mxUtils.getValue(a.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);var q=mxUtils.getValue(a.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);i=new mxRectangle(i.x+j,i.y+k,i.width-((l==mxConstants.ALIGN_CENTER&&d==null)?(j+g):0),i.height-((q==mxConstants.ALIGN_MIDDLE)?(k+b):0))}this.bounds=new mxRectangle(i.x+a.absoluteOffset.x,i.y+a.absoluteOffset.y,i.width,i.height)}if(this.graph.isWrapping(a.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!=this.getEmptyLabelText()){this.textarea.style.wordWrap=mxConstants.WORD_WRAP;this.textarea.style.whiteSpace="normal";var h=Math.round(this.bounds.width/((document.documentMode==8)?f:f))+this.wordWrapPadding;this.textarea.style.width=h+"px";if(this.textarea.scrollWidth>h){this.textarea.style.width=this.textarea.scrollWidth+"px"}}else{this.textarea.style.whiteSpace="nowrap";this.textarea.style.width=""}if(document.documentMode==8){this.textarea.style.zoom="1";this.textarea.style.height="auto"}var c=this.textarea.scrollWidth;var p=this.textarea.scrollHeight;if(document.documentMode==8){this.textarea.style.left=Math.max(0,Math.ceil((this.bounds.x-e.x*(this.bounds.width-(c+1)*f)+c*(f-1)*0+(e.x+0.5)*2)/f))+"px";this.textarea.style.top=Math.max(0,Math.ceil((this.bounds.y-e.y*(this.bounds.height-(p+0.5)*f)+p*(f-1)*0+Math.abs(e.y+0.5)*1)/f))+"px";this.textarea.style.width=Math.round(c*f)+"px";this.textarea.style.height=Math.round(p*f)+"px"}else{if(mxClient.IS_QUIRKS){this.textarea.style.left=Math.max(0,Math.ceil(this.bounds.x-e.x*(this.bounds.width-(c+1)*f)+c*(f-1)*0+(e.x+0.5)*2))+"px";this.textarea.style.top=Math.max(0,Math.ceil(this.bounds.y-e.y*(this.bounds.height-(p+0.5)*f)+p*(f-1)*0+Math.abs(e.y+0.5)*1))+"px"}else{this.textarea.style.left=Math.max(0,Math.round(this.bounds.x-e.x*(this.bounds.width-2))+1)+"px";this.textarea.style.top=Math.max(0,Math.round(this.bounds.y-e.y*(this.bounds.height-4)+((e.y==-1)?3:0))+1)+"px"}}}if(mxClient.IS_VML){this.textarea.style.zoom=f}else{mxUtils.setPrefixedStyle(this.textarea.style,"transformOrigin","0px 0px");mxUtils.setPrefixedStyle(this.textarea.style,"transform","scale("+f+","+f+")"+((e==null)?"":" translate("+(e.x*100)+"%,"+(e.y*100)+"%)"))}}}};mxCellEditor.prototype.focusLost=function(){this.stopEditing(!this.graph.isInvokesStopCellEditing())};mxCellEditor.prototype.getBackgroundColor=function(a){return null};mxCellEditor.prototype.startEditing=function(m,b){this.stopEditing(true);if(this.textarea==null){this.init()}if(this.graph.tooltipHandler!=null){this.graph.tooltipHandler.hideTooltip()}var a=this.graph.getView().getState(m);if(a!=null){var d=this.graph.getView().scale;var n=mxUtils.getValue(a.style,mxConstants.STYLE_FONTSIZE,mxConstants.DEFAULT_FONTSIZE);var g=mxUtils.getValue(a.style,mxConstants.STYLE_FONTFAMILY,mxConstants.DEFAULT_FONTFAMILY);var f=mxUtils.getValue(a.style,mxConstants.STYLE_FONTCOLOR,"black");var j=mxUtils.getValue(a.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_LEFT);var k=(mxUtils.getValue(a.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD;var h=(mxUtils.getValue(a.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC;var l=(mxUtils.getValue(a.style,mxConstants.STYLE_FONTSTYLE,0)&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE;this.textarea.style.lineHeight=(mxConstants.ABSOLUTE_LINE_HEIGHT)?Math.round(n*mxConstants.LINE_HEIGHT)+"px":mxConstants.LINE_HEIGHT;this.textarea.style.backgroundColor=this.getBackgroundColor(a);this.textarea.style.textDecoration=(l)?"underline":"";this.textarea.style.fontWeight=(k)?"bold":"normal";this.textarea.style.fontStyle=(h)?"italic":"";this.textarea.style.fontSize=Math.round(n)+"px";this.textarea.style.zIndex=this.zIndex;this.textarea.style.fontFamily=g;this.textarea.style.textAlign=j;this.textarea.style.outline="none";this.textarea.style.color=f;var c=this.textDirection=mxUtils.getValue(a.style,mxConstants.STYLE_TEXT_DIRECTION,mxConstants.DEFAULT_TEXT_DIRECTION);if(c==mxConstants.TEXT_DIRECTION_AUTO){if(a!=null&&a.text!=null&&a.text.dialect!=mxConstants.DIALECT_STRICTHTML&&!mxUtils.isNode(a.text.value)){c=a.text.getAutoDirection()}}if(c==mxConstants.TEXT_DIRECTION_LTR||c==mxConstants.TEXT_DIRECTION_RTL){this.textarea.setAttribute("dir",c)}else{this.textarea.removeAttribute("dir")}this.textarea.innerHTML=this.getInitialValue(a,b)||"";this.initialValue=this.textarea.innerHTML;if(this.textarea.innerHTML.length==0||this.textarea.innerHTML=="<br>"){this.textarea.innerHTML=this.getEmptyLabelText();this.clearOnChange=true}else{this.clearOnChange=this.textarea.innerHTML==this.getEmptyLabelText()}this.graph.container.appendChild(this.textarea);this.editingCell=m;this.trigger=b;this.textNode=null;if(a.text!=null&&this.isHideLabel(a)){this.textNode=a.text.node;this.textNode.style.visibility="hidden"}if(this.autoSize&&(this.graph.model.isEdge(a.cell)||a.style[mxConstants.STYLE_OVERFLOW]!="fill")){window.setTimeout(mxUtils.bind(this,function(){this.resize()}),0)}this.resize();try{this.textarea.focus();if(this.isSelectText()&&this.textarea.innerHTML.length>0&&(this.textarea.innerHTML!=this.getEmptyLabelText()||!this.clearOnChange)){document.execCommand("selectAll",false,null)}}catch(i){}}};mxCellEditor.prototype.isSelectText=function(){return this.selectText};mxCellEditor.prototype.stopEditing=function(b){b=b||false;if(this.editingCell!=null){if(this.textNode!=null){this.textNode.style.visibility="visible";this.textNode=null}var d=(!b)?this.graph.view.getState(this.editingCell):null;var a=this.initialValue;this.initialValue=null;this.editingCell=null;this.trigger=null;this.bounds=null;this.textarea.blur();if(this.textarea.parentNode!=null){this.textarea.parentNode.removeChild(this.textarea)}if(this.clearOnChange&&this.textarea.innerHTML==this.getEmptyLabelText()){this.textarea.innerHTML="";this.clearOnChange=false}if(d!=null&&this.textarea.innerHTML!=a){this.prepareTextarea();var c=this.getCurrentValue(d);if(c!=null){this.applyValue(d,c)}}mxEvent.release(this.textarea);this.textarea=null}};mxCellEditor.prototype.prepareTextarea=function(){if(mxClient.IS_FF&&this.textarea.lastChild!=null&&this.textarea.lastChild.nodeName=="BR"){this.textarea.removeChild(this.textarea.lastChild)}};mxCellEditor.prototype.isHideLabel=function(a){return true};mxCellEditor.prototype.getMinimumSize=function(a){var b=this.graph.getView().scale;return new mxRectangle(0,0,(a.text==null)?30:a.text.size*b+20,(this.textarea.style.textAlign=="left")?120:40)};mxCellEditor.prototype.getEditorBounds=function(b){var m=this.graph.getModel().isEdge(b.cell);var g=this.graph.getView().scale;var e=this.getMinimumSize(b);var c=e.width;var n=e.height;var p=null;if(!m&&b.view.graph.cellRenderer.legacySpacing&&b.style[mxConstants.STYLE_OVERFLOW]=="fill"){p=b.shape.getLabelBounds(mxRectangle.fromRectangle(b))}else{var l=parseInt(b.style[mxConstants.STYLE_SPACING]||0)*g;var k=(parseInt(b.style[mxConstants.STYLE_SPACING_TOP]||0)+mxText.prototype.baseSpacingTop)*g+l;var h=(parseInt(b.style[mxConstants.STYLE_SPACING_RIGHT]||0)+mxText.prototype.baseSpacingRight)*g+l;var d=(parseInt(b.style[mxConstants.STYLE_SPACING_BOTTOM]||0)+mxText.prototype.baseSpacingBottom)*g+l;var i=(parseInt(b.style[mxConstants.STYLE_SPACING_LEFT]||0)+mxText.prototype.baseSpacingLeft)*g+l;p=new mxRectangle(b.x,b.y,Math.max(c,b.width-i-h),Math.max(n,b.height-k-d));var j=mxUtils.getValue(b.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);var o=mxUtils.getValue(b.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);p=(b.shape!=null&&j==mxConstants.ALIGN_CENTER&&o==mxConstants.ALIGN_MIDDLE)?b.shape.getLabelBounds(p):p;if(m){p.x=b.absoluteOffset.x;p.y=b.absoluteOffset.y;if(b.text!=null&&b.text.boundingBox!=null){if(b.text.boundingBox.x>0){p.x=b.text.boundingBox.x}if(b.text.boundingBox.y>0){p.y=b.text.boundingBox.y}}}else{if(b.text!=null&&b.text.boundingBox!=null){p.x=Math.min(p.x,b.text.boundingBox.x);p.y=Math.min(p.y,b.text.boundingBox.y)}}p.x+=i;p.y+=k;if(b.text!=null&&b.text.boundingBox!=null){if(!m){p.width=Math.max(p.width,b.text.boundingBox.width);p.height=Math.max(p.height,b.text.boundingBox.height)}else{p.width=Math.max(c,b.text.boundingBox.width);p.height=Math.max(n,b.text.boundingBox.height)}}if(this.graph.getModel().isVertex(b.cell)){var a=mxUtils.getValue(b.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);if(a==mxConstants.ALIGN_LEFT){p.x-=b.width}else{if(a==mxConstants.ALIGN_RIGHT){p.x+=b.width}}var f=mxUtils.getValue(b.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(f==mxConstants.ALIGN_TOP){p.y-=b.height}else{if(f==mxConstants.ALIGN_BOTTOM){p.y+=b.height}}}}return new mxRectangle(Math.round(p.x),Math.round(p.y),Math.round(p.width),Math.round(p.height))};mxCellEditor.prototype.getEmptyLabelText=function(a){return this.emptyLabelText};mxCellEditor.prototype.getEditingCell=function(){return this.editingCell};mxCellEditor.prototype.destroy=function(){if(this.textarea!=null){mxEvent.release(this.textarea);if(this.textarea.parentNode!=null){this.textarea.parentNode.removeChild(this.textarea)}this.textarea=null}if(this.changeHandler!=null){this.graph.getModel().removeListener(this.changeHandler);this.changeHandler=null}if(this.zoomHandler){this.graph.view.removeListener(this.zoomHandler);this.zoomHandler=null}};