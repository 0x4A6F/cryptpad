function mxOutline(b,a){this.source=b;if(a!=null){this.init(a)}}mxOutline.prototype.source=null;mxOutline.prototype.outline=null;mxOutline.prototype.graphRenderHint=mxConstants.RENDERING_HINT_FASTER;mxOutline.prototype.enabled=true;mxOutline.prototype.showViewport=true;mxOutline.prototype.border=10;mxOutline.prototype.sizerSize=8;mxOutline.prototype.labelsVisible=false;mxOutline.prototype.updateOnPan=false;mxOutline.prototype.sizerImage=null;mxOutline.prototype.minScale=0.0001;mxOutline.prototype.suspended=false;mxOutline.prototype.forceVmlHandles=document.documentMode==8;mxOutline.prototype.createGraph=function(a){var b=new mxGraph(a,this.source.getModel(),this.graphRenderHint,this.source.getStylesheet());b.foldingEnabled=false;b.autoScroll=false;return b};mxOutline.prototype.init=function(b){this.outline=this.createGraph(b);var e=this.outline.graphModelChanged;this.outline.graphModelChanged=mxUtils.bind(this,function(f){if(!this.suspended&&this.outline!=null){e.apply(this.outline,arguments)}});if(mxClient.IS_SVG){var d=this.outline.getView().getCanvas().parentNode;d.setAttribute("shape-rendering","optimizeSpeed");d.setAttribute("image-rendering","optimizeSpeed")}this.outline.labelsVisible=this.labelsVisible;this.outline.setEnabled(false);this.updateHandler=mxUtils.bind(this,function(g,f){if(!this.suspended&&!this.active){this.update()}});this.source.getModel().addListener(mxEvent.CHANGE,this.updateHandler);this.outline.addMouseListener(this);var a=this.source.getView();a.addListener(mxEvent.SCALE,this.updateHandler);a.addListener(mxEvent.TRANSLATE,this.updateHandler);a.addListener(mxEvent.SCALE_AND_TRANSLATE,this.updateHandler);a.addListener(mxEvent.DOWN,this.updateHandler);a.addListener(mxEvent.UP,this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);this.panHandler=mxUtils.bind(this,function(f){if(this.updateOnPan){this.updateHandler.apply(this,arguments)}});this.source.addListener(mxEvent.PAN,this.panHandler);this.refreshHandler=mxUtils.bind(this,function(f){this.outline.setStylesheet(this.source.getStylesheet());this.outline.refresh()});this.source.addListener(mxEvent.REFRESH,this.refreshHandler);this.bounds=new mxRectangle(0,0,0,0);this.selectionBorder=new mxRectangleShape(this.bounds,null,mxConstants.OUTLINE_COLOR,mxConstants.OUTLINE_STROKEWIDTH);this.selectionBorder.dialect=this.outline.dialect;if(this.forceVmlHandles){this.selectionBorder.isHtmlAllowed=function(){return false}}this.selectionBorder.init(this.outline.getView().getOverlayPane());var c=mxUtils.bind(this,function(f){var g=mxEvent.getSource(f);var i=mxUtils.bind(this,function(j){this.outline.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(j))});var h=mxUtils.bind(this,function(j){mxEvent.removeGestureListeners(g,null,i,h);this.outline.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(j))});mxEvent.addGestureListeners(g,null,i,h);this.outline.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(f))});mxEvent.addGestureListeners(this.selectionBorder.node,c);this.sizer=this.createSizer();if(this.forceVmlHandles){this.sizer.isHtmlAllowed=function(){return false}}this.sizer.init(this.outline.getView().getOverlayPane());if(this.enabled){this.sizer.node.style.cursor="nwse-resize"}mxEvent.addGestureListeners(this.sizer.node,c);this.selectionBorder.node.style.display=(this.showViewport)?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;this.selectionBorder.node.style.cursor="move";this.update(false)};mxOutline.prototype.isEnabled=function(){return this.enabled};mxOutline.prototype.setEnabled=function(a){this.enabled=a};mxOutline.prototype.setZoomEnabled=function(a){this.sizer.node.style.visibility=(a)?"visible":"hidden"};mxOutline.prototype.refresh=function(){this.update(true)};mxOutline.prototype.createSizer=function(){if(this.sizerImage!=null){var a=new mxImageShape(new mxRectangle(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src);a.dialect=this.outline.dialect;return a}else{var a=new mxRectangleShape(new mxRectangle(0,0,this.sizerSize,this.sizerSize),mxConstants.OUTLINE_HANDLE_FILLCOLOR,mxConstants.OUTLINE_HANDLE_STROKECOLOR);a.dialect=this.outline.dialect;return a}};mxOutline.prototype.getSourceContainerSize=function(){return new mxRectangle(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)};mxOutline.prototype.getOutlineOffset=function(a){return null};mxOutline.prototype.getSourceGraphBounds=function(){return this.source.getGraphBounds()};mxOutline.prototype.update=function(g){if(this.source!=null&&this.outline!=null){var u=this.source.view.scale;var j=this.getSourceGraphBounds();var i=new mxRectangle(j.x/u+this.source.panDx,j.y/u+this.source.panDy,j.width/u,j.height/u);var n=new mxRectangle(0,0,this.source.container.clientWidth/u,this.source.container.clientHeight/u);var c=i.clone();c.add(n);var o=this.getSourceContainerSize();var k=Math.max(o.width/u,c.width);var r=Math.max(o.height/u,c.height);var a=Math.max(0,this.outline.container.clientWidth-this.border);var d=Math.max(0,this.outline.container.clientHeight-this.border);var e=Math.min(a/k,d/r);var z=(isNaN(e))?this.minScale:Math.max(this.minScale,e);if(z>0){if(this.outline.getView().scale!=z){this.outline.getView().scale=z;g=true}var s=this.outline.getView();if(s.currentRoot!=this.source.getView().currentRoot){s.setCurrentRoot(this.source.getView().currentRoot)}var m=this.source.view.translate;var x=m.x+this.source.panDx;var w=m.y+this.source.panDy;var y=this.getOutlineOffset(z);if(y!=null){x+=y.x;w+=y.y}if(i.x<0){x=x-i.x}if(i.y<0){w=w-i.y}if(s.translate.x!=x||s.translate.y!=w){s.translate.x=x;s.translate.y=w;g=true}var h=s.translate;z=this.source.getView().scale;var q=z/s.scale;var p=1/s.scale;var l=this.source.container;this.bounds=new mxRectangle((h.x-m.x-this.source.panDx)/p,(h.y-m.y-this.source.panDy)/p,(l.clientWidth/q),(l.clientHeight/q));this.bounds.x+=this.source.container.scrollLeft*s.scale/z;this.bounds.y+=this.source.container.scrollTop*s.scale/z;var v=this.selectionBorder.bounds;if(v.x!=this.bounds.x||v.y!=this.bounds.y||v.width!=this.bounds.width||v.height!=this.bounds.height){this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw()}var v=this.sizer.bounds;var f=new mxRectangle(this.bounds.x+this.bounds.width-v.width/2,this.bounds.y+this.bounds.height-v.height/2,v.width,v.height);if(v.x!=f.x||v.y!=f.y||v.width!=f.width||v.height!=f.height){this.sizer.bounds=f;if(this.sizer.node.style.visibility!="hidden"){this.sizer.redraw()}}if(g){this.outline.view.revalidate()}}}};mxOutline.prototype.mouseDown=function(b,c){if(this.enabled&&this.showViewport){var a=(!mxEvent.isMouseEvent(c.getEvent()))?this.source.tolerance:0;var d=(this.source.allowHandleBoundsCheck&&(mxClient.IS_IE||a>0))?new mxRectangle(c.getGraphX()-a,c.getGraphY()-a,2*a,2*a):null;this.zoom=c.isSource(this.sizer)||(d!=null&&mxUtils.intersects(shape.bounds,d));this.startX=c.getX();this.startY=c.getY();this.active=true;if(this.source.useScrollbarsForPanning&&mxUtils.hasScrollbars(this.source.container)){this.dx0=this.source.container.scrollLeft;this.dy0=this.source.container.scrollTop}else{this.dx0=0;this.dy0=0}}c.consume()};mxOutline.prototype.mouseMove=function(e,f){if(this.active){this.selectionBorder.node.style.display=(this.showViewport)?"":"none";this.sizer.node.style.display=this.selectionBorder.node.style.display;var h=this.getTranslateForEvent(f);var k=h.x;var i=h.y;var a=null;if(!this.zoom){var d=this.outline.getView().scale;a=new mxRectangle(this.bounds.x+k,this.bounds.y+i,this.bounds.width,this.bounds.height);this.selectionBorder.bounds=a;this.selectionBorder.redraw();k/=d;k*=this.source.getView().scale;i/=d;i*=this.source.getView().scale;this.source.panGraph(-k-this.dx0,-i-this.dy0)}else{var c=this.source.container;var j=c.clientWidth/c.clientHeight;i=k/j;a=new mxRectangle(this.bounds.x,this.bounds.y,Math.max(1,this.bounds.width+k),Math.max(1,this.bounds.height+i));this.selectionBorder.bounds=a;this.selectionBorder.redraw()}var g=this.sizer.bounds;this.sizer.bounds=new mxRectangle(a.x+a.width-g.width/2,a.y+a.height-g.height/2,g.width,g.height);if(this.sizer.node.style.visibility!="hidden"){this.sizer.redraw()}f.consume()}};mxOutline.prototype.getTranslateForEvent=function(a){return new mxPoint(a.getX()-this.startX,a.getY()-this.startY)};mxOutline.prototype.mouseUp=function(e,f){if(this.active){var h=this.getTranslateForEvent(f);var c=h.x;var b=h.y;if(Math.abs(c)>0||Math.abs(b)>0){if(!this.zoom){if(!this.source.useScrollbarsForPanning||!mxUtils.hasScrollbars(this.source.container)){this.source.panGraph(0,0);c/=this.outline.getView().scale;b/=this.outline.getView().scale;var d=this.source.getView().translate;this.source.getView().setTranslate(d.x-c,d.y-b)}}else{var a=this.selectionBorder.bounds.width;var g=this.source.getView().scale;this.source.zoomTo(Math.max(this.minScale,g-(c*g)/a),false)}this.update();f.consume()}this.index=null;this.active=false}};mxOutline.prototype.destroy=function(){if(this.source!=null){this.source.removeListener(this.panHandler);this.source.removeListener(this.refreshHandler);this.source.getModel().removeListener(this.updateHandler);this.source.getView().removeListener(this.updateHandler);mxEvent.addListener(this.source.container,"scroll",this.updateHandler);this.source=null}if(this.outline!=null){this.outline.removeMouseListener(this);this.outline.destroy();this.outline=null}if(this.selectionBorder!=null){this.selectionBorder.destroy();this.selectionBorder=null}if(this.sizer!=null){this.sizer.destroy();this.sizer=null}};