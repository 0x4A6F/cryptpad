function mxGraphView(a){this.graph=a;this.translate=new mxPoint();this.graphBounds=new mxRectangle();this.states=new mxDictionary()}mxGraphView.prototype=new mxEventSource();mxGraphView.prototype.constructor=mxGraphView;mxGraphView.prototype.EMPTY_POINT=new mxPoint();mxGraphView.prototype.doneResource=(mxClient.language!="none")?"done":"";mxGraphView.prototype.updatingDocumentResource=(mxClient.language!="none")?"updatingDocument":"";mxGraphView.prototype.allowEval=false;mxGraphView.prototype.captureDocumentGesture=true;mxGraphView.prototype.optimizeVmlReflows=true;mxGraphView.prototype.rendering=true;mxGraphView.prototype.graph=null;mxGraphView.prototype.currentRoot=null;mxGraphView.prototype.graphBounds=null;mxGraphView.prototype.scale=1;mxGraphView.prototype.translate=null;mxGraphView.prototype.states=null;mxGraphView.prototype.updateStyle=false;mxGraphView.prototype.lastNode=null;mxGraphView.prototype.lastHtmlNode=null;mxGraphView.prototype.lastForegroundNode=null;mxGraphView.prototype.lastForegroundHtmlNode=null;mxGraphView.prototype.getGraphBounds=function(){return this.graphBounds};mxGraphView.prototype.setGraphBounds=function(a){this.graphBounds=a};mxGraphView.prototype.getBounds=function(c){var a=null;if(c!=null&&c.length>0){var b=this.graph.getModel();for(var d=0;d<c.length;d++){if(b.isVertex(c[d])||b.isEdge(c[d])){var e=this.getState(c[d]);if(e!=null){if(a==null){a=mxRectangle.fromRectangle(e)}else{a.add(e)}}}}}return a};mxGraphView.prototype.setCurrentRoot=function(a){if(this.currentRoot!=a){var c=new mxCurrentRootChange(this,a);c.execute();var b=new mxUndoableEdit(this,false);b.add(c);this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",b));this.graph.sizeDidChange()}return a};mxGraphView.prototype.scaleAndTranslate=function(e,b,a){var c=this.scale;var d=new mxPoint(this.translate.x,this.translate.y);if(this.scale!=e||this.translate.x!=b||this.translate.y!=a){this.scale=e;this.translate.x=b;this.translate.y=a;if(this.isEventsEnabled()){this.revalidate();this.graph.sizeDidChange()}}this.fireEvent(new mxEventObject(mxEvent.SCALE_AND_TRANSLATE,"scale",e,"previousScale",c,"translate",this.translate,"previousTranslate",d))};mxGraphView.prototype.getScale=function(){return this.scale};mxGraphView.prototype.setScale=function(b){var a=this.scale;if(this.scale!=b){this.scale=b;if(this.isEventsEnabled()){this.revalidate();this.graph.sizeDidChange()}}this.fireEvent(new mxEventObject(mxEvent.SCALE,"scale",b,"previousScale",a))};mxGraphView.prototype.getTranslate=function(){return this.translate};mxGraphView.prototype.setTranslate=function(b,a){var c=new mxPoint(this.translate.x,this.translate.y);if(this.translate.x!=b||this.translate.y!=a){this.translate.x=b;this.translate.y=a;if(this.isEventsEnabled()){this.revalidate();this.graph.sizeDidChange()}}this.fireEvent(new mxEventObject(mxEvent.TRANSLATE,"translate",this.translate,"previousTranslate",c))};mxGraphView.prototype.refresh=function(){if(this.currentRoot!=null){this.clear()}this.revalidate()};mxGraphView.prototype.revalidate=function(){this.invalidate();this.validate()};mxGraphView.prototype.clear=function(a,f,e){var c=this.graph.getModel();a=a||c.getRoot();f=(f!=null)?f:false;e=(e!=null)?e:true;this.removeState(a);if(e&&(f||a!=this.currentRoot)){var b=c.getChildCount(a);for(var d=0;d<b;d++){this.clear(c.getChildAt(a,d),f)}}else{this.invalidate(a)}};mxGraphView.prototype.invalidate=function(j,c,h){var g=this.graph.getModel();j=j||g.getRoot();c=(c!=null)?c:true;h=(h!=null)?h:true;var b=this.getState(j);if(b!=null){b.invalid=true}if(!j.invalidating){j.invalidating=true;if(c){var e=g.getChildCount(j);for(var f=0;f<e;f++){var d=g.getChildAt(j,f);this.invalidate(d,c,h)}}if(h){var a=g.getEdgeCount(j);for(var f=0;f<a;f++){this.invalidate(g.getEdgeAt(j,f),c,h)}}delete j.invalidating}};mxGraphView.prototype.validate=function(a){var c=mxLog.enter("mxGraphView.validate");window.status=mxResources.get(this.updatingDocumentResource)||this.updatingDocumentResource;this.resetValidationState();var b=null;if(this.optimizeVmlReflows&&this.canvas!=null&&this.textDiv==null&&((document.documentMode==8&&!mxClient.IS_EM)||mxClient.IS_QUIRKS)){this.placeholder=document.createElement("div");this.placeholder.style.position="absolute";this.placeholder.style.width=this.canvas.clientWidth+"px";this.placeholder.style.height=this.canvas.clientHeight+"px";this.canvas.parentNode.appendChild(this.placeholder);b=this.drawPane.style.display;this.canvas.style.display="none";this.textDiv=document.createElement("div");this.textDiv.style.position="absolute";this.textDiv.style.whiteSpace="nowrap";this.textDiv.style.visibility="hidden";this.textDiv.style.display=(mxClient.IS_QUIRKS)?"inline":"inline-block";this.textDiv.style.zoom="1";document.body.appendChild(this.textDiv)}var d=this.getBoundingBox(this.validateCellState(this.validateCell(a||((this.currentRoot!=null)?this.currentRoot:this.graph.getModel().getRoot()))));this.setGraphBounds((d!=null)?d:this.getEmptyBounds());this.validateBackground();if(b!=null){this.canvas.style.display=b;this.textDiv.parentNode.removeChild(this.textDiv);if(this.placeholder!=null){this.placeholder.parentNode.removeChild(this.placeholder)}this.textDiv=null}this.resetValidationState();window.status=mxResources.get(this.doneResource)||this.doneResource;mxLog.leave("mxGraphView.validate",c)};mxGraphView.prototype.getEmptyBounds=function(){return new mxRectangle(this.translate.x*this.scale,this.translate.y*this.scale)};mxGraphView.prototype.getBoundingBox=function(f,e){e=(e!=null)?e:true;var g=null;if(f!=null){if(f.shape!=null&&f.shape.boundingBox!=null){g=f.shape.boundingBox.clone()}if(f.text!=null&&f.text.boundingBox!=null){if(g!=null){g.add(f.text.boundingBox)}else{g=f.text.boundingBox.clone()}}if(e){var b=this.graph.getModel();var a=b.getChildCount(f.cell);for(var c=0;c<a;c++){var d=this.getBoundingBox(this.getState(b.getChildAt(f.cell,c)));if(d!=null){if(g==null){g=d}else{g.add(d)}}}}}return g};mxGraphView.prototype.createBackgroundPageShape=function(a){return new mxRectangleShape(a,"white","black")};mxGraphView.prototype.validateBackground=function(){this.validateBackgroundImage();this.validateBackgroundPage()};mxGraphView.prototype.validateBackgroundImage=function(){var a=this.graph.getBackgroundImage();if(a!=null){if(this.backgroundImage==null||this.backgroundImage.image!=a.src){if(this.backgroundImage!=null){this.backgroundImage.destroy()}var b=new mxRectangle(0,0,1,1);this.backgroundImage=new mxImageShape(b,a.src);this.backgroundImage.dialect=this.graph.dialect;this.backgroundImage.init(this.backgroundPane);this.backgroundImage.redraw();if(document.documentMode==8&&!mxClient.IS_EM){mxEvent.addGestureListeners(this.backgroundImage.node,mxUtils.bind(this,function(c){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(c))}),mxUtils.bind(this,function(c){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(c))}),mxUtils.bind(this,function(c){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(c))}))}}this.redrawBackgroundImage(this.backgroundImage,a)}else{if(this.backgroundImage!=null){this.backgroundImage.destroy();this.backgroundImage=null}}};mxGraphView.prototype.validateBackgroundPage=function(){if(this.graph.pageVisible){var a=this.getBackgroundPageBounds();if(this.backgroundPageShape==null){this.backgroundPageShape=this.createBackgroundPageShape(a);this.backgroundPageShape.scale=this.scale;this.backgroundPageShape.isShadow=true;this.backgroundPageShape.dialect=this.graph.dialect;this.backgroundPageShape.init(this.backgroundPane);this.backgroundPageShape.redraw();if(this.graph.nativeDblClickEnabled){mxEvent.addListener(this.backgroundPageShape.node,"dblclick",mxUtils.bind(this,function(b){this.graph.dblClick(b)}))}mxEvent.addGestureListeners(this.backgroundPageShape.node,mxUtils.bind(this,function(b){this.graph.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(b))}),mxUtils.bind(this,function(b){if(this.graph.tooltipHandler!=null&&this.graph.tooltipHandler.isHideOnHover()){this.graph.tooltipHandler.hide()}if(this.graph.isMouseDown&&!mxEvent.isConsumed(b)){this.graph.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(b))}}),mxUtils.bind(this,function(b){this.graph.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(b))}))}else{this.backgroundPageShape.scale=this.scale;this.backgroundPageShape.bounds=a;this.backgroundPageShape.redraw()}}else{if(this.backgroundPageShape!=null){this.backgroundPageShape.destroy();this.backgroundPageShape=null}}};mxGraphView.prototype.getBackgroundPageBounds=function(){var a=this.graph.pageFormat;var c=this.scale*this.graph.pageScale;var b=new mxRectangle(this.scale*this.translate.x,this.scale*this.translate.y,a.width*c,a.height*c);return b};mxGraphView.prototype.redrawBackgroundImage=function(b,a){b.scale=this.scale;b.bounds.x=this.scale*this.translate.x;b.bounds.y=this.scale*this.translate.y;b.bounds.width=this.scale*a.width;b.bounds.height=this.scale*a.height;b.redraw()};mxGraphView.prototype.validateCell=function(a,f){f=(f!=null)?f:true;if(a!=null){f=f&&this.graph.isCellVisible(a);var e=this.getState(a,f);if(e!=null&&!f){this.removeState(a)}else{var c=this.graph.getModel();var b=c.getChildCount(a);for(var d=0;d<b;d++){this.validateCell(c.getChildAt(a,d),f&&(!this.isCellCollapsed(a)||a==this.currentRoot))}}}return a};mxGraphView.prototype.validateCellState=function(a,e){e=(e!=null)?e:true;var f=null;if(a!=null){f=this.getState(a);if(f!=null){var c=this.graph.getModel();if(f.invalid){f.invalid=false;if(f.style==null){f.style=this.graph.getCellStyle(f.cell)}if(a!=this.currentRoot){this.validateCellState(c.getParent(a),false)}f.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(a,true),false),true);f.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(a,false),false),false);this.updateCellState(f);if(a!=this.currentRoot&&!f.invalid){this.graph.cellRenderer.redraw(f,false,this.isRendering())}}if(e&&!f.invalid){if(f.shape!=null){this.stateValidated(f)}var b=c.getChildCount(a);for(var d=0;d<b;d++){this.validateCellState(c.getChildAt(a,d))}}}}return f};mxGraphView.prototype.updateCellState=function(d){d.absoluteOffset.x=0;d.absoluteOffset.y=0;d.origin.x=0;d.origin.y=0;d.length=0;if(d.cell!=this.currentRoot){var c=this.graph.getModel();var b=this.getState(c.getParent(d.cell));if(b!=null&&b.cell!=this.currentRoot){d.origin.x+=b.origin.x;d.origin.y+=b.origin.y}var f=this.graph.getChildOffsetForCell(d.cell);if(f!=null){d.origin.x+=f.x;d.origin.y+=f.y}var e=this.graph.getCellGeometry(d.cell);if(e!=null){if(!c.isEdge(d.cell)){f=e.offset||this.EMPTY_POINT;if(e.relative&&b!=null){if(c.isEdge(b.cell)){var a=this.getPoint(b,e);if(a!=null){d.origin.x+=(a.x/this.scale)-b.origin.x-this.translate.x;d.origin.y+=(a.y/this.scale)-b.origin.y-this.translate.y}}else{d.origin.x+=e.x*b.width/this.scale+f.x;d.origin.y+=e.y*b.height/this.scale+f.y}}else{d.absoluteOffset.x=this.scale*f.x;d.absoluteOffset.y=this.scale*f.y;d.origin.x+=e.x;d.origin.y+=e.y}}d.x=this.scale*(this.translate.x+d.origin.x);d.y=this.scale*(this.translate.y+d.origin.y);d.width=this.scale*e.width;d.unscaledWidth=e.width;d.height=this.scale*e.height;if(c.isVertex(d.cell)){this.updateVertexState(d,e)}if(c.isEdge(d.cell)){this.updateEdgeState(d,e)}}}d.updateCachedBounds()};mxGraphView.prototype.isCellCollapsed=function(a){return this.graph.isCellCollapsed(a)};mxGraphView.prototype.updateVertexState=function(a,e){var f=this.graph.getModel();var b=this.getState(f.getParent(a.cell));if(e.relative&&b!=null&&!f.isEdge(b.cell)){var d=mxUtils.toRadians(b.style[mxConstants.STYLE_ROTATION]||"0");if(d!=0){var i=Math.cos(d);var h=Math.sin(d);var g=new mxPoint(a.getCenterX(),a.getCenterY());var c=new mxPoint(b.getCenterX(),b.getCenterY());var j=mxUtils.getRotatedPoint(g,i,h,c);a.x=j.x-a.width/2;a.y=j.y-a.height/2}}this.updateVertexLabelOffset(a)};mxGraphView.prototype.updateEdgeState=function(b,d){var a=b.getVisibleTerminalState(true);var c=b.getVisibleTerminalState(false);if((this.graph.model.getTerminal(b.cell,true)!=null&&a==null)||(a==null&&d.getTerminalPoint(true)==null)||(this.graph.model.getTerminal(b.cell,false)!=null&&c==null)||(c==null&&d.getTerminalPoint(false)==null)){this.clear(b.cell,true)}else{this.updateFixedTerminalPoints(b,a,c);this.updatePoints(b,d.points,a,c);this.updateFloatingTerminalPoints(b,a,c);var e=b.absolutePoints;if(b.cell!=this.currentRoot&&(e==null||e.length<2||e[0]==null||e[e.length-1]==null)){this.clear(b.cell,true)}else{this.updateEdgeBounds(b);this.updateEdgeLabelOffset(b)}}};mxGraphView.prototype.updateVertexLabelOffset=function(d){var c=mxUtils.getValue(d.style,mxConstants.STYLE_LABEL_POSITION,mxConstants.ALIGN_CENTER);if(c==mxConstants.ALIGN_LEFT){var e=mxUtils.getValue(d.style,mxConstants.STYLE_LABEL_WIDTH,null);if(e!=null){e*=this.scale}else{e=d.width}d.absoluteOffset.x-=e}else{if(c==mxConstants.ALIGN_RIGHT){d.absoluteOffset.x+=d.width}else{if(c==mxConstants.ALIGN_CENTER){var e=mxUtils.getValue(d.style,mxConstants.STYLE_LABEL_WIDTH,null);if(e!=null){var f=mxUtils.getValue(d.style,mxConstants.STYLE_ALIGN,mxConstants.ALIGN_CENTER);var b=0;if(f==mxConstants.ALIGN_CENTER){b=0.5}else{if(f==mxConstants.ALIGN_RIGHT){b=1}}if(b!=0){d.absoluteOffset.x-=(e*this.scale-d.width)*b}}}}}var a=mxUtils.getValue(d.style,mxConstants.STYLE_VERTICAL_LABEL_POSITION,mxConstants.ALIGN_MIDDLE);if(a==mxConstants.ALIGN_TOP){d.absoluteOffset.y-=d.height}else{if(a==mxConstants.ALIGN_BOTTOM){d.absoluteOffset.y+=d.height}}};mxGraphView.prototype.resetValidationState=function(){this.lastNode=null;this.lastHtmlNode=null;this.lastForegroundNode=null;this.lastForegroundHtmlNode=null};mxGraphView.prototype.stateValidated=function(e){var b=(this.graph.getModel().isEdge(e.cell)&&this.graph.keepEdgesInForeground)||(this.graph.getModel().isVertex(e.cell)&&this.graph.keepEdgesInBackground);var d=(b)?this.lastForegroundHtmlNode||this.lastHtmlNode:this.lastHtmlNode;var c=(b)?this.lastForegroundNode||this.lastNode:this.lastNode;var a=this.graph.cellRenderer.insertStateAfter(e,c,d);if(b){this.lastForegroundHtmlNode=a[1];this.lastForegroundNode=a[0]}else{this.lastHtmlNode=a[1];this.lastNode=a[0]}};mxGraphView.prototype.updateFixedTerminalPoints=function(a,b,c){this.updateFixedTerminalPoint(a,b,true,this.graph.getConnectionConstraint(a,b,true));this.updateFixedTerminalPoint(a,c,false,this.graph.getConnectionConstraint(a,c,false))};mxGraphView.prototype.updateFixedTerminalPoint=function(b,a,c,d){b.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(b,a,c,d),c)};mxGraphView.prototype.getFixedTerminalPoint=function(c,e,a,b){var h=null;if(b!=null){h=this.graph.getConnectionPoint(e,b)}if(h==null&&e==null){var i=this.scale;var f=this.translate;var g=c.origin;var d=this.graph.getCellGeometry(c.cell);h=d.getTerminalPoint(a);if(h!=null){h=new mxPoint(i*(f.x+h.x+g.x),i*(f.y+h.y+g.y))}}return h};mxGraphView.prototype.updateBoundsFromStencil=function(c){var b=null;if(c!=null&&c.shape!=null&&c.shape.stencil!=null&&c.shape.stencil.aspect=="fixed"){b=mxRectangle.fromRectangle(c);var a=c.shape.stencil.computeAspect(c.style,c.x,c.y,c.width,c.height);c.setRect(a.x,a.y,c.shape.stencil.w0*a.width,c.shape.stencil.h0*a.height)}return b};mxGraphView.prototype.updatePoints=function(e,l,b,j){if(e!=null){var n=[];n.push(e.absolutePoints[0]);var h=this.getEdgeStyle(e,l,b,j);if(h!=null){var a=this.getTerminalPort(e,b,true);var c=this.getTerminalPort(e,j,false);var d=this.updateBoundsFromStencil(a);var k=this.updateBoundsFromStencil(c);h(e,a,c,l,n);if(d!=null){a.setRect(d.x,d.y,d.width,d.height)}if(k!=null){c.setRect(k.x,k.y,k.width,k.height)}}else{if(l!=null){for(var g=0;g<l.length;g++){if(l[g]!=null){var m=mxUtils.clone(l[g]);n.push(this.transformControlPoint(e,m))}}}}var f=e.absolutePoints;n.push(f[f.length-1]);e.absolutePoints=n}};mxGraphView.prototype.transformControlPoint=function(a,b){if(a!=null&&b!=null){var c=a.origin;return new mxPoint(this.scale*(b.x+this.translate.x+c.x),this.scale*(b.y+this.translate.y+c.y))}return null};mxGraphView.prototype.isLoopStyleEnabled=function(c,b,d,e){var f=this.graph.getConnectionConstraint(c,d,true);var a=this.graph.getConnectionConstraint(c,e,false);if(!mxUtils.getValue(c.style,mxConstants.STYLE_ORTHOGONAL_LOOP,false)||((f==null||f.point==null)&&(a==null||a.point==null))){return d!=null&&d==e}return false};mxGraphView.prototype.getEdgeStyle=function(edge,points,source,target){var edgeStyle=this.isLoopStyleEnabled(edge,points,source,target)?mxUtils.getValue(edge.style,mxConstants.STYLE_LOOP,this.graph.defaultLoopStyle):(!mxUtils.getValue(edge.style,mxConstants.STYLE_NOEDGESTYLE,false)?edge.style[mxConstants.STYLE_EDGE]:null);if(typeof(edgeStyle)=="string"){var tmp=mxStyleRegistry.getValue(edgeStyle);if(tmp==null&&this.isAllowEval()){tmp=mxUtils.eval(edgeStyle)}edgeStyle=tmp}if(typeof(edgeStyle)=="function"){return edgeStyle}return null};mxGraphView.prototype.updateFloatingTerminalPoints=function(c,b,d){var e=c.absolutePoints;var f=e[0];var a=e[e.length-1];if(a==null&&d!=null){this.updateFloatingTerminalPoint(c,d,b,false)}if(f==null&&b!=null){this.updateFloatingTerminalPoint(c,b,d,true)}};mxGraphView.prototype.updateFloatingTerminalPoint=function(b,d,a,c){b.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(b,d,a,c),c)};mxGraphView.prototype.getFloatingTerminalPoint=function(d,c,g,a){c=this.getTerminalPort(d,c,a);var h=this.getNextPoint(d,g,a);var k=this.graph.isOrthogonal(d);var f=mxUtils.toRadians(Number(c.style[mxConstants.STYLE_ROTATION]||"0"));var b=new mxPoint(c.getCenterX(),c.getCenterY());if(f!=0){var j=Math.cos(-f);var i=Math.sin(-f);h=mxUtils.getRotatedPoint(h,j,i,b)}var e=parseFloat(d.style[mxConstants.STYLE_PERIMETER_SPACING]||0);e+=parseFloat(d.style[(a)?mxConstants.STYLE_SOURCE_PERIMETER_SPACING:mxConstants.STYLE_TARGET_PERIMETER_SPACING]||0);var l=this.getPerimeterPoint(c,h,f==0&&k,e);if(f!=0){var j=Math.cos(f);var i=Math.sin(f);l=mxUtils.getRotatedPoint(l,j,i,b)}return l};mxGraphView.prototype.getTerminalPort=function(e,c,d){var b=(d)?mxConstants.STYLE_SOURCE_PORT:mxConstants.STYLE_TARGET_PORT;var f=mxUtils.getValue(e.style,b);if(f!=null){var a=this.getState(this.graph.getModel().getCell(f));if(a!=null){c=a}}return c};mxGraphView.prototype.getPerimeterPoint=function(d,e,g,c){var a=null;if(d!=null){var b=this.getPerimeterFunction(d);if(b!=null&&e!=null){var f=this.getPerimeterBounds(d,c);if(f.width>0||f.height>0){a=b(f,d,e,g)}}if(a==null){a=this.getPoint(d)}}return a};mxGraphView.prototype.getRoutingCenterX=function(b){var a=(b.style!=null)?parseFloat(b.style[mxConstants.STYLE_ROUTING_CENTER_X])||0:0;return b.getCenterX()+a*b.width};mxGraphView.prototype.getRoutingCenterY=function(b){var a=(b.style!=null)?parseFloat(b.style[mxConstants.STYLE_ROUTING_CENTER_Y])||0:0;return b.getCenterY()+a*b.height};mxGraphView.prototype.getPerimeterBounds=function(b,a){a=(a!=null)?a:0;if(b!=null){a+=parseFloat(b.style[mxConstants.STYLE_PERIMETER_SPACING]||0)}return b.getPerimeterBounds(a*this.scale)};mxGraphView.prototype.getPerimeterFunction=function(state){var perimeter=state.style[mxConstants.STYLE_PERIMETER];if(typeof(perimeter)=="string"){var tmp=mxStyleRegistry.getValue(perimeter);if(tmp==null&&this.isAllowEval()){tmp=mxUtils.eval(perimeter)}perimeter=tmp}if(typeof(perimeter)=="function"){return perimeter}return null};mxGraphView.prototype.getNextPoint=function(c,e,d){var f=c.absolutePoints;var a=null;if(f!=null&&f.length>=2){var b=f.length;a=f[(d)?Math.min(1,b-1):Math.max(0,b-2)]}if(a==null&&e!=null){a=new mxPoint(e.getCenterX(),e.getCenterY())}return a};mxGraphView.prototype.getVisibleTerminal=function(c,d){var b=this.graph.getModel();var a=b.getTerminal(c,d);var e=a;while(a!=null&&a!=this.currentRoot){if(!this.graph.isCellVisible(e)||this.isCellCollapsed(a)){e=a}a=b.getParent(a)}if(b.getParent(e)==b.getRoot()){e=null}return e};mxGraphView.prototype.updateEdgeBounds=function(c){var n=c.absolutePoints;var o=n[0];var l=n[n.length-1];if(o.x!=l.x||o.y!=l.y){var r=l.x-o.x;var p=l.y-o.y;c.terminalDistance=Math.sqrt(r*r+p*p)}else{c.terminalDistance=0}var d=0;var j=[];var q=o;if(q!=null){var f=q.x;var e=q.y;var b=f;var a=e;for(var h=1;h<n.length;h++){var g=n[h];if(g!=null){var r=q.x-g.x;var p=q.y-g.y;var k=Math.sqrt(r*r+p*p);j.push(k);d+=k;q=g;f=Math.min(q.x,f);e=Math.min(q.y,e);b=Math.max(q.x,b);a=Math.max(q.y,a)}}c.length=d;c.segments=j;var m=1;c.x=f;c.y=e;c.width=Math.max(m,b-f);c.height=Math.max(m,a-e)}};mxGraphView.prototype.getPoint=function(d,e){var i=d.getCenterX();var h=d.getCenterY();if(d.segments!=null&&(e==null||e.relative)){var m=(e!=null)?e.x/2:0;var s=d.absolutePoints.length;var o=Math.round((m+0.5)*d.length);var a=d.segments[0];var c=0;var g=1;while(o>=Math.round(c+a)&&g<s-1){c+=a;a=d.segments[g++]}var n=(a==0)?0:(o-c)/a;var b=d.absolutePoints[g-1];var u=d.absolutePoints[g];if(b!=null&&u!=null){var l=0;var q=0;var p=0;if(e!=null){l=e.y;var f=e.offset;if(f!=null){q=f.x;p=f.y}}var k=u.x-b.x;var j=u.y-b.y;var t=(a==0)?0:j/a;var r=(a==0)?0:k/a;i=b.x+k*n+(t*l+q)*this.scale;h=b.y+j*n-(r*l-p)*this.scale}}else{if(e!=null){var f=e.offset;if(f!=null){i+=f.x;h+=f.y}}}return new mxPoint(i,h)};mxGraphView.prototype.getRelativePoint=function(s,k,j){var e=this.graph.getModel();var g=e.getGeometry(s.cell);if(g!=null){var B=s.absolutePoints.length;if(g.relative&&B>1){var l=s.length;var t=s.segments;var b=s.absolutePoints[0];var F=s.absolutePoints[1];var a=mxUtils.ptSegDistSq(b.x,b.y,F.x,F.y,k,j);var h=0;var C=0;var f=0;for(var u=2;u<B;u++){C+=t[u-2];F=s.absolutePoints[u];var r=mxUtils.ptSegDistSq(b.x,b.y,F.x,F.y,k,j);if(r<=a){a=r;h=u-1;f=C}b=F}var z=t[h];b=s.absolutePoints[h];F=s.absolutePoints[h+1];var v=b.x;var c=b.y;var w=F.x;var d=F.y;var p=k;var n=j;var m=v-w;var o=c-d;p-=w;n-=d;var G=0;p=m-p;n=o-n;var q=p*m+n*o;if(q<=0){G=0}else{G=q*q/(m*m+o*o)}var A=Math.sqrt(G);if(A>z){A=z}var E=Math.sqrt(mxUtils.ptSegDistSq(b.x,b.y,F.x,F.y,k,j));var D=mxUtils.relativeCcw(b.x,b.y,F.x,F.y,k,j);if(D==-1){E=-E}return new mxPoint(((l/2-f-A)/l)*-2,E/this.scale)}}return new mxPoint()};mxGraphView.prototype.updateEdgeLabelOffset=function(a){var j=a.absolutePoints;a.absoluteOffset.x=a.getCenterX();a.absoluteOffset.y=a.getCenterY();if(j!=null&&j.length>0&&a.segments!=null){var g=this.graph.getCellGeometry(a.cell);if(g.relative){var d=this.getPoint(a,g);if(d!=null){a.absoluteOffset=d}}else{var k=j[0];var e=j[j.length-1];if(k!=null&&e!=null){var m=e.x-k.x;var l=e.y-k.y;var b=0;var i=0;var c=g.offset;if(c!=null){b=c.x;i=c.y}var h=k.x+m/2+b*this.scale;var f=k.y+l/2+i*this.scale;a.absoluteOffset.x=h;a.absoluteOffset.y=f}}}};mxGraphView.prototype.getState=function(a,b){b=b||false;var c=null;if(a!=null){c=this.states.get(a);if(b&&(c==null||this.updateStyle)&&this.graph.isCellVisible(a)){if(c==null){c=this.createState(a);this.states.put(a,c)}else{c.style=this.graph.getCellStyle(a)}}}return c};mxGraphView.prototype.isRendering=function(){return this.rendering};mxGraphView.prototype.setRendering=function(a){this.rendering=a};mxGraphView.prototype.isAllowEval=function(){return this.allowEval};mxGraphView.prototype.setAllowEval=function(a){this.allowEval=a};mxGraphView.prototype.getStates=function(){return this.states};mxGraphView.prototype.setStates=function(a){this.states=a};mxGraphView.prototype.getCellStates=function(b){if(b==null){return this.states}else{var a=[];for(var c=0;c<b.length;c++){var d=this.getState(b[c]);if(d!=null){a.push(d)}}return a}};mxGraphView.prototype.removeState=function(a){var b=null;if(a!=null){b=this.states.remove(a);if(b!=null){this.graph.cellRenderer.destroy(b);b.invalid=true;b.destroy()}}return b};mxGraphView.prototype.createState=function(a){return new mxCellState(this,a,this.graph.getCellStyle(a))};mxGraphView.prototype.getCanvas=function(){return this.canvas};mxGraphView.prototype.getBackgroundPane=function(){return this.backgroundPane};mxGraphView.prototype.getDrawPane=function(){return this.drawPane};mxGraphView.prototype.getOverlayPane=function(){return this.overlayPane};mxGraphView.prototype.getDecoratorPane=function(){return this.decoratorPane};mxGraphView.prototype.isContainerEvent=function(a){var b=mxEvent.getSource(a);return(b==this.graph.container||b.parentNode==this.backgroundPane||(b.parentNode!=null&&b.parentNode.parentNode==this.backgroundPane)||b==this.canvas.parentNode||b==this.canvas||b==this.backgroundPane||b==this.drawPane||b==this.overlayPane||b==this.decoratorPane)};mxGraphView.prototype.isScrollEvent=function(c){var g=mxUtils.getOffset(this.graph.container);var f=new mxPoint(c.clientX-g.x,c.clientY-g.y);var a=this.graph.container.offsetWidth;var b=this.graph.container.clientWidth;if(a>b&&f.x>b+2&&f.x<=a){return true}var e=this.graph.container.offsetHeight;var d=this.graph.container.clientHeight;if(e>d&&f.y>d+2&&f.y<=e){return true}return false};mxGraphView.prototype.init=function(){this.installListeners();var a=this.graph;if(a.dialect==mxConstants.DIALECT_SVG){this.createSvg()}else{if(a.dialect==mxConstants.DIALECT_VML){this.createVml()}else{this.createHtml()}}};mxGraphView.prototype.installListeners=function(){var c=this.graph;var a=c.container;if(a!=null){if(mxClient.IS_TOUCH){mxEvent.addListener(a,"gesturestart",mxUtils.bind(this,function(d){c.fireGestureEvent(d);mxEvent.consume(d)}));mxEvent.addListener(a,"gesturechange",mxUtils.bind(this,function(d){c.fireGestureEvent(d);mxEvent.consume(d)}));mxEvent.addListener(a,"gestureend",mxUtils.bind(this,function(d){c.fireGestureEvent(d);mxEvent.consume(d)}))}mxEvent.addGestureListeners(a,mxUtils.bind(this,function(d){if(this.isContainerEvent(d)&&((!mxClient.IS_IE&&!mxClient.IS_IE11&&!mxClient.IS_GC&&!mxClient.IS_OP&&!mxClient.IS_SF)||!this.isScrollEvent(d))){c.fireMouseEvent(mxEvent.MOUSE_DOWN,new mxMouseEvent(d))}}),mxUtils.bind(this,function(d){if(this.isContainerEvent(d)){c.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(d))}}),mxUtils.bind(this,function(d){if(this.isContainerEvent(d)){c.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(d))}}));mxEvent.addListener(a,"dblclick",mxUtils.bind(this,function(d){if(this.isContainerEvent(d)){c.dblClick(d)}}));var b=function(e){var f=null;if(mxClient.IS_TOUCH){var d=mxEvent.getClientX(e);var h=mxEvent.getClientY(e);var g=mxUtils.convertPoint(a,d,h);f=c.view.getState(c.getCellAt(g.x,g.y))}return f};c.addMouseListener({mouseDown:function(d,e){c.popupMenuHandler.hideMenu()},mouseMove:function(){},mouseUp:function(){}});this.moveHandler=mxUtils.bind(this,function(d){if(c.tooltipHandler!=null&&c.tooltipHandler.isHideOnHover()){c.tooltipHandler.hide()}if(this.captureDocumentGesture&&c.isMouseDown&&c.container!=null&&!this.isContainerEvent(d)&&c.container.style.display!="none"&&c.container.style.visibility!="hidden"&&!mxEvent.isConsumed(d)){c.fireMouseEvent(mxEvent.MOUSE_MOVE,new mxMouseEvent(d,b(d)))}});this.endHandler=mxUtils.bind(this,function(d){if(this.captureDocumentGesture&&c.isMouseDown&&c.container!=null&&!this.isContainerEvent(d)&&c.container.style.display!="none"&&c.container.style.visibility!="hidden"){c.fireMouseEvent(mxEvent.MOUSE_UP,new mxMouseEvent(d))}});mxEvent.addGestureListeners(document,null,this.moveHandler,this.endHandler)}};mxGraphView.prototype.createHtml=function(){var a=this.graph.container;if(a!=null){this.canvas=this.createHtmlPane("100%","100%");this.canvas.style.overflow="hidden";this.backgroundPane=this.createHtmlPane("1px","1px");this.drawPane=this.createHtmlPane("1px","1px");this.overlayPane=this.createHtmlPane("1px","1px");this.decoratorPane=this.createHtmlPane("1px","1px");this.canvas.appendChild(this.backgroundPane);this.canvas.appendChild(this.drawPane);this.canvas.appendChild(this.overlayPane);this.canvas.appendChild(this.decoratorPane);a.appendChild(this.canvas);this.updateContainerStyle(a);if(mxClient.IS_QUIRKS){var b=mxUtils.bind(this,function(d){var f=this.getGraphBounds();var e=f.x+f.width+this.graph.border;var c=f.y+f.height+this.graph.border;this.updateHtmlCanvasSize(e,c)});mxEvent.addListener(window,"resize",b)}}};mxGraphView.prototype.updateHtmlCanvasSize=function(c,a){if(this.graph.container!=null){var b=this.graph.container.offsetWidth;var d=this.graph.container.offsetHeight;if(b<c){this.canvas.style.width=c+"px"}else{this.canvas.style.width="100%"}if(d<a){this.canvas.style.height=a+"px"}else{this.canvas.style.height="100%"}}};mxGraphView.prototype.createHtmlPane=function(b,a){var c=document.createElement("DIV");if(b!=null&&a!=null){c.style.position="absolute";c.style.left="0px";c.style.top="0px";c.style.width=b;c.style.height=a}else{c.style.position="relative"}return c};mxGraphView.prototype.createVml=function(){var b=this.graph.container;if(b!=null){var c=b.offsetWidth;var a=b.offsetHeight;this.canvas=this.createVmlPane(c,a);this.canvas.style.overflow="hidden";this.backgroundPane=this.createVmlPane(c,a);this.drawPane=this.createVmlPane(c,a);this.overlayPane=this.createVmlPane(c,a);this.decoratorPane=this.createVmlPane(c,a);this.canvas.appendChild(this.backgroundPane);this.canvas.appendChild(this.drawPane);this.canvas.appendChild(this.overlayPane);this.canvas.appendChild(this.decoratorPane);b.appendChild(this.canvas)}};mxGraphView.prototype.createVmlPane=function(b,a){var c=document.createElement(mxClient.VML_PREFIX+":group");c.style.position="absolute";c.style.left="0px";c.style.top="0px";c.style.width=b+"px";c.style.height=a+"px";c.setAttribute("coordsize",b+","+a);c.setAttribute("coordorigin","0,0");return c};mxGraphView.prototype.createSvg=function(){var b=this.graph.container;this.canvas=document.createElementNS(mxConstants.NS_SVG,"g");this.backgroundPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.backgroundPane);this.drawPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.drawPane);this.overlayPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.overlayPane);this.decoratorPane=document.createElementNS(mxConstants.NS_SVG,"g");this.canvas.appendChild(this.decoratorPane);var a=document.createElementNS(mxConstants.NS_SVG,"svg");a.style.width="100%";a.style.height="100%";a.style.display="block";a.appendChild(this.canvas);if(mxClient.IS_IE||mxClient.IS_IE11){a.style.overflow="hidden"}if(b!=null){b.appendChild(a);this.updateContainerStyle(b)}};mxGraphView.prototype.updateContainerStyle=function(a){var b=mxUtils.getCurrentStyle(a);if(b!=null&&b.position=="static"){a.style.position="relative"}if(mxClient.IS_POINTER){a.style.touchAction="none"}};mxGraphView.prototype.destroy=function(){var a=(this.canvas!=null)?this.canvas.ownerSVGElement:null;if(a==null){a=this.canvas}if(a!=null&&a.parentNode!=null){this.clear(this.currentRoot,true);mxEvent.removeGestureListeners(document,null,this.moveHandler,this.endHandler);mxEvent.release(this.graph.container);a.parentNode.removeChild(a);this.moveHandler=null;this.endHandler=null;this.canvas=null;this.backgroundPane=null;this.drawPane=null;this.overlayPane=null;this.decoratorPane=null}};function mxCurrentRootChange(b,a){this.view=b;this.root=a;this.previous=a;this.isUp=a==null;if(!this.isUp){var d=this.view.currentRoot;var c=this.view.graph.getModel();while(d!=null){if(d==a){this.isUp=true;break}d=c.getParent(d)}}}mxCurrentRootChange.prototype.execute=function(){var b=this.view.currentRoot;this.view.currentRoot=this.previous;this.previous=b;var c=this.view.graph.getTranslateForRoot(this.view.currentRoot);if(c!=null){this.view.translate=new mxPoint(-c.x,-c.y)}if(this.isUp){this.view.clear(this.view.currentRoot,true);this.view.validate()}else{this.view.refresh()}var a=(this.isUp)?mxEvent.UP:mxEvent.DOWN;this.view.fireEvent(new mxEventObject(a,"root",this.view.currentRoot,"previous",this.previous));this.isUp=!this.isUp};