function mxKeyHandler(a,b){if(a!=null){this.graph=a;this.target=b||document.documentElement;this.normalKeys=[];this.shiftKeys=[];this.controlKeys=[];this.controlShiftKeys=[];this.keydownHandler=mxUtils.bind(this,function(c){this.keyDown(c)});mxEvent.addListener(this.target,"keydown",this.keydownHandler);if(mxClient.IS_IE){mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}}mxKeyHandler.prototype.graph=null;mxKeyHandler.prototype.target=null;mxKeyHandler.prototype.normalKeys=null;mxKeyHandler.prototype.shiftKeys=null;mxKeyHandler.prototype.controlKeys=null;mxKeyHandler.prototype.controlShiftKeys=null;mxKeyHandler.prototype.enabled=true;mxKeyHandler.prototype.isEnabled=function(){return this.enabled};mxKeyHandler.prototype.setEnabled=function(a){this.enabled=a};mxKeyHandler.prototype.bindKey=function(b,a){this.normalKeys[b]=a};mxKeyHandler.prototype.bindShiftKey=function(b,a){this.shiftKeys[b]=a};mxKeyHandler.prototype.bindControlKey=function(b,a){this.controlKeys[b]=a};mxKeyHandler.prototype.bindControlShiftKey=function(b,a){this.controlShiftKeys[b]=a};mxKeyHandler.prototype.isControlDown=function(a){return mxEvent.isControlDown(a)};mxKeyHandler.prototype.getFunction=function(a){if(a!=null&&!mxEvent.isAltDown(a)){if(this.isControlDown(a)){if(mxEvent.isShiftDown(a)){return this.controlShiftKeys[a.keyCode]}else{return this.controlKeys[a.keyCode]}}else{if(mxEvent.isShiftDown(a)){return this.shiftKeys[a.keyCode]}else{return this.normalKeys[a.keyCode]}}}return null};mxKeyHandler.prototype.isGraphEvent=function(a){var b=mxEvent.getSource(a);if((b==this.target||b.parentNode==this.target)||(this.graph.cellEditor!=null&&this.graph.cellEditor.isEventSource(a))){return true}return mxUtils.isAncestorNode(this.graph.container,b)};mxKeyHandler.prototype.keyDown=function(a){if(this.isEnabledForEvent(a)){if(a.keyCode==27){this.escape(a)}else{if(!this.isEventIgnored(a)){var b=this.getFunction(a);if(b!=null){b(a);mxEvent.consume(a)}}}}};mxKeyHandler.prototype.isEnabledForEvent=function(a){return(this.graph.isEnabled()&&!mxEvent.isConsumed(a)&&this.isGraphEvent(a)&&this.isEnabled())};mxKeyHandler.prototype.isEventIgnored=function(a){return this.graph.isEditing()};mxKeyHandler.prototype.escape=function(a){if(this.graph.isEscapeEnabled()){this.graph.escape(a)}};mxKeyHandler.prototype.destroy=function(){if(this.target!=null&&this.keydownHandler!=null){mxEvent.removeListener(this.target,"keydown",this.keydownHandler);this.keydownHandler=null}this.target=null};