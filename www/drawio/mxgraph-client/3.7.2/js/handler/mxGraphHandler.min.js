function mxGraphHandler(a){this.graph=a;this.graph.addMouseListener(this);this.panHandler=mxUtils.bind(this,function(){this.updatePreviewShape();this.updateHint()});this.graph.addListener(mxEvent.PAN,this.panHandler);this.escapeHandler=mxUtils.bind(this,function(c,b){this.reset()});this.graph.addListener(mxEvent.ESCAPE,this.escapeHandler)}mxGraphHandler.prototype.graph=null;mxGraphHandler.prototype.maxCells=(mxClient.IS_IE)?20:50;mxGraphHandler.prototype.enabled=true;mxGraphHandler.prototype.highlightEnabled=true;mxGraphHandler.prototype.cloneEnabled=true;mxGraphHandler.prototype.moveEnabled=true;mxGraphHandler.prototype.guidesEnabled=false;mxGraphHandler.prototype.guide=null;mxGraphHandler.prototype.currentDx=null;mxGraphHandler.prototype.currentDy=null;mxGraphHandler.prototype.updateCursor=true;mxGraphHandler.prototype.selectEnabled=true;mxGraphHandler.prototype.removeCellsFromParent=true;mxGraphHandler.prototype.connectOnDrop=false;mxGraphHandler.prototype.scrollOnMove=true;mxGraphHandler.prototype.minimumSize=6;mxGraphHandler.prototype.previewColor="black";mxGraphHandler.prototype.htmlPreview=false;mxGraphHandler.prototype.shape=null;mxGraphHandler.prototype.scaleGrid=false;mxGraphHandler.prototype.rotationEnabled=true;mxGraphHandler.prototype.isEnabled=function(){return this.enabled};mxGraphHandler.prototype.setEnabled=function(a){this.enabled=a};mxGraphHandler.prototype.isCloneEnabled=function(){return this.cloneEnabled};mxGraphHandler.prototype.setCloneEnabled=function(a){this.cloneEnabled=a};mxGraphHandler.prototype.isMoveEnabled=function(){return this.moveEnabled};mxGraphHandler.prototype.setMoveEnabled=function(a){this.moveEnabled=a};mxGraphHandler.prototype.isSelectEnabled=function(){return this.selectEnabled};mxGraphHandler.prototype.setSelectEnabled=function(a){this.selectEnabled=a};mxGraphHandler.prototype.isRemoveCellsFromParent=function(){return this.removeCellsFromParent};mxGraphHandler.prototype.setRemoveCellsFromParent=function(a){this.removeCellsFromParent=a};mxGraphHandler.prototype.getInitialCellForEvent=function(a){return a.getCell()};mxGraphHandler.prototype.isDelayedSelection=function(a,b){return this.graph.isCellSelected(a)};mxGraphHandler.prototype.consumeMouseEvent=function(b,a){a.consume()};mxGraphHandler.prototype.mouseDown=function(c,d){if(!d.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&d.getState()!=null&&!mxEvent.isMultiTouchEvent(d.getEvent())){var a=this.getInitialCellForEvent(d);this.delayedSelection=this.isDelayedSelection(a,d);this.cell=null;if(this.isSelectEnabled()&&!this.delayedSelection){this.graph.selectCellForEvent(a,d.getEvent())}if(this.isMoveEnabled()){var b=this.graph.model;var e=b.getGeometry(a);if(this.graph.isCellMovable(a)&&((!b.isEdge(a)||this.graph.getSelectionCount()>1||(e.points!=null&&e.points.length>0)||b.getTerminal(a,true)==null||b.getTerminal(a,false)==null)||this.graph.allowDanglingEdges||(this.graph.isCloneEvent(d.getEvent())&&this.graph.isCellsCloneable()))){this.start(a,d.getX(),d.getY())}else{if(this.delayedSelection){this.cell=a}}this.cellWasClicked=true;this.consumeMouseEvent(mxEvent.MOUSE_DOWN,d)}}};mxGraphHandler.prototype.getGuideStates=function(){var c=this.graph.getDefaultParent();var a=this.graph.getModel();var b=mxUtils.bind(this,function(d){return this.graph.view.getState(d)!=null&&a.isVertex(d)&&a.getGeometry(d)!=null&&!a.getGeometry(d).relative});return this.graph.view.getCellStates(a.filterDescendants(b,c))};mxGraphHandler.prototype.getCells=function(a){if(!this.delayedSelection&&this.graph.isCellMovable(a)){return[a]}else{return this.graph.getMovableCells(this.graph.getSelectionCells())}};mxGraphHandler.prototype.getPreviewBounds=function(c){var e=this.getBoundingBox(c);if(e!=null){e.width=Math.max(0,e.width-1);e.height=Math.max(0,e.height-1);if(e.width<this.minimumSize){var b=this.minimumSize-e.width;e.x-=b/2;e.width=this.minimumSize}else{e.x=Math.round(e.x);e.width=Math.ceil(e.width)}var f=this.graph.view.translate;var d=this.graph.view.scale;if(e.height<this.minimumSize){var a=this.minimumSize-e.height;e.y-=a/2;e.height=this.minimumSize}else{e.y=Math.round(e.y);e.height=Math.ceil(e.height)}}return e};mxGraphHandler.prototype.getBoundingBox=function(c){var a=null;if(c!=null&&c.length>0){var b=this.graph.getModel();for(var d=0;d<c.length;d++){if(b.isVertex(c[d])||b.isEdge(c[d])){var e=this.graph.view.getState(c[d]);if(e!=null){var f=e;if(b.isVertex(c[d])&&e.shape!=null&&e.shape.boundingBox!=null){f=e.shape.boundingBox}if(a==null){a=mxRectangle.fromRectangle(f)}else{a.add(f)}}}}}return a};mxGraphHandler.prototype.createPreviewShape=function(b){var a=new mxRectangleShape(b,null,this.previewColor);a.isDashed=true;if(this.htmlPreview){a.dialect=mxConstants.DIALECT_STRICTHTML;a.init(this.graph.container)}else{a.dialect=(this.graph.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;a.init(this.graph.getView().getOverlayPane());a.pointerEvents=false;if(mxClient.IS_IOS){a.getSvgScreenOffset=function(){return 0}}}return a};mxGraphHandler.prototype.start=function(b,a,c){this.cell=b;this.first=mxUtils.convertPoint(this.graph.container,a,c);this.cells=this.getCells(this.cell);this.bounds=this.graph.getView().getBounds(this.cells);this.pBounds=this.getPreviewBounds(this.cells);if(this.guidesEnabled){this.guide=new mxGuide(this.graph,this.getGuideStates())}};mxGraphHandler.prototype.useGuidesForEvent=function(a){return(this.guide!=null)?this.guide.isEnabledForEvent(a.getEvent()):true};mxGraphHandler.prototype.snap=function(a){var b=(this.scaleGrid)?this.graph.view.scale:1;a.x=this.graph.snap(a.x/b)*b;a.y=this.graph.snap(a.y/b)*b;return a};mxGraphHandler.prototype.getDelta=function(c){var a=mxUtils.convertPoint(this.graph.container,c.getX(),c.getY());var b=this.graph.view.scale;return new mxPoint(this.roundLength((a.x-this.first.x)/b)*b,this.roundLength((a.y-this.first.y)/b)*b)};mxGraphHandler.prototype.updateHint=function(a){};mxGraphHandler.prototype.removeHint=function(){};mxGraphHandler.prototype.roundLength=function(a){return Math.round(a)};mxGraphHandler.prototype.mouseMove=function(c,t){var b=this.graph;if(!t.isConsumed()&&b.isMouseDown&&this.cell!=null&&this.first!=null&&this.bounds!=null){if(mxEvent.isMultiTouchEvent(t.getEvent())){this.reset();return}var q=this.getDelta(t);var i=q.x;var h=q.y;var l=b.tolerance;if(this.shape!=null||Math.abs(i)>l||Math.abs(h)>l){if(this.highlight==null){this.highlight=new mxCellHighlight(this.graph,mxConstants.DROP_TARGET_COLOR,3)}if(this.shape==null){this.shape=this.createPreviewShape(this.bounds)}var p=b.isGridEnabledEvent(t.getEvent());var k=true;if(this.guide!=null&&this.useGuidesForEvent(t)){q=this.guide.move(this.bounds,new mxPoint(i,h),p);k=false;i=q.x;h=q.y}else{if(p){var g=b.getView().translate;var w=b.getView().scale;var s=this.bounds.x-(b.snap(this.bounds.x/w-g.x)+g.x)*w;var r=this.bounds.y-(b.snap(this.bounds.y/w-g.y)+g.y)*w;var j=this.snap(new mxPoint(i,h));i=j.x-s;h=j.y-r}}if(this.guide!=null&&k){this.guide.hide()}if(b.isConstrainedEvent(t.getEvent())){if(Math.abs(i)>Math.abs(h)){h=0}else{i=0}}this.currentDx=i;this.currentDy=h;this.updatePreviewShape();var u=null;var a=t.getCell();var o=b.isCloneEvent(t.getEvent())&&b.isCellsCloneable()&&this.isCloneEnabled();if(b.isDropEnabled()&&this.highlightEnabled){u=b.getDropTarget(this.cells,t.getEvent(),a,o)}var f=b.getView().getState(u);var e=false;if(f!=null&&(b.model.getParent(this.cell)!=u||o)){if(this.target!=u){this.target=u;this.setHighlightColor(mxConstants.DROP_TARGET_COLOR)}e=true}else{this.target=null;if(this.connectOnDrop&&a!=null&&this.cells.length==1&&b.getModel().isVertex(a)&&b.isCellConnectable(a)){f=b.getView().getState(a);if(f!=null){var n=b.getEdgeValidationError(null,this.cell,a);var m=(n==null)?mxConstants.VALID_COLOR:mxConstants.INVALID_CONNECT_TARGET_COLOR;this.setHighlightColor(m);e=true}}}if(f!=null&&e){this.highlight.highlight(f)}else{this.highlight.hide()}}this.updateHint(t);this.consumeMouseEvent(mxEvent.MOUSE_MOVE,t);mxEvent.consume(t.getEvent())}else{if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!t.isConsumed()&&t.getState()!=null&&!b.isMouseDown){var d=b.getCursorForMouseEvent(t);if(d==null&&b.isEnabled()&&b.isCellMovable(t.getCell())){if(b.getModel().isEdge(t.getCell())){d=mxConstants.CURSOR_MOVABLE_EDGE}else{d=mxConstants.CURSOR_MOVABLE_VERTEX}}if(t.sourceState!=null){t.sourceState.setCursor(d)}}}};mxGraphHandler.prototype.updatePreviewShape=function(){if(this.shape!=null){this.shape.bounds=new mxRectangle(Math.round(this.pBounds.x+this.currentDx-this.graph.panDx),Math.round(this.pBounds.y+this.currentDy-this.graph.panDy),this.pBounds.width,this.pBounds.height);this.shape.redraw()}};mxGraphHandler.prototype.setHighlightColor=function(a){if(this.highlight!=null){this.highlight.setHighlightColor(a)}};mxGraphHandler.prototype.mouseUp=function(b,e){if(!e.isConsumed()){var g=this.graph;if(this.cell!=null&&this.first!=null&&this.shape!=null&&this.currentDx!=null&&this.currentDy!=null){var f=e.getCell();if(this.connectOnDrop&&this.target==null&&f!=null&&g.getModel().isVertex(f)&&g.isCellConnectable(f)&&g.isEdgeValid(null,this.cell,f)){g.connectionHandler.connect(this.cell,f,e.getEvent())}else{var d=g.isCloneEvent(e.getEvent())&&g.isCellsCloneable()&&this.isCloneEnabled();var a=g.getView().scale;var i=this.roundLength(this.currentDx/a);var h=this.roundLength(this.currentDy/a);var c=this.target;if(g.isSplitEnabled()&&g.isSplitTarget(c,this.cells,e.getEvent())){g.splitEdge(c,this.cells,null,i,h)}else{this.moveCells(this.cells,i,h,d,this.target,e.getEvent())}}}else{if(this.isSelectEnabled()&&this.delayedSelection&&this.cell!=null){this.selectDelayed(e)}}}if(this.cellWasClicked){this.consumeMouseEvent(mxEvent.MOUSE_UP,e)}this.reset()};mxGraphHandler.prototype.selectDelayed=function(a){if(!this.graph.isCellSelected(this.cell)||!this.graph.popupMenuHandler.isPopupTrigger(a)){this.graph.selectCellForEvent(this.cell,a.getEvent())}};mxGraphHandler.prototype.reset=function(){this.destroyShapes();this.removeHint();this.cellWasClicked=false;this.delayedSelection=false;this.currentDx=null;this.currentDy=null;this.guides=null;this.first=null;this.cell=null;this.target=null};mxGraphHandler.prototype.shouldRemoveCellsFromParent=function(e,h,f){if(this.graph.getModel().isVertex(e)){var a=this.graph.getView().getState(e);if(a!=null){var i=mxUtils.convertPoint(this.graph.container,mxEvent.getClientX(f),mxEvent.getClientY(f));var c=mxUtils.toRadians(mxUtils.getValue(a.style,mxConstants.STYLE_ROTATION)||0);if(c!=0){var g=Math.cos(-c);var d=Math.sin(-c);var b=new mxPoint(a.getCenterX(),a.getCenterY());i=mxUtils.getRotatedPoint(i,g,d,b)}return !mxUtils.contains(a,i.x,i.y)}}return false};mxGraphHandler.prototype.moveCells=function(d,c,b,f,e,a){if(f){d=this.graph.getCloneableCells(d)}if(e==null&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(this.graph.getModel().getParent(this.cell),d,a)){e=this.graph.getDefaultParent()}d=this.graph.moveCells(d,c-this.graph.panDx/this.graph.view.scale,b-this.graph.panDy/this.graph.view.scale,f,e,a);if(this.isSelectEnabled()&&this.scrollOnMove){this.graph.scrollCellToVisible(d[0])}if(f){this.graph.setSelectionCells(d)}};mxGraphHandler.prototype.destroyShapes=function(){if(this.shape!=null){this.shape.destroy();this.shape=null}if(this.guide!=null){this.guide.destroy();this.guide=null}if(this.highlight!=null){this.highlight.destroy();this.highlight=null}};mxGraphHandler.prototype.destroy=function(){this.graph.removeMouseListener(this);this.graph.removeListener(this.panHandler);if(this.escapeHandler!=null){this.graph.removeListener(this.escapeHandler);this.escapeHandler=null}this.destroyShapes();this.removeHint()};