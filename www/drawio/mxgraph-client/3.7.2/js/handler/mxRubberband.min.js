function mxRubberband(a){if(a!=null){this.graph=a;this.graph.addMouseListener(this);this.forceRubberbandHandler=mxUtils.bind(this,function(d,b){var f=b.getProperty("eventName");var e=b.getProperty("event");if(f==mxEvent.MOUSE_DOWN&&this.isForceRubberbandEvent(e)){var g=mxUtils.getOffset(this.graph.container);var c=mxUtils.getScrollOrigin(this.graph.container);c.x-=g.x;c.y-=g.y;this.start(e.getX()+c.x,e.getY()+c.y);e.consume(false)}});this.graph.addListener(mxEvent.FIRE_MOUSE_EVENT,this.forceRubberbandHandler);this.panHandler=mxUtils.bind(this,function(){this.repaint()});this.graph.addListener(mxEvent.PAN,this.panHandler);this.gestureHandler=mxUtils.bind(this,function(c,b){if(this.first!=null){this.reset()}});this.graph.addListener(mxEvent.GESTURE,this.gestureHandler);if(mxClient.IS_IE){mxEvent.addListener(window,"unload",mxUtils.bind(this,function(){this.destroy()}))}}}mxRubberband.prototype.defaultOpacity=20;mxRubberband.prototype.enabled=true;mxRubberband.prototype.div=null;mxRubberband.prototype.sharedDiv=null;mxRubberband.prototype.currentX=0;mxRubberband.prototype.currentY=0;mxRubberband.prototype.isEnabled=function(){return this.enabled};mxRubberband.prototype.setEnabled=function(a){this.enabled=a};mxRubberband.prototype.isForceRubberbandEvent=function(a){return mxEvent.isAltDown(a.getEvent())};mxRubberband.prototype.mouseDown=function(b,c){if(!c.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&c.getState()==null&&!mxEvent.isMultiTouchEvent(c.getEvent())){var d=mxUtils.getOffset(this.graph.container);var a=mxUtils.getScrollOrigin(this.graph.container);a.x-=d.x;a.y-=d.y;this.start(c.getX()+a.x,c.getY()+a.y);c.consume(false)}};mxRubberband.prototype.start=function(a,d){this.first=new mxPoint(a,d);var b=this.graph.container;function c(e){var f=new mxMouseEvent(e);var g=mxUtils.convertPoint(b,f.getX(),f.getY());f.graphX=g.x;f.graphY=g.y;return f}this.dragHandler=mxUtils.bind(this,function(e){this.mouseMove(this.graph,c(e))});this.dropHandler=mxUtils.bind(this,function(e){this.mouseUp(this.graph,c(e))});if(mxClient.IS_FF){mxEvent.addGestureListeners(document,null,this.dragHandler,this.dropHandler)}};mxRubberband.prototype.mouseMove=function(b,c){if(!c.isConsumed()&&this.first!=null){var f=mxUtils.getScrollOrigin(this.graph.container);var a=mxUtils.getOffset(this.graph.container);f.x-=a.x;f.y-=a.y;var e=c.getX()+f.x;var d=c.getY()+f.y;var i=this.first.x-e;var h=this.first.y-d;var g=this.graph.tolerance;if(this.div!=null||Math.abs(i)>g||Math.abs(h)>g){if(this.div==null){this.div=this.createShape()}mxUtils.clearSelection();this.update(e,d);c.consume()}}};mxRubberband.prototype.createShape=function(){if(this.sharedDiv==null){this.sharedDiv=document.createElement("div");this.sharedDiv.className="mxRubberband";mxUtils.setOpacity(this.sharedDiv,this.defaultOpacity)}this.graph.container.appendChild(this.sharedDiv);return this.sharedDiv};mxRubberband.prototype.isActive=function(a,b){return this.div!=null&&this.div.style.display!="none"};mxRubberband.prototype.mouseUp=function(a,b){var c=this.isActive();this.reset();if(c){this.execute(b.getEvent());b.consume()}};mxRubberband.prototype.execute=function(a){var b=new mxRectangle(this.x,this.y,this.width,this.height);this.graph.selectRegion(b,a)};mxRubberband.prototype.reset=function(){if(this.div!=null){this.div.parentNode.removeChild(this.div)}mxEvent.removeGestureListeners(document,null,this.dragHandler,this.dropHandler);this.dragHandler=null;this.dropHandler=null;this.currentX=0;this.currentY=0;this.first=null;this.div=null};mxRubberband.prototype.update=function(a,b){this.currentX=a;this.currentY=b;this.repaint()};mxRubberband.prototype.repaint=function(){if(this.div!=null){var a=this.currentX-this.graph.panDx;var d=this.currentY-this.graph.panDy;this.x=Math.min(this.first.x,a);this.y=Math.min(this.first.y,d);this.width=Math.max(this.first.x,a)-this.x;this.height=Math.max(this.first.y,d)-this.y;var c=(mxClient.IS_VML)?this.graph.panDx:0;var b=(mxClient.IS_VML)?this.graph.panDy:0;this.div.style.left=(this.x+c)+"px";this.div.style.top=(this.y+b)+"px";this.div.style.width=Math.max(1,this.width)+"px";this.div.style.height=Math.max(1,this.height)+"px"}};mxRubberband.prototype.destroy=function(){if(!this.destroyed){this.destroyed=true;this.graph.removeMouseListener(this);this.graph.removeListener(this.forceRubberbandHandler);this.graph.removeListener(this.panHandler);this.reset();if(this.sharedDiv!=null){this.sharedDiv=null}}};