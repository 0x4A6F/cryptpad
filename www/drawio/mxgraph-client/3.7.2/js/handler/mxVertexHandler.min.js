function mxVertexHandler(a){if(a!=null){this.state=a;this.init();this.escapeHandler=mxUtils.bind(this,function(c,b){if(this.livePreview&&this.index!=null){this.state.view.graph.cellRenderer.redraw(this.state,true);this.state.view.invalidate(this.state.cell);this.state.invalid=false;this.state.view.validate()}this.reset()});this.state.view.graph.addListener(mxEvent.ESCAPE,this.escapeHandler)}}mxVertexHandler.prototype.graph=null;mxVertexHandler.prototype.state=null;mxVertexHandler.prototype.singleSizer=false;mxVertexHandler.prototype.index=null;mxVertexHandler.prototype.allowHandleBoundsCheck=true;mxVertexHandler.prototype.handleImage=null;mxVertexHandler.prototype.tolerance=0;mxVertexHandler.prototype.rotationEnabled=false;mxVertexHandler.prototype.parentHighlightEnabled=false;mxVertexHandler.prototype.rotationRaster=true;mxVertexHandler.prototype.rotationCursor="crosshair";mxVertexHandler.prototype.livePreview=false;mxVertexHandler.prototype.manageSizers=false;mxVertexHandler.prototype.constrainGroupByChildren=false;mxVertexHandler.prototype.rotationHandleVSpacing=-16;mxVertexHandler.prototype.horizontalOffset=0;mxVertexHandler.prototype.verticalOffset=0;mxVertexHandler.prototype.init=function(){this.graph=this.state.view.graph;this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.selectionBorder=this.createSelectionShape(this.bounds);this.selectionBorder.dialect=(this.graph.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.selectionBorder.pointerEvents=false;this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0");this.selectionBorder.init(this.graph.getView().getOverlayPane());mxEvent.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state);if(this.graph.isCellMovable(this.state.cell)){this.selectionBorder.setCursor(mxConstants.CURSOR_MOVABLE_VERTEX)}if(mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells){var b=this.graph.isCellResizable(this.state.cell);this.sizers=[];if(b||(this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2)){var a=0;if(b){if(!this.singleSizer){this.sizers.push(this.createSizer("nw-resize",a++));this.sizers.push(this.createSizer("n-resize",a++));this.sizers.push(this.createSizer("ne-resize",a++));this.sizers.push(this.createSizer("w-resize",a++));this.sizers.push(this.createSizer("e-resize",a++));this.sizers.push(this.createSizer("sw-resize",a++));this.sizers.push(this.createSizer("s-resize",a++))}this.sizers.push(this.createSizer("se-resize",a++))}var c=this.graph.model.getGeometry(this.state.cell);if(c!=null&&!c.relative&&!this.graph.isSwimlane(this.state.cell)&&this.graph.isLabelMovable(this.state.cell)){this.labelShape=this.createSizer(mxConstants.CURSOR_LABEL_HANDLE,mxEvent.LABEL_HANDLE,mxConstants.LABEL_HANDLE_SIZE,mxConstants.LABEL_HANDLE_FILLCOLOR);this.sizers.push(this.labelShape)}}else{if(this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2){this.labelShape=this.createSizer(mxConstants.CURSOR_MOVABLE_VERTEX,mxEvent.LABEL_HANDLE,null,mxConstants.LABEL_HANDLE_FILLCOLOR);this.sizers.push(this.labelShape)}}}if(this.isRotationHandleVisible()){this.rotationShape=this.createSizer(this.rotationCursor,mxEvent.ROTATION_HANDLE,mxConstants.HANDLE_SIZE+3,mxConstants.HANDLE_FILLCOLOR);this.sizers.push(this.rotationShape)}this.customHandles=this.createCustomHandles();this.redraw();if(this.constrainGroupByChildren){this.updateMinBounds()}};mxVertexHandler.prototype.isRotationHandleVisible=function(){return this.graph.isEnabled()&&this.rotationEnabled&&this.graph.isCellRotatable(this.state.cell)&&(mxGraphHandler.prototype.maxCells<=0||this.graph.getSelectionCount()<mxGraphHandler.prototype.maxCells)&&this.state.width>=2&&this.state.height>=2};mxVertexHandler.prototype.isConstrainedEvent=function(a){return mxEvent.isShiftDown(a.getEvent())||this.state.style[mxConstants.STYLE_ASPECT]=="fixed"};mxVertexHandler.prototype.isCenteredEvent=function(b,a){return false};mxVertexHandler.prototype.createCustomHandles=function(){return null};mxVertexHandler.prototype.updateMinBounds=function(){var b=this.graph.getChildCells(this.state.cell);if(b.length>0){this.minBounds=this.graph.view.getBounds(b);if(this.minBounds!=null){var c=this.state.view.scale;var a=this.state.view.translate;this.minBounds.x-=this.state.x;this.minBounds.y-=this.state.y;this.minBounds.x/=c;this.minBounds.y/=c;this.minBounds.width/=c;this.minBounds.height/=c;this.x0=this.state.x/c-a.x;this.y0=this.state.y/c-a.y}}};mxVertexHandler.prototype.getSelectionBounds=function(a){return new mxRectangle(Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height))};mxVertexHandler.prototype.createParentHighlightShape=function(a){return this.createSelectionShape(a)};mxVertexHandler.prototype.createSelectionShape=function(b){var a=new mxRectangleShape(b,null,this.getSelectionColor());a.strokewidth=this.getSelectionStrokeWidth();a.isDashed=this.isSelectionDashed();return a};mxVertexHandler.prototype.getSelectionColor=function(){return mxConstants.VERTEX_SELECTION_COLOR};mxVertexHandler.prototype.getSelectionStrokeWidth=function(){return mxConstants.VERTEX_SELECTION_STROKEWIDTH};mxVertexHandler.prototype.isSelectionDashed=function(){return mxConstants.VERTEX_SELECTION_DASHED};mxVertexHandler.prototype.createSizer=function(e,a,b,f){b=b||mxConstants.HANDLE_SIZE;var c=new mxRectangle(0,0,b,b);var d=this.createSizerShape(c,a,f);if(d.isHtmlAllowed()&&this.state.text!=null&&this.state.text.node.parentNode==this.graph.container){d.bounds.height-=1;d.bounds.width-=1;d.dialect=mxConstants.DIALECT_STRICTHTML;d.init(this.graph.container)}else{d.dialect=(this.graph.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;d.init(this.graph.getView().getOverlayPane())}mxEvent.redirectMouseEvents(d.node,this.graph,this.state);if(this.graph.isEnabled()){d.setCursor(e)}if(!this.isSizerVisible(a)){d.visible=false}return d};mxVertexHandler.prototype.isSizerVisible=function(a){return true};mxVertexHandler.prototype.createSizerShape=function(c,b,d){if(this.handleImage!=null){c=new mxRectangle(c.x,c.y,this.handleImage.width,this.handleImage.height);var a=new mxImageShape(c,this.handleImage.src);a.preserveImageAspect=false;return a}else{if(b==mxEvent.ROTATION_HANDLE){return new mxEllipse(c,d||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)}else{return new mxRectangleShape(c,d||mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)}}};mxVertexHandler.prototype.moveSizerTo=function(b,a,c){if(b!=null){b.bounds.x=Math.floor(a-b.bounds.width/2);b.bounds.y=Math.floor(c-b.bounds.height/2);if(b.node!=null&&b.node.style.display!="none"){b.redraw()}}};mxVertexHandler.prototype.getHandleForEvent=function(d){var b=(!mxEvent.isMouseEvent(d.getEvent()))?this.tolerance:1;var e=(this.allowHandleBoundsCheck&&(mxClient.IS_IE||b>0))?new mxRectangle(d.getGraphX()-b,d.getGraphY()-b,2*b,2*b):null;function a(f){return f!=null&&(d.isSource(f)||(e!=null&&mxUtils.intersects(f.bounds,e)&&f.node.style.display!="none"&&f.node.style.visibility!="hidden"))}if(this.customHandles!=null&&this.isCustomHandleEvent(d)){for(var c=this.customHandles.length-1;c>=0;c--){if(a(this.customHandles[c].shape)){return mxEvent.CUSTOM_HANDLE-c}}}if(a(this.rotationShape)){return mxEvent.ROTATION_HANDLE}else{if(a(this.labelShape)){return mxEvent.LABEL_HANDLE}}if(this.sizers!=null){for(var c=0;c<this.sizers.length;c++){if(a(this.sizers[c])){return c}}}return null};mxVertexHandler.prototype.isCustomHandleEvent=function(a){return true};mxVertexHandler.prototype.mouseDown=function(b,c){var a=(!mxEvent.isMouseEvent(c.getEvent()))?this.tolerance:0;if(!c.isConsumed()&&this.graph.isEnabled()&&(a>0||c.getState()==this.state)){var d=this.getHandleForEvent(c);if(d!=null){this.start(c.getGraphX(),c.getGraphY(),d);c.consume()}}};mxVertexHandler.prototype.isLivePreviewBorder=function(){return this.state.shape!=null&&this.state.shape.fill==null&&this.state.shape.stroke==null};mxVertexHandler.prototype.start=function(a,h,d){this.inTolerance=true;this.childOffsetX=0;this.childOffsetY=0;this.index=d;this.startX=a;this.startY=h;var c=this.state.view.graph.model;var g=c.getParent(this.state.cell);if(this.state.view.currentRoot!=g&&(c.isVertex(g)||c.isEdge(g))){this.parentState=this.state.view.graph.view.getState(g)}this.selectionBorder.node.style.display=(d==mxEvent.ROTATION_HANDLE)?"inline":"none";if(!this.livePreview||this.isLivePreviewBorder()){this.preview=this.createSelectionShape(this.bounds);if(!(mxClient.IS_SVG&&Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")!=0)&&this.state.text!=null&&this.state.text.node.parentNode==this.graph.container){this.preview.dialect=mxConstants.DIALECT_STRICTHTML;this.preview.init(this.graph.container)}else{this.preview.dialect=(this.graph.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.preview.init(this.graph.view.getOverlayPane())}}if(this.livePreview){this.hideSizers();if(d==mxEvent.ROTATION_HANDLE){this.rotationShape.node.style.display=""}else{if(d==mxEvent.LABEL_HANDLE){this.labelShape.node.style.display=""}else{if(this.sizers!=null&&this.sizers[d]!=null){this.sizers[d].node.style.display=""}else{if(d<=mxEvent.CUSTOM_HANDLE&&this.customHandles!=null){this.customHandles[mxEvent.CUSTOM_HANDLE-d].setVisible(true)}}}}var b=this.graph.getEdges(this.state.cell);this.edgeHandlers=[];for(var e=0;e<b.length;e++){var f=this.graph.selectionCellsHandler.getHandler(b[e]);if(f!=null){this.edgeHandlers.push(f)}}}};mxVertexHandler.prototype.setHandlesVisible=function(b){if(this.sizers!=null){for(var a=0;a<this.sizers.length;a++){this.sizers[a].node.style.display=(b)?"":"none"}}if(this.customHandles!=null){for(var a=0;a<this.customHandles.length;a++){this.customHandles[a].setVisible(b)}}};mxVertexHandler.prototype.hideSizers=function(){this.setHandlesVisible(false)};mxVertexHandler.prototype.checkTolerance=function(a){if(this.inTolerance&&this.startX!=null&&this.startY!=null){if(mxEvent.isMouseEvent(a.getEvent())||Math.abs(a.getGraphX()-this.startX)>this.graph.tolerance||Math.abs(a.getGraphY()-this.startY)>this.graph.tolerance){this.inTolerance=false}}};mxVertexHandler.prototype.updateHint=function(a){};mxVertexHandler.prototype.removeHint=function(){};mxVertexHandler.prototype.roundAngle=function(a){return Math.round(a*10)/10};mxVertexHandler.prototype.roundLength=function(a){return Math.round(a)};mxVertexHandler.prototype.mouseMove=function(a,b){if(!b.isConsumed()&&this.index!=null){this.checkTolerance(b);if(!this.inTolerance){if(this.index<=mxEvent.CUSTOM_HANDLE){if(this.customHandles!=null){this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].processEvent(b)}}else{if(this.index==mxEvent.LABEL_HANDLE){this.moveLabel(b)}else{if(this.index==mxEvent.ROTATION_HANDLE){this.rotateVertex(b)}else{this.resizeVertex(b)}}}this.updateHint(b)}b.consume()}else{if(!this.graph.isMouseDown&&this.getHandleForEvent(b)!=null){b.consume(false)}}};mxVertexHandler.prototype.moveLabel=function(c){var a=new mxPoint(c.getGraphX(),c.getGraphY());var d=this.graph.view.translate;var e=this.graph.view.scale;if(this.graph.isGridEnabledEvent(c.getEvent())){a.x=(this.graph.snap(a.x/e-d.x)+d.x)*e;a.y=(this.graph.snap(a.y/e-d.y)+d.y)*e}var b=(this.rotationShape!=null)?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[b],a.x,a.y)};mxVertexHandler.prototype.rotateVertex=function(e){var a=new mxPoint(e.getGraphX(),e.getGraphY());var d=this.state.x+this.state.width/2-a.x;var c=this.state.y+this.state.height/2-a.y;this.currentAlpha=(d!=0)?Math.atan(c/d)*180/Math.PI+90:((c<0)?180:0);if(d>0){this.currentAlpha-=180}if(this.rotationRaster&&this.graph.isGridEnabledEvent(e.getEvent())){var d=a.x-this.state.getCenterX();var c=a.y-this.state.getCenterY();var f=Math.abs(Math.sqrt(d*d+c*c)-20)*3;var b=Math.max(1,5*Math.min(3,Math.max(0,Math.round(80/Math.abs(f)))));this.currentAlpha=Math.round(this.currentAlpha/b)*b}else{this.currentAlpha=this.roundAngle(this.currentAlpha)}this.selectionBorder.rotation=this.currentAlpha;this.selectionBorder.redraw();if(this.livePreview){this.redrawHandles()}};mxVertexHandler.prototype.resizeVertex=function(w){var i=new mxPoint(this.state.getCenterX(),this.state.getCenterY());var j=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0");var r=new mxPoint(w.getGraphX(),w.getGraphY());var e=this.graph.view.translate;var x=this.graph.view.scale;var h=Math.cos(-j);var b=Math.sin(-j);var p=r.x-this.startX;var o=r.y-this.startY;var v=h*p-b*o;var u=b*p+h*o;p=v;o=u;var y=this.graph.getCellGeometry(this.state.cell);this.unscaledBounds=this.union(y,p/x,o/x,this.index,this.graph.isGridEnabledEvent(w.getEvent()),1,new mxPoint(0,0),this.isConstrainedEvent(w),this.isCenteredEvent(this.state,w));if(!y.relative){var s=this.graph.getMaximumGraphBounds();if(s!=null&&this.parentState!=null){s=mxRectangle.fromRectangle(s);s.x-=(this.parentState.x-e.x*x)/x;s.y-=(this.parentState.y-e.y*x)/x}if(this.graph.isConstrainChild(this.state.cell)){var t=this.graph.getCellContainmentArea(this.state.cell);if(t!=null){var a=this.graph.getOverlap(this.state.cell);if(a>0){t=mxRectangle.fromRectangle(t);t.x-=t.width*a;t.y-=t.height*a;t.width+=2*t.width*a;t.height+=2*t.height*a}if(s==null){s=t}else{s=mxRectangle.fromRectangle(s);s.intersect(t)}}}if(s!=null){if(this.unscaledBounds.x<s.x){this.unscaledBounds.width-=s.x-this.unscaledBounds.x;this.unscaledBounds.x=s.x}if(this.unscaledBounds.y<s.y){this.unscaledBounds.height-=s.y-this.unscaledBounds.y;this.unscaledBounds.y=s.y}if(this.unscaledBounds.x+this.unscaledBounds.width>s.x+s.width){this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-s.x-s.width}if(this.unscaledBounds.y+this.unscaledBounds.height>s.y+s.height){this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-s.y-s.height}}}this.bounds=new mxRectangle(((this.parentState!=null)?this.parentState.x:e.x*x)+(this.unscaledBounds.x)*x,((this.parentState!=null)?this.parentState.y:e.y*x)+(this.unscaledBounds.y)*x,this.unscaledBounds.width*x,this.unscaledBounds.height*x);if(y.relative&&this.parentState!=null){this.bounds.x+=this.state.x-this.parentState.x;this.bounds.y+=this.state.y-this.parentState.y}h=Math.cos(j);b=Math.sin(j);var q=new mxPoint(this.bounds.getCenterX(),this.bounds.getCenterY());var p=q.x-i.x;var o=q.y-i.y;var g=h*p-b*o;var n=b*p+h*o;var f=g-p;var m=n-o;var d=this.bounds.x-this.state.x;var l=this.bounds.y-this.state.y;var c=h*d-b*l;var k=b*d+h*l;this.bounds.x+=f;this.bounds.y+=m;this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+f/x);this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+m/x);this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width);this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height);if(!this.graph.isCellCollapsed(this.state.cell)&&(f!=0||m!=0)){this.childOffsetX=this.state.x-this.bounds.x+c;this.childOffsetY=this.state.y-this.bounds.y+k}else{this.childOffsetX=0;this.childOffsetY=0}if(this.livePreview){this.updateLivePreview(w)}if(this.preview!=null){this.drawPreview()}};mxVertexHandler.prototype.updateLivePreview=function(b){var g=this.graph.view.scale;var c=this.graph.view.translate;var a=this.state.clone();this.state.x=this.bounds.x;this.state.y=this.bounds.y;this.state.origin=new mxPoint(this.state.x/g-c.x,this.state.y/g-c.y);this.state.width=this.bounds.width;this.state.height=this.bounds.height;this.state.unscaledWidth=null;var f=this.state.absoluteOffset;f=new mxPoint(f.x,f.y);this.state.absoluteOffset.x=0;this.state.absoluteOffset.y=0;var d=this.graph.getCellGeometry(this.state.cell);if(d!=null){var e=d.offset||this.EMPTY_POINT;if(e!=null&&!d.relative){this.state.absoluteOffset.x=this.state.view.scale*e.x;this.state.absoluteOffset.y=this.state.view.scale*e.y}this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,true);this.state.view.invalidate(this.state.cell);this.state.invalid=false;this.state.view.validate();this.redrawHandles();this.state.setState(a)};mxVertexHandler.prototype.mouseUp=function(e,g){if(this.index!=null&&this.state!=null){var i=new mxPoint(g.getGraphX(),g.getGraphY());this.graph.getModel().beginUpdate();try{if(this.index<=mxEvent.CUSTOM_HANDLE){if(this.customHandles!=null){this.customHandles[mxEvent.CUSTOM_HANDLE-this.index].execute()}}else{if(this.index==mxEvent.ROTATION_HANDLE){if(this.currentAlpha!=null){var j=this.currentAlpha-(this.state.style[mxConstants.STYLE_ROTATION]||0);if(j!=0){this.rotateCell(this.state.cell,j)}}else{this.rotateClick()}}else{var f=this.graph.isGridEnabledEvent(g.getEvent());var b=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0");var k=Math.cos(-b);var h=Math.sin(-b);var n=i.x-this.startX;var l=i.y-this.startY;var d=k*n-h*l;var c=h*n+k*l;n=d;l=c;var m=this.graph.view.scale;var a=this.isRecursiveResize(this.state,g);this.resizeCell(this.state.cell,this.roundLength(n/m),this.roundLength(l/m),this.index,f,this.isConstrainedEvent(g),a)}}}finally{this.graph.getModel().endUpdate()}g.consume();this.reset()}};mxVertexHandler.prototype.isRecursiveResize=function(b,a){return this.graph.isRecursiveResize(this.state)};mxVertexHandler.prototype.rotateClick=function(){};mxVertexHandler.prototype.rotateCell=function(l,d,k){if(d!=0){var h=this.graph.getModel();if(h.isVertex(l)||h.isEdge(l)){if(!h.isEdge(l)){var a=this.graph.view.getState(l);var b=(a!=null)?a.style:this.graph.getCellStyle(l);if(b!=null){var j=(b[mxConstants.STYLE_ROTATION]||0)+d;this.graph.setCellStyles(mxConstants.STYLE_ROTATION,j,[l])}}var g=this.graph.getCellGeometry(l);if(g!=null){var c=this.graph.getCellGeometry(k);if(c!=null&&!h.isEdge(k)){g=g.clone();g.rotate(d,new mxPoint(c.width/2,c.height/2));h.setGeometry(l,g)}if((h.isVertex(l)&&!g.relative)||h.isEdge(l)){var e=h.getChildCount(l);for(var f=0;f<e;f++){this.rotateCell(h.getChildAt(l,f),d,l)}}}}}};mxVertexHandler.prototype.reset=function(){if(this.sizers!=null&&this.index!=null&&this.sizers[this.index]!=null&&this.sizers[this.index].node.style.display=="none"){this.sizers[this.index].node.style.display=""}this.currentAlpha=null;this.inTolerance=null;this.index=null;if(this.preview!=null){this.preview.destroy();this.preview=null}if(this.livePreview&&this.sizers!=null){for(var a=0;a<this.sizers.length;a++){if(this.sizers[a]!=null){this.sizers[a].node.style.display=""}}}if(this.customHandles!=null){for(var a=0;a<this.customHandles.length;a++){this.customHandles[a].reset()}}if(this.selectionBorder!=null){this.selectionBorder.node.style.display="inline";this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.drawPreview()}this.removeHint();this.redrawHandles();this.edgeHandlers=null;this.unscaledBounds=null};mxVertexHandler.prototype.resizeCell=function(g,i,h,e,f,b,a){var d=this.graph.model.getGeometry(g);if(d!=null){if(e==mxEvent.LABEL_HANDLE){var c=this.graph.view.scale;i=Math.round((this.labelShape.bounds.getCenterX()-this.startX)/c);h=Math.round((this.labelShape.bounds.getCenterY()-this.startY)/c);d=d.clone();if(d.offset==null){d.offset=new mxPoint(i,h)}else{d.offset.x+=i;d.offset.y+=h}this.graph.model.setGeometry(g,d)}else{if(this.unscaledBounds!=null){var c=this.graph.view.scale;if(this.childOffsetX!=0||this.childOffsetY!=0){this.moveChildren(g,Math.round(this.childOffsetX/c),Math.round(this.childOffsetY/c))}this.graph.resizeCell(g,this.unscaledBounds,a)}}}};mxVertexHandler.prototype.moveChildren=function(a,d,b){var e=this.graph.getModel();var c=e.getChildCount(a);for(var f=0;f<c;f++){var h=e.getChildAt(a,f);var g=this.graph.getCellGeometry(h);if(g!=null){g=g.clone();g.translate(d,b);e.setGeometry(h,g)}}};mxVertexHandler.prototype.union=function(i,p,o,h,w,B,a,A,v){if(this.singleSizer){var m=i.x+i.width+p;var l=i.y+i.height+o;if(w){m=this.graph.snap(m/B)*B;l=this.graph.snap(l/B)*B}var b=new mxRectangle(i.x,i.y,0,0);b.add(new mxRectangle(m,l,0,0));return b}else{var q=i.width;var k=i.height;var e=i.x-a.x*B;var z=e+q;var s=i.y-a.y*B;var j=s+k;var d=e+q/2;var c=s+k/2;if(h>4){j=j+o;if(w){j=this.graph.snap(j/B)*B}}else{if(h<3){s=s+o;if(w){s=this.graph.snap(s/B)*B}}}if(h==0||h==3||h==5){e+=p;if(w){e=this.graph.snap(e/B)*B}}else{if(h==2||h==4||h==7){z+=p;if(w){z=this.graph.snap(z/B)*B}}}var u=z-e;var t=j-s;if(A){var C=this.graph.getCellGeometry(this.state.cell);if(C!=null){var r=C.width/C.height;if(h==1||h==2||h==7||h==6){u=t*r}else{t=u/r}if(h==0){e=z-u;s=j-t}}}if(v){u+=(u-q);t+=(t-k);var g=d-(e+u/2);var f=c-(s+t/2);e+=g;s+=f;z+=g;j+=f}if(u<0){e+=u;u=Math.abs(u)}if(t<0){s+=t;t=Math.abs(t)}var n=new mxRectangle(e+a.x*B,s+a.y*B,u,t);if(this.minBounds!=null){n.width=Math.max(n.width,this.minBounds.x*B+this.minBounds.width*B+Math.max(0,this.x0*B-n.x));n.height=Math.max(n.height,this.minBounds.y*B+this.minBounds.height*B+Math.max(0,this.y0*B-n.y))}return n}};mxVertexHandler.prototype.redraw=function(){this.selectionBounds=this.getSelectionBounds(this.state);this.bounds=new mxRectangle(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height);this.redrawHandles();this.drawPreview()};mxVertexHandler.prototype.getHandlePadding=function(){var a=new mxPoint(0,0);var b=this.tolerance;if(this.sizers!=null&&this.sizers.length>0&&this.sizers[0]!=null&&(this.bounds.width<2*this.sizers[0].bounds.width+2*b||this.bounds.height<2*this.sizers[0].bounds.height+2*b)){b/=2;a.x=this.sizers[0].bounds.width+b;a.y=this.sizers[0].bounds.height+b}return a};mxVertexHandler.prototype.redrawHandles=function(){var n=this.tolerance;this.horizontalOffset=0;this.verticalOffset=0;var q=this.bounds;if(this.sizers!=null&&this.sizers.length>0&&this.sizers[0]!=null){if(this.index==null&&this.manageSizers&&this.sizers.length>=8){var k=this.getHandlePadding();this.horizontalOffset=k.x;this.verticalOffset=k.y;if(this.horizontalOffset!=0||this.verticalOffset!=0){q=new mxRectangle(q.x,q.y,q.width,q.height);q.x-=this.horizontalOffset/2;q.width+=this.horizontalOffset;q.y-=this.verticalOffset/2;q.height+=this.verticalOffset}if(this.sizers.length>=8){if((q.width<2*this.sizers[0].bounds.width+2*n)||(q.height<2*this.sizers[0].bounds.height+2*n)){this.sizers[0].node.style.display="none";this.sizers[2].node.style.display="none";this.sizers[5].node.style.display="none";this.sizers[7].node.style.display="none"}else{this.sizers[0].node.style.display="";this.sizers[2].node.style.display="";this.sizers[5].node.style.display="";this.sizers[7].node.style.display=""}}}var a=q.x+q.width;var j=q.y+q.height;if(this.singleSizer){this.moveSizerTo(this.sizers[0],a,j)}else{var e=q.x+q.width/2;var c=q.y+q.height/2;if(this.sizers.length>=8){var l=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"];var d=mxUtils.toRadians(this.state.style[mxConstants.STYLE_ROTATION]||"0");var m=Math.cos(d);var h=Math.sin(d);var p=Math.round(d*4/Math.PI);var g=new mxPoint(q.getCenterX(),q.getCenterY());var o=mxUtils.getRotatedPoint(new mxPoint(q.x,q.y),m,h,g);this.moveSizerTo(this.sizers[0],o.x,o.y);this.sizers[0].setCursor(l[mxUtils.mod(0+p,l.length)]);o.x=e;o.y=q.y;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[1],o.x,o.y);this.sizers[1].setCursor(l[mxUtils.mod(1+p,l.length)]);o.x=a;o.y=q.y;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[2],o.x,o.y);this.sizers[2].setCursor(l[mxUtils.mod(2+p,l.length)]);o.x=q.x;o.y=c;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[3],o.x,o.y);this.sizers[3].setCursor(l[mxUtils.mod(7+p,l.length)]);o.x=a;o.y=c;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[4],o.x,o.y);this.sizers[4].setCursor(l[mxUtils.mod(3+p,l.length)]);o.x=q.x;o.y=j;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[5],o.x,o.y);this.sizers[5].setCursor(l[mxUtils.mod(6+p,l.length)]);o.x=e;o.y=j;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[6],o.x,o.y);this.sizers[6].setCursor(l[mxUtils.mod(5+p,l.length)]);o.x=a;o.y=j;o=mxUtils.getRotatedPoint(o,m,h,g);this.moveSizerTo(this.sizers[7],o.x,o.y);this.sizers[7].setCursor(l[mxUtils.mod(4+p,l.length)]);this.moveSizerTo(this.sizers[8],e+this.state.absoluteOffset.x,c+this.state.absoluteOffset.y)}else{if(this.state.width>=2&&this.state.height>=2){this.moveSizerTo(this.sizers[0],e+this.state.absoluteOffset.x,c+this.state.absoluteOffset.y)}else{this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}}}if(this.rotationShape!=null){var d=mxUtils.toRadians((this.currentAlpha!=null)?this.currentAlpha:this.state.style[mxConstants.STYLE_ROTATION]||"0");var m=Math.cos(d);var h=Math.sin(d);var g=new mxPoint(this.state.getCenterX(),this.state.getCenterY());var o=mxUtils.getRotatedPoint(new mxPoint(q.x+q.width/2,q.y+this.rotationHandleVSpacing),m,h,g);if(this.rotationShape.node!=null){this.moveSizerTo(this.rotationShape,o.x,o.y)}}if(this.selectionBorder!=null){this.selectionBorder.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0")}if(this.edgeHandlers!=null){for(var f=0;f<this.edgeHandlers.length;f++){this.edgeHandlers[f].redraw()}}if(this.customHandles!=null){for(var f=0;f<this.customHandles.length;f++){this.customHandles[f].redraw()}}this.updateParentHighlight()};mxVertexHandler.prototype.updateParentHighlight=function(){if(this.selectionBorder!=null){if(this.parentHighlight!=null){var c=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(c)){var d=this.graph.view.getState(c);var a=this.parentHighlight.bounds;if(d!=null&&(a.x!=d.x||a.y!=d.y||a.width!=d.width||a.height!=d.height)){this.parentHighlight.bounds=d;this.parentHighlight.redraw()}}else{this.parentHighlight.destroy();this.parentHighlight=null}}else{if(this.parentHighlightEnabled){var c=this.graph.model.getParent(this.state.cell);if(this.graph.model.isVertex(c)){var d=this.graph.view.getState(c);if(d!=null){this.parentHighlight=this.createParentHighlightShape(d);this.parentHighlight.dialect=(this.graph.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_VML:mxConstants.DIALECT_SVG;this.parentHighlight.pointerEvents=false;this.parentHighlight.rotation=Number(d.style[mxConstants.STYLE_ROTATION]||"0");this.parentHighlight.init(this.graph.getView().getOverlayPane())}}}}}};mxVertexHandler.prototype.drawPreview=function(){if(this.preview!=null){this.preview.bounds=this.bounds;if(this.preview.node.parentNode==this.graph.container){this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1);this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)}this.preview.rotation=Number(this.state.style[mxConstants.STYLE_ROTATION]||"0");this.preview.redraw()}this.selectionBorder.bounds=this.bounds;this.selectionBorder.redraw();if(this.parentHighlight!=null){this.parentHighlight.redraw()}};mxVertexHandler.prototype.destroy=function(){if(this.escapeHandler!=null){this.state.view.graph.removeListener(this.escapeHandler);this.escapeHandler=null}if(this.preview!=null){this.preview.destroy();this.preview=null}if(this.parentHighlight!=null){this.parentHighlight.destroy();this.parentHighlight=null}if(this.selectionBorder!=null){this.selectionBorder.destroy();this.selectionBorder=null}this.labelShape=null;this.removeHint();if(this.sizers!=null){for(var a=0;a<this.sizers.length;a++){this.sizers[a].destroy()}this.sizers=null}if(this.customHandles!=null){for(var a=0;a<this.customHandles.length;a++){this.customHandles[a].destroy()}this.customHandles=null}};