function mxEdgeSegmentHandler(a){mxEdgeHandler.call(this,a)}mxUtils.extend(mxEdgeSegmentHandler,mxElbowEdgeHandler);mxEdgeSegmentHandler.prototype.getCurrentPoints=function(){var b=this.state.absolutePoints;if(b!=null){if(b.length==2||(b.length==3&&(b[0].x==b[1].x&&b[1].x==b[2].x||b[0].y==b[1].y&&b[1].y==b[2].y))){var a=b[0].x+(b[b.length-1].x-b[0].x)/2;var c=b[0].y+(b[b.length-1].y-b[0].y)/2;b=[b[0],new mxPoint(a,c),new mxPoint(a,c),b[b.length-1]]}}return b};mxEdgeSegmentHandler.prototype.getPreviewPoints=function(h){if(this.isSource||this.isTarget){return mxElbowEdgeHandler.prototype.getPreviewPoints.apply(this,arguments)}else{var k=this.getCurrentPoints();var j=this.convertPoint(k[0].clone(),false);h=this.convertPoint(h.clone(),false);var m=[];for(var c=1;c<k.length;c++){var l=this.convertPoint(k[c].clone(),false);if(c==this.index){if(Math.round(j.x-l.x)==0){j.x=h.x;l.x=h.x}if(Math.round(j.y-l.y)==0){j.y=h.y;l.y=h.y}}if(c<k.length-1){m.push(l)}j=l}if(m.length==1){var a=this.state.getVisibleTerminalState(true);var d=this.state.getVisibleTerminalState(false);var b=this.state.view.getScale();var e=this.state.view.getTranslate();var g=m[0].x*b+e.x;var f=m[0].y*b+e.y;if((a!=null&&mxUtils.contains(a,g,f))||(d!=null&&mxUtils.contains(d,g,f))){m=[h,h]}}return m}};mxEdgeSegmentHandler.prototype.updatePreviewState=function(e,p,f,r){mxEdgeHandler.prototype.updatePreviewState.apply(this,arguments);if(!this.isSource&&!this.isTarget){p=this.convertPoint(p.clone(),false);var v=e.absolutePoints;var k=v[0];var j=v[1];var l=[];for(var q=2;q<v.length;q++){var h=v[q];if((Math.round(k.x-j.x)!=0||Math.round(j.x-h.x)!=0)&&(Math.round(k.y-j.y)!=0||Math.round(j.y-h.y)!=0)){l.push(this.convertPoint(j.clone(),false))}k=j;j=h}var o=this.state.getVisibleTerminalState(true);var s=this.state.getVisibleTerminalState(false);var u=this.state.absolutePoints;if(l.length==0&&(Math.round(v[0].x-v[v.length-1].x)==0||Math.round(v[0].y-v[v.length-1].y)==0)){l=[p,p]}else{if(v.length==5&&l.length==2&&o!=null&&s!=null&&u!=null&&Math.round(u[0].x-u[u.length-1].x)==0){var m=this.graph.getView();var t=m.getScale();var c=m.getTranslate();var d=m.getRoutingCenterY(o)/t-c.y;var b=this.graph.getConnectionConstraint(e,o,true);if(b!=null){var n=this.graph.getConnectionPoint(o,b);if(n!=null){this.convertPoint(n,false);d=n.y}}var a=m.getRoutingCenterY(s)/t-c.y;var g=this.graph.getConnectionConstraint(e,s,false);if(g){var n=this.graph.getConnectionPoint(s,g);if(n!=null){this.convertPoint(n,false);a=n.y}}l=[new mxPoint(p.x,d),new mxPoint(p.x,a)]}}this.points=l;e.view.updateFixedTerminalPoints(e,o,s);e.view.updatePoints(e,this.points,o,s);e.view.updateFloatingTerminalPoints(e,o,s)}};mxEdgeSegmentHandler.prototype.connect=function(a,e,g,f,h){var n=this.abspoints;var l=n[0];var k=n[1];var m=[];for(var c=2;c<n.length;c++){var j=n[c];if((Math.round(l.x-k.x)!=0||Math.round(k.x-j.x)!=0)&&(Math.round(l.y-k.y)!=0||Math.round(k.y-j.y)!=0)){m.push(this.convertPoint(k.clone(),false))}l=k;k=j}var d=this.graph.getModel();d.beginUpdate();try{var b=d.getGeometry(a);if(b!=null){b=b.clone();b.points=m;d.setGeometry(a,b)}a=mxEdgeHandler.prototype.connect.apply(this,arguments)}finally{d.endUpdate()}return a};mxEdgeSegmentHandler.prototype.getTooltipForNode=function(a){return null};mxEdgeSegmentHandler.prototype.start=function(a,c,b){mxEdgeHandler.prototype.start.apply(this,arguments);if(this.bends[b]!=null&&!this.isSource&&!this.isTarget){mxUtils.setOpacity(this.bends[b].node,100)}};mxEdgeSegmentHandler.prototype.createBends=function(){var d=[];var c=this.createHandleShape(0);this.initBend(c);c.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE);d.push(c);var e=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){if(this.points==null){this.points=[]}for(var b=0;b<e.length-1;b++){c=this.createVirtualBend();d.push(c);var a=Math.round(e[b].x-e[b+1].x)==0;if(Math.round(e[b].y-e[b+1].y)==0&&b<e.length-2){a=Math.round(e[b].x-e[b+2].x)==0}c.setCursor((a)?"col-resize":"row-resize");this.points.push(new mxPoint(0,0))}}var c=this.createHandleShape(e.length);this.initBend(c);c.setCursor(mxConstants.CURSOR_TERMINAL_HANDLE);d.push(c);return d};mxEdgeSegmentHandler.prototype.redraw=function(){this.refresh();mxEdgeHandler.prototype.redraw.apply(this,arguments)};mxEdgeSegmentHandler.prototype.redrawInnerBends=function(h,f){if(this.graph.isCellBendable(this.state.cell)){var j=this.getCurrentPoints();if(j!=null&&j.length>1){var e=false;if(j.length==4&&Math.round(j[1].x-j[2].x)==0&&Math.round(j[1].y-j[2].y)==0){e=true;if(Math.round(j[0].y-j[j.length-1].y)==0){var c=j[0].x+(j[j.length-1].x-j[0].x)/2;j[1]=new mxPoint(c,j[1].y);j[2]=new mxPoint(c,j[2].y)}else{var a=j[0].y+(j[j.length-1].y-j[0].y)/2;j[1]=new mxPoint(j[1].x,a);j[2]=new mxPoint(j[2].x,a)}}for(var d=0;d<j.length-1;d++){if(this.bends[d+1]!=null){var h=j[d];var f=j[d+1];var k=new mxPoint(h.x+(f.x-h.x)/2,h.y+(f.y-h.y)/2);var g=this.bends[d+1].bounds;this.bends[d+1].bounds=new mxRectangle(Math.floor(k.x-g.width/2),Math.floor(k.y-g.height/2),g.width,g.height);this.bends[d+1].redraw();if(this.manageLabelHandle){this.checkLabelHandle(this.bends[d+1].bounds)}}}if(e){mxUtils.setOpacity(this.bends[1].node,this.virtualBendOpacity);mxUtils.setOpacity(this.bends[3].node,this.virtualBendOpacity)}}}};