function mxHandle(a,c,b){this.graph=a.view.graph;this.state=a;this.cursor=(c!=null)?c:this.cursor;this.image=(b!=null)?b:this.image;this.init()}mxHandle.prototype.cursor="default";mxHandle.prototype.image=null;mxHandle.prototype.ignoreGrid=false;mxHandle.prototype.getPosition=function(a){};mxHandle.prototype.setPosition=function(b,c,a){};mxHandle.prototype.execute=function(){};mxHandle.prototype.copyStyle=function(a){this.graph.setCellStyles(a,this.state.style[a],[this.state.cell])};mxHandle.prototype.processEvent=function(b){var e=this.graph.view.scale;var c=this.graph.view.translate;var d=new mxPoint(b.getGraphX()/e-c.x,b.getGraphY()/e-c.y);if(this.shape!=null&&this.shape.bounds!=null){d.x-=this.shape.bounds.width/e/4;d.y-=this.shape.bounds.height/e/4}var a=-mxUtils.toRadians(this.getRotation());var f=-mxUtils.toRadians(this.getTotalRotation())-a;d=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(d,a),this.ignoreGrid||!this.graph.isGridEnabledEvent(b.getEvent())),f));this.setPosition(this.state.getPaintBounds(),d,b);this.positionChanged();this.redraw()};mxHandle.prototype.positionChanged=function(){if(this.state.text!=null){this.state.text.apply(this.state)}if(this.state.shape!=null){this.state.shape.apply(this.state)}this.graph.cellRenderer.redraw(this.state,true)};mxHandle.prototype.getRotation=function(){if(this.state.shape!=null){return this.state.shape.getRotation()}return 0};mxHandle.prototype.getTotalRotation=function(){if(this.state.shape!=null){return this.state.shape.getShapeRotation()}return 0};mxHandle.prototype.init=function(){var a=this.isHtmlRequired();if(this.image!=null){this.shape=new mxImageShape(new mxRectangle(0,0,this.image.width,this.image.height),this.image.src);this.shape.preserveImageAspect=false}else{this.shape=this.createShape(a)}this.initShape(a)};mxHandle.prototype.createShape=function(a){var b=new mxRectangle(0,0,mxConstants.HANDLE_SIZE,mxConstants.HANDLE_SIZE);return new mxRectangleShape(b,mxConstants.HANDLE_FILLCOLOR,mxConstants.HANDLE_STROKECOLOR)};mxHandle.prototype.initShape=function(a){if(a&&this.shape.isHtmlAllowed()){this.shape.dialect=mxConstants.DIALECT_STRICTHTML;this.shape.init(this.graph.container)}else{this.shape.dialect=(this.graph.dialect!=mxConstants.DIALECT_SVG)?mxConstants.DIALECT_MIXEDHTML:mxConstants.DIALECT_SVG;if(this.cursor!=null){this.shape.init(this.graph.getView().getOverlayPane())}}mxEvent.redirectMouseEvents(this.shape.node,this.graph,this.state);this.shape.node.style.cursor=this.cursor};mxHandle.prototype.redraw=function(){if(this.shape!=null&&this.state.shape!=null){var c=this.getPosition(this.state.getPaintBounds());if(c!=null){var b=mxUtils.toRadians(this.getTotalRotation());c=this.rotatePoint(this.flipPoint(c),b);var d=this.graph.view.scale;var a=this.graph.view.translate;this.shape.bounds.x=Math.floor((c.x+a.x)*d-this.shape.bounds.width/2);this.shape.bounds.y=Math.floor((c.y+a.y)*d-this.shape.bounds.height/2);this.state.unscaledWidth=null;this.shape.redraw()}}};mxHandle.prototype.isHtmlRequired=function(){return this.state.text!=null&&this.state.text.node.parentNode==this.graph.container};mxHandle.prototype.rotatePoint=function(f,e){var c=this.state.getCellBounds();var a=new mxPoint(c.getCenterX(),c.getCenterY());var d=Math.cos(e);var b=Math.sin(e);return mxUtils.getRotatedPoint(f,d,b,a)};mxHandle.prototype.flipPoint=function(b){if(this.state.shape!=null){var a=this.state.getCellBounds();if(this.state.shape.flipH){b.x=2*a.x+a.width-b.x}if(this.state.shape.flipV){b.y=2*a.y+a.height-b.y}}return b};mxHandle.prototype.snapPoint=function(a,b){if(!b){a.x=this.graph.snap(a.x);a.y=this.graph.snap(a.y)}return a};mxHandle.prototype.setVisible=function(a){if(this.shape!=null&&this.shape.node!=null){this.shape.node.style.display=(a)?"":"none"}};mxHandle.prototype.reset=function(){this.setVisible(true);this.state.style=this.graph.getCellStyle(this.state.cell);this.positionChanged()};mxHandle.prototype.destroy=function(){if(this.shape!=null){this.shape.destroy();this.shape=null}};