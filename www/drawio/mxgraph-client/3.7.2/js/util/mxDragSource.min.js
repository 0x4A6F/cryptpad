function mxDragSource(b,a){this.element=b;this.dropHandler=a;mxEvent.addGestureListeners(b,mxUtils.bind(this,function(c){this.mouseDown(c)}));mxEvent.addListener(b,"dragstart",function(c){mxEvent.consume(c)});this.eventConsumer=function(d,c){var f=c.getProperty("eventName");var e=c.getProperty("event");if(f!=mxEvent.MOUSE_DOWN){e.consume()}}}mxDragSource.prototype.element=null;mxDragSource.prototype.dropHandler=null;mxDragSource.prototype.dragOffset=null;mxDragSource.prototype.dragElement=null;mxDragSource.prototype.previewElement=null;mxDragSource.prototype.enabled=true;mxDragSource.prototype.currentGraph=null;mxDragSource.prototype.currentDropTarget=null;mxDragSource.prototype.currentPoint=null;mxDragSource.prototype.currentGuide=null;mxDragSource.prototype.currentHighlight=null;mxDragSource.prototype.autoscroll=true;mxDragSource.prototype.guidesEnabled=true;mxDragSource.prototype.gridEnabled=true;mxDragSource.prototype.highlightDropTargets=true;mxDragSource.prototype.dragElementZIndex=100;mxDragSource.prototype.dragElementOpacity=70;mxDragSource.prototype.isEnabled=function(){return this.enabled};mxDragSource.prototype.setEnabled=function(a){this.enabled=a};mxDragSource.prototype.isGuidesEnabled=function(){return this.guidesEnabled};mxDragSource.prototype.setGuidesEnabled=function(a){this.guidesEnabled=a};mxDragSource.prototype.isGridEnabled=function(){return this.gridEnabled};mxDragSource.prototype.setGridEnabled=function(a){this.gridEnabled=a};mxDragSource.prototype.getGraphForEvent=function(a){return null};mxDragSource.prototype.getDropTarget=function(c,a,d,b){return c.getCellAt(a,d)};mxDragSource.prototype.createDragElement=function(a){return this.element.cloneNode(true)};mxDragSource.prototype.createPreviewElement=function(a){return null};mxDragSource.prototype.isActive=function(){return this.mouseMoveHandler!=null};mxDragSource.prototype.reset=function(){if(this.currentGraph!=null){this.dragExit(this.currentGraph);this.currentGraph=null}this.removeDragElement();this.removeListeners();this.stopDrag()};mxDragSource.prototype.mouseDown=function(a){if(this.enabled&&!mxEvent.isConsumed(a)&&this.mouseMoveHandler==null){this.startDrag(a);this.mouseMoveHandler=mxUtils.bind(this,this.mouseMove);this.mouseUpHandler=mxUtils.bind(this,this.mouseUp);mxEvent.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler);if(mxClient.IS_TOUCH&&!mxEvent.isMouseEvent(a)){this.eventSource=mxEvent.getSource(a);mxEvent.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)}}};mxDragSource.prototype.startDrag=function(a){this.dragElement=this.createDragElement(a);this.dragElement.style.position="absolute";this.dragElement.style.zIndex=this.dragElementZIndex;mxUtils.setOpacity(this.dragElement,this.dragElementOpacity)};mxDragSource.prototype.stopDrag=function(){this.removeDragElement()};mxDragSource.prototype.removeDragElement=function(){if(this.dragElement!=null){if(this.dragElement.parentNode!=null){this.dragElement.parentNode.removeChild(this.dragElement)}this.dragElement=null}};mxDragSource.prototype.graphContainsEvent=function(d,b){var a=mxEvent.getClientX(b);var f=mxEvent.getClientY(b);var e=mxUtils.getOffset(d.container);var c=mxUtils.getScrollOrigin();return a>=e.x-c.x&&f>=e.y-c.y&&a<=e.x-c.x+d.container.offsetWidth&&f<=e.y-c.y+d.container.offsetHeight};mxDragSource.prototype.mouseMove=function(b){var c=this.getGraphForEvent(b);if(c!=null&&!this.graphContainsEvent(c,b)){c=null}if(c!=this.currentGraph){if(this.currentGraph!=null){this.dragExit(this.currentGraph,b)}this.currentGraph=c;if(this.currentGraph!=null){this.dragEnter(this.currentGraph,b)}}if(this.currentGraph!=null){this.dragOver(this.currentGraph,b)}if(this.dragElement!=null&&(this.previewElement==null||this.previewElement.style.visibility!="visible")){var a=mxEvent.getClientX(b);var e=mxEvent.getClientY(b);if(this.dragElement.parentNode==null){document.body.appendChild(this.dragElement)}this.dragElement.style.visibility="visible";if(this.dragOffset!=null){a+=this.dragOffset.x;e+=this.dragOffset.y}var d=mxUtils.getDocumentScrollOrigin(document);this.dragElement.style.left=(a+d.x)+"px";this.dragElement.style.top=(e+d.y)+"px"}else{if(this.dragElement!=null){this.dragElement.style.visibility="hidden"}}mxEvent.consume(b)};mxDragSource.prototype.mouseUp=function(b){if(this.currentGraph!=null){if(this.currentPoint!=null&&(this.previewElement==null||this.previewElement.style.visibility!="hidden")){var d=this.currentGraph.view.scale;var c=this.currentGraph.view.translate;var a=this.currentPoint.x/d-c.x;var e=this.currentPoint.y/d-c.y;this.drop(this.currentGraph,b,this.currentDropTarget,a,e)}this.dragExit(this.currentGraph);this.currentGraph=null}this.stopDrag();this.removeListeners();mxEvent.consume(b)};mxDragSource.prototype.removeListeners=function(){if(this.eventSource!=null){mxEvent.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler);this.eventSource=null}mxEvent.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler);this.mouseMoveHandler=null;this.mouseUpHandler=null};mxDragSource.prototype.dragEnter=function(b,a){b.isMouseDown=true;b.isMouseTrigger=mxEvent.isMouseEvent(a);this.previewElement=this.createPreviewElement(b);if(this.isGuidesEnabled()&&this.previewElement!=null){this.currentGuide=new mxGuide(b,b.graphHandler.getGuideStates())}if(this.highlightDropTargets){this.currentHighlight=new mxCellHighlight(b,mxConstants.DROP_TARGET_COLOR)}b.addListener(mxEvent.FIRE_MOUSE_EVENT,this.eventConsumer)};mxDragSource.prototype.dragExit=function(b,a){this.currentDropTarget=null;this.currentPoint=null;b.isMouseDown=false;b.removeListener(this.eventConsumer);if(this.previewElement!=null){if(this.previewElement.parentNode!=null){this.previewElement.parentNode.removeChild(this.previewElement)}this.previewElement=null}if(this.currentGuide!=null){this.currentGuide.destroy();this.currentGuide=null}if(this.currentHighlight!=null){this.currentHighlight.destroy();this.currentHighlight=null}};mxDragSource.prototype.dragOver=function(q,p){var f=mxUtils.getOffset(q.container);var n=mxUtils.getScrollOrigin(q.container);var l=mxEvent.getClientX(p)-f.x+n.x-q.panDx;var k=mxEvent.getClientY(p)-f.y+n.y-q.panDy;if(q.autoScroll&&(this.autoscroll==null||this.autoscroll)){q.scrollPointToVisible(l,k,q.autoExtend)}if(this.currentHighlight!=null&&q.isDropEnabled()){this.currentDropTarget=this.getDropTarget(q,l,k,p);var b=q.getView().getState(this.currentDropTarget);this.currentHighlight.highlight(b)}if(this.previewElement!=null){if(this.previewElement.parentNode==null){q.container.appendChild(this.previewElement);this.previewElement.style.zIndex="3";this.previewElement.style.position="absolute"}var i=this.isGridEnabled()&&q.isGridEnabledEvent(p);var e=true;if(this.currentGuide!=null&&this.currentGuide.isEnabledForEvent(p)){var m=parseInt(this.previewElement.style.width);var g=parseInt(this.previewElement.style.height);var a=new mxRectangle(0,0,m,g);var o=new mxPoint(l,k);o=this.currentGuide.move(a,o,i);e=false;l=o.x;k=o.y}else{if(i){var d=q.view.scale;var j=q.view.translate;var c=q.gridSize/2;l=(q.snap(l/d-j.x-c)+j.x)*d;k=(q.snap(k/d-j.y-c)+j.y)*d}}if(this.currentGuide!=null&&e){this.currentGuide.hide()}if(this.previewOffset!=null){l+=this.previewOffset.x;k+=this.previewOffset.y}this.previewElement.style.left=Math.round(l)+"px";this.previewElement.style.top=Math.round(k)+"px";this.previewElement.style.visibility="visible"}this.currentPoint=new mxPoint(l,k)};mxDragSource.prototype.drop=function(c,b,e,a,d){this.dropHandler(c,b,e,a,d);if(c.container.style.visibility!="hidden"){c.container.focus()}};