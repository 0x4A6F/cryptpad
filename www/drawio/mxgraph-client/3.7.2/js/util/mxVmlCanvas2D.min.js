var mxVmlCanvas2D=function(a){mxAbstractCanvas2D.call(this);this.root=a};mxUtils.extend(mxVmlCanvas2D,mxAbstractCanvas2D);mxVmlCanvas2D.prototype.node=null;mxVmlCanvas2D.prototype.textEnabled=true;mxVmlCanvas2D.prototype.moveOp="m";mxVmlCanvas2D.prototype.lineOp="l";mxVmlCanvas2D.prototype.curveOp="c";mxVmlCanvas2D.prototype.closeOp="x";mxVmlCanvas2D.prototype.rotatedHtmlBackground="";mxVmlCanvas2D.prototype.vmlScale=1;mxVmlCanvas2D.prototype.createElement=function(a){return document.createElement(a)};mxVmlCanvas2D.prototype.createVmlElement=function(a){return this.createElement(mxClient.VML_PREFIX+":"+a)};mxVmlCanvas2D.prototype.addNode=function(d,b){var c=this.node;var a=this.state;if(c!=null){if(c.nodeName=="shape"){if(this.path!=null&&this.path.length>0){c.path=this.path.join(" ")+" e";c.style.width=this.root.style.width;c.style.height=this.root.style.height;c.coordsize=parseInt(c.style.width)+" "+parseInt(c.style.height)}else{return}}c.strokeweight=this.format(Math.max(1,a.strokeWidth*a.scale/this.vmlScale))+"px";if(a.shadow){this.root.appendChild(this.createShadow(c,d&&a.fillColor!=null,b&&a.strokeColor!=null))}if(b&&a.strokeColor!=null){c.stroked="true";c.strokecolor=a.strokeColor}else{c.stroked="false"}c.appendChild(this.createStroke());if(d&&a.fillColor!=null){c.appendChild(this.createFill())}else{if(this.pointerEvents&&(c.nodeName!="shape"||this.path[this.path.length-1]==this.closeOp)){c.appendChild(this.createTransparentFill())}else{c.filled="false"}}this.root.appendChild(c)}};mxVmlCanvas2D.prototype.createTransparentFill=function(){var a=this.createVmlElement("fill");a.src=mxClient.imageBasePath+"/transparent.gif";a.type="tile";return a};mxVmlCanvas2D.prototype.createFill=function(){var a=this.state;var b=this.createVmlElement("fill");b.color=a.fillColor;if(a.gradientColor!=null){b.type="gradient";b.method="none";b.color2=a.gradientColor;var c=180-a.rotation;if(a.gradientDirection==mxConstants.DIRECTION_WEST){c-=90+((this.root.style.flip=="x")?180:0)}else{if(a.gradientDirection==mxConstants.DIRECTION_EAST){c+=90+((this.root.style.flip=="x")?180:0)}else{if(a.gradientDirection==mxConstants.DIRECTION_NORTH){c-=180+((this.root.style.flip=="y")?-180:0)}else{c+=((this.root.style.flip=="y")?-180:0)}}}if(this.root.style.flip=="x"||this.root.style.flip=="y"){c*=-1}b.angle=mxUtils.mod(c,360);b.opacity=(a.alpha*a.gradientFillAlpha*100)+"%";b.setAttribute(mxClient.OFFICE_PREFIX+":opacity2",(a.alpha*a.gradientAlpha*100)+"%")}else{if(a.alpha<1||a.fillAlpha<1){b.opacity=(a.alpha*a.fillAlpha*100)+"%"}}return b};mxVmlCanvas2D.prototype.createStroke=function(){var a=this.state;var b=this.createVmlElement("stroke");b.endcap=a.lineCap||"flat";b.joinstyle=a.lineJoin||"miter";b.miterlimit=a.miterLimit||"10";if(a.alpha<1||a.strokeAlpha<1){b.opacity=(a.alpha*a.strokeAlpha*100)+"%"}if(a.dashed){b.dashstyle=this.getVmlDashStyle()}return b};mxVmlCanvas2D.prototype.getVmlDashStyle=function(){var a="dash";if(typeof(this.state.dashPattern)==="string"){var b=this.state.dashPattern.split(" ");if(b.length>0&&b[0]==1){a="0 2"}}return a};mxVmlCanvas2D.prototype.createShadow=function(a,g,h){var i=this.state;var c=-i.rotation*(Math.PI/180);var e=Math.cos(c);var b=Math.sin(c);var j=i.shadowDx*i.scale;var f=i.shadowDy*i.scale;if(this.root.style.flip=="x"){j*=-1}else{if(this.root.style.flip=="y"){f*=-1}}var d=a.cloneNode(true);d.style.marginLeft=Math.round(j*e-f*b)+"px";d.style.marginTop=Math.round(j*b+f*e)+"px";if(document.documentMode==8){d.strokeweight=a.strokeweight;if(a.nodeName=="shape"){d.path=this.path.join(" ")+" e";d.style.width=this.root.style.width;d.style.height=this.root.style.height;d.coordsize=parseInt(a.style.width)+" "+parseInt(a.style.height)}}if(h){d.strokecolor=i.shadowColor;d.appendChild(this.createShadowStroke())}else{d.stroked="false"}if(g){d.appendChild(this.createShadowFill())}else{d.filled="false"}return d};mxVmlCanvas2D.prototype.createShadowFill=function(){var a=this.createVmlElement("fill");a.color=this.state.shadowColor;a.opacity=(this.state.alpha*this.state.shadowAlpha*100)+"%";return a};mxVmlCanvas2D.prototype.createShadowStroke=function(){var a=this.createStroke();a.opacity=(this.state.alpha*this.state.shadowAlpha*100)+"%";return a};mxVmlCanvas2D.prototype.rotate=function(b,d,c,a,e){if(d&&c){b+=180}else{if(d){this.root.style.flip="x"}else{if(c){this.root.style.flip="y"}}}if(d?!c:c){b*=-1}this.root.style.rotation=b;this.state.rotation=this.state.rotation+b;this.state.rotationCx=a;this.state.rotationCy=e};mxVmlCanvas2D.prototype.begin=function(){mxAbstractCanvas2D.prototype.begin.apply(this,arguments);this.node=this.createVmlElement("shape");this.node.style.position="absolute"};mxVmlCanvas2D.prototype.quadTo=function(b,m,a,l){var o=this.state;var k=(this.lastX+o.dx)*o.scale;var f=(this.lastY+o.dy)*o.scale;var n=(b+o.dx)*o.scale;var j=(m+o.dy)*o.scale;var g=(a+o.dx)*o.scale;var c=(l+o.dy)*o.scale;var i=k+2/3*(n-k);var e=f+2/3*(j-f);var h=g+2/3*(n-g);var d=c+2/3*(j-c);this.path.push("c "+this.format(i)+" "+this.format(e)+" "+this.format(h)+" "+this.format(d)+" "+this.format(g)+" "+this.format(c));this.lastX=(g/o.scale)-o.dx;this.lastY=(c/o.scale)-o.dy};mxVmlCanvas2D.prototype.createRect=function(g,a,f,b,d){var c=this.state;var e=this.createVmlElement(g);e.style.position="absolute";e.style.left=this.format((a+c.dx)*c.scale)+"px";e.style.top=this.format((f+c.dy)*c.scale)+"px";e.style.width=this.format(b*c.scale)+"px";e.style.height=this.format(d*c.scale)+"px";return e};mxVmlCanvas2D.prototype.rect=function(a,d,b,c){this.node=this.createRect("rect",a,d,b,c)};mxVmlCanvas2D.prototype.roundrect=function(a,f,c,e,d,b){this.node=this.createRect("roundrect",a,f,c,e);this.node.setAttribute("arcsize",Math.max(d*100/c,b*100/e)+"%")};mxVmlCanvas2D.prototype.ellipse=function(a,d,b,c){this.node=this.createRect("oval",a,d,b,c)};mxVmlCanvas2D.prototype.image=function(i,g,j,e,a,b,f,c){var d=null;if(!b){d=this.createRect("image",i,g,j,e);d.src=a}else{d=this.createRect("rect",i,g,j,e);d.stroked="false";var k=this.createVmlElement("fill");k.aspect=(b)?"atmost":"ignore";k.rotate="true";k.type="frame";k.src=a;d.appendChild(k)}if(f&&c){d.style.rotation="180"}else{if(f){d.style.flip="x"}else{if(c){d.style.flip="y"}}}if(this.state.alpha<1||this.state.fillAlpha<1){d.style.filter+="alpha(opacity="+(this.state.alpha*this.state.fillAlpha*100)+")"}this.root.appendChild(d)};mxVmlCanvas2D.prototype.createDiv=function(h,g,i,d){var b=this.createElement("div");var c=this.state;var e="";if(c.fontBackgroundColor!=null){e+="background-color:"+c.fontBackgroundColor+";"}if(c.fontBorderColor!=null){e+="border:1px solid "+c.fontBorderColor+";"}if(mxUtils.isNode(h)){b.appendChild(h)}else{if(d!="fill"&&d!="width"){var f=this.createElement("div");f.style.cssText=e;f.style.display=(mxClient.IS_QUIRKS)?"inline":"inline-block";f.style.zoom="1";f.style.textDecoration="inherit";f.innerHTML=h;b.appendChild(f)}else{b.style.cssText=e;b.innerHTML=h}}var a=b.style;a.fontSize=(c.fontSize/this.vmlScale)+"px";a.fontFamily=c.fontFamily;a.color=c.fontColor;a.verticalAlign="top";a.textAlign=g||"left";a.lineHeight=(mxConstants.ABSOLUTE_LINE_HEIGHT)?(c.fontSize*mxConstants.LINE_HEIGHT/this.vmlScale)+"px":mxConstants.LINE_HEIGHT;if((c.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD){a.fontWeight="bold"}if((c.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC){a.fontStyle="italic"}if((c.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE){a.textDecoration="underline"}return b};mxVmlCanvas2D.prototype.text=function(C,B,D,M,v,L,E,J,o,H,A,t,P){if(this.textEnabled&&v!=null){var G=this.state;if(o=="html"){if(G.rotation!=null){var i=this.rotatePoint(C,B,G.rotation,G.rotationCx,G.rotationCy);C=i.x;B=i.y}if(document.documentMode==8&&!mxClient.IS_EM){C+=G.dx;B+=G.dy;if(H!="fill"&&E==mxConstants.ALIGN_TOP){B-=1}}else{C*=G.scale;B*=G.scale}var p=(document.documentMode==8&&!mxClient.IS_EM)?this.createVmlElement("group"):this.createElement("div");p.style.position="absolute";p.style.display="inline";p.style.left=this.format(C)+"px";p.style.top=this.format(B)+"px";p.style.zoom=G.scale;var g=this.createElement("div");g.style.position="relative";g.style.display="inline";var e=mxUtils.getAlignmentAsPoint(L,E);var c=e.x;var b=e.y;var N=this.createDiv(v,L,E,H);var n=this.createElement("div");if(P!=null){N.setAttribute("dir",P)}if(J&&D>0){if(!A){N.style.width=Math.round(D)+"px"}N.style.wordWrap=mxConstants.WORD_WRAP;N.style.whiteSpace="normal";if(N.style.wordWrap=="break-word"){var I=N;if(I.firstChild!=null&&I.firstChild.nodeName=="DIV"){I.firstChild.style.width="100%"}}}else{N.style.whiteSpace="nowrap"}var l=G.rotation+(t||0);if(this.rotateHtml&&l!=0){n.style.display="inline";n.style.zoom="1";n.appendChild(N);if(document.documentMode==8&&!mxClient.IS_EM&&this.root.nodeName!="DIV"){g.appendChild(n);p.appendChild(g)}else{p.appendChild(n)}}else{if(document.documentMode==8&&!mxClient.IS_EM){g.appendChild(N);p.appendChild(g)}else{N.style.display="inline";p.appendChild(N)}}if(this.root.nodeName!="DIV"){var q=this.createVmlElement("rect");q.stroked="false";q.filled="false";q.appendChild(p);this.root.appendChild(q)}else{this.root.appendChild(p)}if(A){N.style.overflow="hidden";N.style.width=Math.round(D)+"px";if(!mxClient.IS_QUIRKS){N.style.maxHeight=Math.round(M)+"px"}}else{if(H=="fill"){N.style.overflow="hidden";N.style.width=(Math.max(0,D)+1)+"px";N.style.height=(Math.max(0,M)+1)+"px"}else{if(H=="width"){N.style.overflow="hidden";N.style.width=(Math.max(0,D)+1)+"px";N.style.maxHeight=(Math.max(0,M)+1)+"px"}}}if(this.rotateHtml&&l!=0){var a=l*(Math.PI/180);var F=parseFloat(parseFloat(Math.cos(a)).toFixed(8));var O=parseFloat(parseFloat(Math.sin(-a)).toFixed(8));a%=2*Math.PI;if(a<0){a+=2*Math.PI}a%=Math.PI;if(a>Math.PI/2){a=Math.PI-a}var d=Math.cos(a);var k=Math.sin(a);if(document.documentMode==8&&!mxClient.IS_EM){N.style.display="inline-block";n.style.display="inline-block";g.style.display="inline-block"}N.style.visibility="hidden";N.style.position="absolute";document.body.appendChild(N);var f=N;if(f.firstChild!=null&&f.firstChild.nodeName=="DIV"){f=f.firstChild}var I=f.offsetWidth+3;var z=f.offsetHeight;if(A){D=Math.min(D,I);z=Math.min(z,M)}else{D=I}if(J){N.style.width=D+"px"}if(mxClient.IS_QUIRKS&&(A||H=="width")&&z>M){z=M;N.style.height=z+"px"}M=z;var r=(M-M*d+D*-k)/2-O*D*(c+0.5)+F*M*(b+0.5);var j=(D-D*d+M*-k)/2+F*D*(c+0.5)+O*M*(b+0.5);if(p.nodeName=="group"&&this.root.nodeName=="DIV"){var u=this.createElement("div");u.style.display="inline-block";u.style.position="absolute";u.style.left=this.format(C+(j-D/2)*G.scale)+"px";u.style.top=this.format(B+(r-M/2)*G.scale)+"px";p.parentNode.appendChild(u);u.appendChild(p)}else{var m=(document.documentMode==8&&!mxClient.IS_EM)?1:G.scale;p.style.left=this.format(C+(j-D/2)*m)+"px";p.style.top=this.format(B+(r-M/2)*m)+"px"}n.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+F+", M12="+O+", M21="+(-O)+", M22="+F+", sizingMethod='auto expand')";n.style.backgroundColor=this.rotatedHtmlBackground;if(this.state.alpha<1){n.style.filter+="alpha(opacity="+(this.state.alpha*100)+")"}n.appendChild(N);N.style.position="";N.style.visibility=""}else{if(document.documentMode!=8||mxClient.IS_EM){N.style.verticalAlign="top";if(this.state.alpha<1){p.style.filter="alpha(opacity="+(this.state.alpha*100)+")"}var K=N.parentNode;N.style.visibility="hidden";document.body.appendChild(N);D=N.offsetWidth;var z=N.offsetHeight;if(mxClient.IS_QUIRKS&&A&&z>M){z=M;N.style.height=z+"px"}M=z;N.style.visibility="";K.appendChild(N);p.style.left=this.format(C+D*c*this.state.scale)+"px";p.style.top=this.format(B+M*b*this.state.scale)+"px"}else{if(this.state.alpha<1){N.style.filter="alpha(opacity="+(this.state.alpha*100)+")"}g.style.left=(c*100)+"%";g.style.top=(b*100)+"%"}}}else{this.plainText(C,B,D,M,mxUtils.htmlEntities(v,false),L,E,J,o,H,A,t,P)}}};mxVmlCanvas2D.prototype.plainText=function(g,e,j,A,p,v,d,f,z,q,B,t,o){var l=this.state;g=(g+l.dx)*l.scale;e=(e+l.dy)*l.scale;var r=this.createVmlElement("shape");r.style.width="1px";r.style.height="1px";r.stroked="false";var u=this.createVmlElement("fill");u.color=l.fontColor;u.opacity=(l.alpha*100)+"%";r.appendChild(u);var n=this.createVmlElement("path");n.textpathok="true";n.v="m "+this.format(0)+" "+this.format(0)+" l "+this.format(1)+" "+this.format(0);r.appendChild(n);var c=this.createVmlElement("textpath");c.style.cssText="v-text-align:"+v;c.style.align=v;c.style.fontFamily=l.fontFamily;c.string=p;c.on="true";var m=l.fontSize*l.scale/this.vmlScale;c.style.fontSize=m+"px";if((l.fontStyle&mxConstants.FONT_BOLD)==mxConstants.FONT_BOLD){c.style.fontWeight="bold"}if((l.fontStyle&mxConstants.FONT_ITALIC)==mxConstants.FONT_ITALIC){c.style.fontStyle="italic"}if((l.fontStyle&mxConstants.FONT_UNDERLINE)==mxConstants.FONT_UNDERLINE){c.style.textDecoration="underline"}var b=p.split("\n");var a=m+(b.length-1)*m*mxConstants.LINE_HEIGHT;var k=0;var i=0;if(d==mxConstants.ALIGN_BOTTOM){i=-a/2}else{if(d!=mxConstants.ALIGN_MIDDLE){i=a/2}}if(t!=null){r.style.rotation=t;var C=t*(Math.PI/180);k=Math.sin(C)*i;i=Math.cos(C)*i}r.appendChild(c);r.style.left=this.format(g-k)+"px";r.style.top=this.format(e+i)+"px";this.root.appendChild(r)};mxVmlCanvas2D.prototype.stroke=function(){this.addNode(false,true)};mxVmlCanvas2D.prototype.fill=function(){this.addNode(true,false)};mxVmlCanvas2D.prototype.fillAndStroke=function(){this.addNode(true,true)};