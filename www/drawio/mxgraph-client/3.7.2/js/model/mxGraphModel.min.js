function mxGraphModel(a){this.currentEdit=this.createUndoableEdit();if(a!=null){this.setRoot(a)}else{this.clear()}}mxGraphModel.prototype=new mxEventSource();mxGraphModel.prototype.constructor=mxGraphModel;mxGraphModel.prototype.root=null;mxGraphModel.prototype.cells=null;mxGraphModel.prototype.maintainEdgeParent=true;mxGraphModel.prototype.ignoreRelativeEdgeParent=true;mxGraphModel.prototype.createIds=true;mxGraphModel.prototype.prefix="";mxGraphModel.prototype.postfix="";mxGraphModel.prototype.nextId=0;mxGraphModel.prototype.currentEdit=null;mxGraphModel.prototype.updateLevel=0;mxGraphModel.prototype.endingUpdate=false;mxGraphModel.prototype.clear=function(){this.setRoot(this.createRoot())};mxGraphModel.prototype.isCreateIds=function(){return this.createIds};mxGraphModel.prototype.setCreateIds=function(a){this.createIds=a};mxGraphModel.prototype.createRoot=function(){var a=new mxCell();a.insert(new mxCell());return a};mxGraphModel.prototype.getCell=function(a){return(this.cells!=null)?this.cells[a]:null};mxGraphModel.prototype.filterCells=function(b,d){var a=null;if(b!=null){a=[];for(var c=0;c<b.length;c++){if(d(b[c])){a.push(b[c])}}}return a};mxGraphModel.prototype.getDescendants=function(a){return this.filterDescendants(null,a)};mxGraphModel.prototype.filterDescendants=function(e,d){var a=[];d=d||this.getRoot();if(e==null||e(d)){a.push(d)}var b=this.getChildCount(d);for(var c=0;c<b;c++){var f=this.getChildAt(d,c);a=a.concat(this.filterDescendants(e,f))}return a};mxGraphModel.prototype.getRoot=function(a){var b=a||this.root;if(a!=null){while(a!=null){b=a;a=this.getParent(a)}}return b};mxGraphModel.prototype.setRoot=function(a){this.execute(new mxRootChange(this,a));return a};mxGraphModel.prototype.rootChanged=function(a){var b=this.root;this.root=a;this.nextId=0;this.cells=null;this.cellAdded(a);return b};mxGraphModel.prototype.isRoot=function(a){return a!=null&&this.root==a};mxGraphModel.prototype.isLayer=function(a){return this.isRoot(this.getParent(a))};mxGraphModel.prototype.isAncestor=function(a,b){while(b!=null&&b!=a){b=this.getParent(b)}return b==a};mxGraphModel.prototype.contains=function(a){return this.isAncestor(this.root,a)};mxGraphModel.prototype.getParent=function(a){return(a!=null)?a.getParent():null};mxGraphModel.prototype.add=function(b,d,a){if(d!=b&&b!=null&&d!=null){if(a==null){a=this.getChildCount(b)}var c=b!=this.getParent(d);this.execute(new mxChildChange(this,b,d,a));if(this.maintainEdgeParent&&c){this.updateEdgeParents(d)}}return d};mxGraphModel.prototype.cellAdded=function(a){if(a!=null){if(a.getId()==null&&this.createIds){a.setId(this.createId(a))}if(a.getId()!=null){var d=this.getCell(a.getId());if(d!=a){while(d!=null){a.setId(this.createId(a));d=this.getCell(a.getId())}if(this.cells==null){this.cells=new Object()}this.cells[a.getId()]=a}}if(mxUtils.isNumeric(a.getId())){this.nextId=Math.max(this.nextId,a.getId())}var b=this.getChildCount(a);for(var c=0;c<b;c++){this.cellAdded(this.getChildAt(a,c))}}};mxGraphModel.prototype.createId=function(a){var b=this.nextId;this.nextId++;return this.prefix+b+this.postfix};mxGraphModel.prototype.updateEdgeParents=function(a,b){b=b||this.getRoot(a);var d=this.getChildCount(a);for(var e=0;e<d;e++){var h=this.getChildAt(a,e);this.updateEdgeParents(h,b)}var g=this.getEdgeCount(a);var c=[];for(var e=0;e<g;e++){c.push(this.getEdgeAt(a,e))}for(var e=0;e<c.length;e++){var f=c[e];if(this.isAncestor(b,f)){this.updateEdgeParent(f,b)}}};mxGraphModel.prototype.updateEdgeParent=function(b,g){var a=this.getTerminal(b,true);var d=this.getTerminal(b,false);var h=null;while(a!=null&&!this.isEdge(a)&&a.geometry!=null&&a.geometry.relative){a=this.getParent(a)}while(d!=null&&this.ignoreRelativeEdgeParent&&!this.isEdge(d)&&d.geometry!=null&&d.geometry.relative){d=this.getParent(d)}if(this.isAncestor(g,a)&&this.isAncestor(g,d)){if(a==d){h=this.getParent(a)}else{h=this.getNearestCommonAncestor(a,d)}if(h!=null&&(this.getParent(h)!=this.root||this.isAncestor(h,b))&&this.getParent(b)!=h){var c=this.getGeometry(b);if(c!=null){var f=this.getOrigin(this.getParent(b));var e=this.getOrigin(h);var j=e.x-f.x;var i=e.y-f.y;c=c.clone();c.translate(-j,-i);this.setGeometry(b,c)}this.add(h,b,this.getChildCount(h))}}};mxGraphModel.prototype.getOrigin=function(b){var a=null;if(b!=null){a=this.getOrigin(this.getParent(b));if(!this.isEdge(b)){var c=this.getGeometry(b);if(c!=null){a.x+=c.x;a.y+=c.y}}}else{a=new mxPoint()}return a};mxGraphModel.prototype.getNearestCommonAncestor=function(c,b){if(c!=null&&b!=null){var g=mxCellPath.create(b);if(g!=null&&g.length>0){var a=c;var f=mxCellPath.create(a);if(g.length<f.length){a=b;var d=f;f=g;g=d}while(a!=null){var e=this.getParent(a);if(g.indexOf(f+mxCellPath.PATH_SEPARATOR)==0&&e!=null){return a}f=mxCellPath.getParentPath(f);a=e}}}return null};mxGraphModel.prototype.remove=function(a){if(a==this.root){this.setRoot(null)}else{if(this.getParent(a)!=null){this.execute(new mxChildChange(this,null,a))}}return a};mxGraphModel.prototype.cellRemoved=function(a){if(a!=null&&this.cells!=null){var b=this.getChildCount(a);for(var c=b-1;c>=0;c--){this.cellRemoved(this.getChildAt(a,c))}if(this.cells!=null&&a.getId()!=null){delete this.cells[a.getId()]}}};mxGraphModel.prototype.parentForCellChanged=function(a,c,b){var d=this.getParent(a);if(c!=null){if(c!=d||d.getIndex(a)!=b){c.insert(a,b)}}else{if(d!=null){var e=d.getIndex(a);d.remove(e)}}if(!this.contains(d)&&c!=null){this.cellAdded(a)}else{if(c==null){this.cellRemoved(a)}}return d};mxGraphModel.prototype.getChildCount=function(a){return(a!=null)?a.getChildCount():0};mxGraphModel.prototype.getChildAt=function(a,b){return(a!=null)?a.getChildAt(b):null};mxGraphModel.prototype.getChildren=function(a){return(a!=null)?a.children:null};mxGraphModel.prototype.getChildVertices=function(a){return this.getChildCells(a,true,false)};mxGraphModel.prototype.getChildEdges=function(a){return this.getChildCells(a,false,true)};mxGraphModel.prototype.getChildCells=function(f,d,c){d=(d!=null)?d:false;c=(c!=null)?c:false;var b=this.getChildCount(f);var a=[];for(var e=0;e<b;e++){var g=this.getChildAt(f,e);if((!c&&!d)||(c&&this.isEdge(g))||(d&&this.isVertex(g))){a.push(g)}}return a};mxGraphModel.prototype.getTerminal=function(b,a){return(b!=null)?b.getTerminal(a):null};mxGraphModel.prototype.setTerminal=function(d,c,b){var a=c!=this.getTerminal(d,b);this.execute(new mxTerminalChange(this,d,c,b));if(this.maintainEdgeParent&&a){this.updateEdgeParent(d,this.getRoot())}return c};mxGraphModel.prototype.setTerminals=function(a,b,c){this.beginUpdate();try{this.setTerminal(a,b,true);this.setTerminal(a,c,false)}finally{this.endUpdate()}};mxGraphModel.prototype.terminalForCellChanged=function(d,b,a){var c=this.getTerminal(d,a);if(b!=null){b.insertEdge(d,a)}else{if(c!=null){c.removeEdge(d,a)}}return c};mxGraphModel.prototype.getEdgeCount=function(a){return(a!=null)?a.getEdgeCount():0};mxGraphModel.prototype.getEdgeAt=function(a,b){return(a!=null)?a.getEdgeAt(b):null};mxGraphModel.prototype.getDirectedEdgeCount=function(a,b,f){var e=0;var g=this.getEdgeCount(a);for(var c=0;c<g;c++){var d=this.getEdgeAt(a,c);if(d!=f&&this.getTerminal(d,b)==a){e++}}return e};mxGraphModel.prototype.getConnections=function(a){return this.getEdges(a,true,true,false)};mxGraphModel.prototype.getIncomingEdges=function(a){return this.getEdges(a,true,false,false)};mxGraphModel.prototype.getOutgoingEdges=function(a){return this.getEdges(a,false,true,false)};mxGraphModel.prototype.getEdges=function(j,e,g,d){e=(e!=null)?e:true;g=(g!=null)?g:true;d=(d!=null)?d:true;var b=this.getEdgeCount(j);var k=[];for(var f=0;f<b;f++){var c=this.getEdgeAt(j,f);var a=this.getTerminal(c,true);var h=this.getTerminal(c,false);if((d&&a==h)||((a!=h)&&((e&&h==j)||(g&&a==j)))){k.push(c)}}return k};mxGraphModel.prototype.getEdgesBetween=function(c,m,f){f=(f!=null)?f:false;var h=this.getEdgeCount(c);var g=this.getEdgeCount(m);var l=c;var b=h;if(g<h){b=g;l=m}var o=[];for(var j=0;j<b;j++){var e=this.getEdgeAt(l,j);var a=this.getTerminal(e,true);var d=this.getTerminal(e,false);var k=(a==c)&&(d==m);var n=(d==c)&&(a==m);if(k||(!f&&n)){o.push(e)}}return o};mxGraphModel.prototype.getOpposites=function(b,e,c,a){c=(c!=null)?c:true;a=(a!=null)?a:true;var h=[];if(b!=null){for(var d=0;d<b.length;d++){var f=this.getTerminal(b[d],true);var g=this.getTerminal(b[d],false);if(f==e&&g!=null&&g!=e&&a){h.push(g)}else{if(g==e&&f!=null&&f!=e&&c){h.push(f)}}}}return h};mxGraphModel.prototype.getTopmostCells=function(c){var g=new mxDictionary();var e=[];for(var d=0;d<c.length;d++){g.put(c[d],true)}for(var d=0;d<c.length;d++){var a=c[d];var b=true;var f=this.getParent(a);while(f!=null){if(g.get(f)){b=false;break}f=this.getParent(f)}if(b){e.push(a)}}return e};mxGraphModel.prototype.isVertex=function(a){return(a!=null)?a.isVertex():false};mxGraphModel.prototype.isEdge=function(a){return(a!=null)?a.isEdge():false};mxGraphModel.prototype.isConnectable=function(a){return(a!=null)?a.isConnectable():false};mxGraphModel.prototype.getValue=function(a){return(a!=null)?a.getValue():null};mxGraphModel.prototype.setValue=function(a,b){this.execute(new mxValueChange(this,a,b));return b};mxGraphModel.prototype.valueForCellChanged=function(a,b){return a.valueChanged(b)};mxGraphModel.prototype.getGeometry=function(a){return(a!=null)?a.getGeometry():null};mxGraphModel.prototype.setGeometry=function(a,b){if(b!=this.getGeometry(a)){this.execute(new mxGeometryChange(this,a,b))}return b};mxGraphModel.prototype.geometryForCellChanged=function(a,c){var b=this.getGeometry(a);a.setGeometry(c);return b};mxGraphModel.prototype.getStyle=function(a){return(a!=null)?a.getStyle():null};mxGraphModel.prototype.setStyle=function(a,b){if(b!=this.getStyle(a)){this.execute(new mxStyleChange(this,a,b))}return b};mxGraphModel.prototype.styleForCellChanged=function(a,b){var c=this.getStyle(a);a.setStyle(b);return c};mxGraphModel.prototype.isCollapsed=function(a){return(a!=null)?a.isCollapsed():false};mxGraphModel.prototype.setCollapsed=function(a,b){if(b!=this.isCollapsed(a)){this.execute(new mxCollapseChange(this,a,b))}return b};mxGraphModel.prototype.collapsedStateForCellChanged=function(a,c){var b=this.isCollapsed(a);a.setCollapsed(c);return b};mxGraphModel.prototype.isVisible=function(a){return(a!=null)?a.isVisible():false};mxGraphModel.prototype.setVisible=function(a,b){if(b!=this.isVisible(a)){this.execute(new mxVisibleChange(this,a,b))}return b};mxGraphModel.prototype.visibleStateForCellChanged=function(a,c){var b=this.isVisible(a);a.setVisible(c);return b};mxGraphModel.prototype.execute=function(a){a.execute();this.beginUpdate();this.currentEdit.add(a);this.fireEvent(new mxEventObject(mxEvent.EXECUTE,"change",a));this.fireEvent(new mxEventObject(mxEvent.EXECUTED,"change",a));this.endUpdate()};mxGraphModel.prototype.beginUpdate=function(){this.updateLevel++;this.fireEvent(new mxEventObject(mxEvent.BEGIN_UPDATE));if(this.updateLevel==1){this.fireEvent(new mxEventObject(mxEvent.START_EDIT))}};mxGraphModel.prototype.endUpdate=function(){this.updateLevel--;if(this.updateLevel==0){this.fireEvent(new mxEventObject(mxEvent.END_EDIT))}if(!this.endingUpdate){this.endingUpdate=this.updateLevel==0;this.fireEvent(new mxEventObject(mxEvent.END_UPDATE,"edit",this.currentEdit));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new mxEventObject(mxEvent.BEFORE_UNDO,"edit",this.currentEdit));var a=this.currentEdit;this.currentEdit=this.createUndoableEdit();a.notify();this.fireEvent(new mxEventObject(mxEvent.UNDO,"edit",a))}}finally{this.endingUpdate=false}}};mxGraphModel.prototype.createUndoableEdit=function(){var a=new mxUndoableEdit(this,true);a.notify=function(){a.source.fireEvent(new mxEventObject(mxEvent.CHANGE,"edit",a,"changes",a.changes));a.source.fireEvent(new mxEventObject(mxEvent.NOTIFY,"edit",a,"changes",a.changes))};return a};mxGraphModel.prototype.mergeChildren=function(g,f,b){b=(b!=null)?b:true;this.beginUpdate();try{var c=new Object();this.mergeChildrenImpl(g,f,b,c);for(var e in c){var a=c[e];var d=this.getTerminal(a,true);if(d!=null){d=c[mxCellPath.create(d)];this.setTerminal(a,d,true)}d=this.getTerminal(a,false);if(d!=null){d=c[mxCellPath.create(d)];this.setTerminal(a,d,false)}}}finally{this.endUpdate()}};mxGraphModel.prototype.mergeChildrenImpl=function(h,j,d,a){this.beginUpdate();try{var c=h.getChildCount();for(var e=0;e<c;e++){var k=h.getChildAt(e);if(typeof(k.getId)=="function"){var b=k.getId();var f=(b!=null&&(!this.isEdge(k)||!d))?this.getCell(b):null;if(f==null){var g=k.clone();g.setId(b);g.setTerminal(k.getTerminal(true),true);g.setTerminal(k.getTerminal(false),false);f=j.insert(g);this.cellAdded(f)}a[mxCellPath.create(k)]=f;this.mergeChildrenImpl(k,f,d,a)}}}finally{this.endUpdate()}};mxGraphModel.prototype.getParents=function(b){var a=[];if(b!=null){var e=new mxDictionary();for(var c=0;c<b.length;c++){var d=this.getParent(b[c]);if(d!=null&&!e.get(d)){e.put(d,true);a.push(d)}}}return a};mxGraphModel.prototype.cloneCell=function(a){if(a!=null){return this.cloneCells([a],true)[0]}return null};mxGraphModel.prototype.cloneCells=function(c,a,b){b=(b!=null)?b:new Object();var e=[];for(var d=0;d<c.length;d++){if(c[d]!=null){e.push(this.cloneCellImpl(c[d],b,a))}else{e.push(null)}}for(var d=0;d<e.length;d++){if(e[d]!=null){this.restoreClone(e[d],c[d],b)}}return e};mxGraphModel.prototype.cloneCellImpl=function(b,d,a){var g=this.cellCloned(b);d[mxObjectIdentity.get(b)]=g;if(a){var c=this.getChildCount(b);for(var e=0;e<c;e++){var f=this.cloneCellImpl(this.getChildAt(b,e),d,true);g.insert(f)}}return g};mxGraphModel.prototype.cellCloned=function(a){return a.clone()};mxGraphModel.prototype.restoreClone=function(h,a,c){var f=this.getTerminal(a,true);if(f!=null){var e=c[mxObjectIdentity.get(f)];if(e!=null){e.insertEdge(h,true)}}var g=this.getTerminal(a,false);if(g!=null){var e=c[mxObjectIdentity.get(g)];if(e!=null){e.insertEdge(h,false)}}var b=this.getChildCount(h);for(var d=0;d<b;d++){this.restoreClone(this.getChildAt(h,d),this.getChildAt(a,d),c)}};function mxRootChange(b,a){this.model=b;this.root=a;this.previous=a}mxRootChange.prototype.execute=function(){this.root=this.previous;this.previous=this.model.rootChanged(this.previous)};function mxChildChange(b,c,d,a){this.model=b;this.parent=c;this.previous=c;this.child=d;this.index=a;this.previousIndex=a}mxChildChange.prototype.execute=function(){var a=this.model.getParent(this.child);var b=(a!=null)?a.getIndex(this.child):0;if(this.previous==null){this.connect(this.child,false)}a=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex);if(this.previous!=null){this.connect(this.child,true)}this.parent=this.previous;this.previous=a;this.index=this.previousIndex;this.previousIndex=b};mxChildChange.prototype.connect=function(a,d){d=(d!=null)?d:true;var e=a.getTerminal(true);var f=a.getTerminal(false);if(e!=null){if(d){this.model.terminalForCellChanged(a,e,true)}else{this.model.terminalForCellChanged(a,null,true)}}if(f!=null){if(d){this.model.terminalForCellChanged(a,f,false)}else{this.model.terminalForCellChanged(a,null,false)}}a.setTerminal(e,true);a.setTerminal(f,false);var b=this.model.getChildCount(a);for(var c=0;c<b;c++){this.connect(this.model.getChildAt(a,c),d)}};function mxTerminalChange(b,a,c,d){this.model=b;this.cell=a;this.terminal=c;this.previous=c;this.source=d}mxTerminalChange.prototype.execute=function(){this.terminal=this.previous;this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)};function mxValueChange(b,a,c){this.model=b;this.cell=a;this.value=c;this.previous=c}mxValueChange.prototype.execute=function(){this.value=this.previous;this.previous=this.model.valueForCellChanged(this.cell,this.previous)};function mxStyleChange(b,a,c){this.model=b;this.cell=a;this.style=c;this.previous=c}mxStyleChange.prototype.execute=function(){this.style=this.previous;this.previous=this.model.styleForCellChanged(this.cell,this.previous)};function mxGeometryChange(b,a,c){this.model=b;this.cell=a;this.geometry=c;this.previous=c}mxGeometryChange.prototype.execute=function(){this.geometry=this.previous;this.previous=this.model.geometryForCellChanged(this.cell,this.previous)};function mxCollapseChange(b,a,c){this.model=b;this.cell=a;this.collapsed=c;this.previous=c}mxCollapseChange.prototype.execute=function(){this.collapsed=this.previous;this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)};function mxVisibleChange(b,a,c){this.model=b;this.cell=a;this.visible=c;this.previous=c}mxVisibleChange.prototype.execute=function(){this.visible=this.previous;this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)};function mxCellAttributeChange(a,b,c){this.cell=a;this.attribute=b;this.value=c;this.previous=c}mxCellAttributeChange.prototype.execute=function(){var a=this.cell.getAttribute(this.attribute);if(this.previous==null){this.cell.value.removeAttribute(this.attribute)}else{this.cell.setAttribute(this.attribute,this.previous)}this.previous=a};